var cc=cc||{};cc._tmp=cc._tmp||{};cc._LogInfos={};_p=window;_p=Object.prototype;delete window._p;cc.newElement=function(a){return document.createElement(a)};cc._addEventListener=function(a,c,b,d){a.addEventListener(c,b,d)};cc._isNodeJs="undefined"!==typeof require&&require("fs");cc.each=function(a,c,b){if(a)if(a instanceof Array)for(var d=0,e=a.length;d<e&&!1!==c.call(b,a[d],d);d++);else for(d in a)if(!1===c.call(b,a[d],d))break};
cc.extend=function(a){var c=2<=arguments.length?Array.prototype.slice.call(arguments,1):[];cc.each(c,function(c){for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])});return a};cc.isFunction=function(a){return"function"===typeof a};cc.isNumber=function(a){return"number"===typeof a||"[object Number]"===Object.prototype.toString.call(a)};cc.isString=function(a){return"string"===typeof a||"[object String]"===Object.prototype.toString.call(a)};
cc.isArray=function(a){return Array.isArray(a)||"object"===typeof a&&"[object Array]"===Object.prototype.toString.call(a)};cc.isUndefined=function(a){return"undefined"===typeof a};cc.isObject=function(a){return"object"===typeof a&&"[object Object]"===Object.prototype.toString.call(a)};cc.isCrossOrigin=function(a){if(!a)return cc.log("invalid URL"),!1;var c=a.indexOf("://");if(-1===c)return!1;c=a.indexOf("/",c+3);return(-1===c?a:a.substring(0,c))!==location.origin};
cc.AsyncPool=function(a,c,b,d,e){var f=this;f._srcObj=a;f._limit=c;f._pool=[];f._iterator=b;f._iteratorTarget=e;f._onEnd=d;f._onEndTarget=e;f._results=a instanceof Array?[]:{};f._isErr=!1;cc.each(a,function(a,c){f._pool.push({index:c,value:a})});f.size=f._pool.length;f.finishedSize=0;f._workingSize=0;f._limit=f._limit||f.size;f.onIterator=function(a,c){f._iterator=a;f._iteratorTarget=c};f.onEnd=function(a,c){f._onEnd=a;f._onEndTarget=c};f._handleItem=function(){var a=this;if(!(0===a._pool.length||
a._workingSize>=a._limit)){var c=a._pool.shift(),b=c.value,d=c.index;a._workingSize++;a._iterator.call(a._iteratorTarget,b,d,function(c){if(!a._isErr)if(a.finishedSize++,a._workingSize--,c)a._isErr=!0,a._onEnd&&a._onEnd.call(a._onEndTarget,c);else{var b=Array.prototype.slice.call(arguments,1);a._results[this.index]=b[0];a.finishedSize===a.size?a._onEnd&&a._onEnd.call(a._onEndTarget,null,a._results):a._handleItem()}}.bind(c),a)}};f.flow=function(){if(0===this._pool.length)this._onEnd&&this._onEnd.call(this._onEndTarget,
null,[]);else for(var a=0;a<this._limit;a++)this._handleItem()}};
cc.async={series:function(a,c,b){a=new cc.AsyncPool(a,1,function(a,c,f){a.call(b,f)},c,b);a.flow();return a},parallel:function(a,c,b){a=new cc.AsyncPool(a,0,function(a,c,f){a.call(b,f)},c,b);a.flow();return a},waterfall:function(a,c,b){var d=[],e=[null],f=new cc.AsyncPool(a,1,function(c,f,k){d.push(function(c){d=Array.prototype.slice.call(arguments,1);a.length-1===f&&(e=e.concat(d));k.apply(null,arguments)});c.apply(b,d)},function(a){if(c){if(a)return c.call(b,a);c.apply(b,e)}});f.flow();return f},
map:function(a,c,b,d){var e=c;"object"===typeof c&&(b=c.cb,d=c.iteratorTarget,e=c.iterator);a=new cc.AsyncPool(a,0,e,b,d);a.flow();return a},mapLimit:function(a,c,b,d,e){a=new cc.AsyncPool(a,c,b,d,e);a.flow();return a}};
cc.path={join:function(){for(var a=arguments.length,c="",b=0;b<a;b++)c=(c+(""===c?"":"/")+arguments[b]).replace(/(\/|\\\\)$/,"");return c},extname:function(a){return(a=/(\.[^\.\/\?\\]*)(\?.*)?$/.exec(a))?a[1]:null},mainFileName:function(a){if(a){var c=a.lastIndexOf(".");if(-1!==c)return a.substring(0,c)}return a},basename:function(a,c){var b=a.indexOf("?");0<b&&(a=a.substring(0,b));b=/(\/|\\\\)([^(\/|\\\\)]+)$/g.exec(a.replace(/(\/|\\\\)$/,""));if(!b)return null;b=b[2];return c&&a.substring(a.length-
c.length).toLowerCase()===c.toLowerCase()?b.substring(0,b.length-c.length):b},dirname:function(a){return a.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(a,c){c=c||"";var b=a.indexOf("?"),d="";0<b&&(d=a.substring(b),a=a.substring(0,b));b=a.lastIndexOf(".");return 0>b?a+c+d:a.substring(0,b)+c+d},changeBasename:function(a,c,b){if(0===c.indexOf("."))return this.changeExtname(a,c);var d=a.indexOf("?"),e="";b=b?this.extname(a):"";0<d&&(e=a.substring(d),a=a.substring(0,d));d=a.lastIndexOf("/");
return a.substring(0,0>=d?0:d+1)+c+b+e}};
cc.loader={_jsCache:{},_register:{},_langPathCache:{},_aliases:{},resPath:"",audioPath:"",cache:{},getXMLHttpRequest:function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},_getArgs4Js:function(a){var c=a[0],b=a[1],d=a[2],e=["",null,null];if(1===a.length)e[1]=c instanceof Array?c:[c];else if(2===a.length)"function"===typeof b?(e[1]=c instanceof Array?c:[c],e[2]=b):(e[0]=c||"",e[1]=b instanceof Array?b:[b]);else if(3===a.length)e[0]=c||"",e[1]=b instanceof
Array?b:[b],e[2]=d;else throw"arguments error to load js!";return e},loadJs:function(a,c,b){var d=this,e=d._jsCache,f=d._getArgs4Js(arguments),g=f[0],h=f[1],f=f[2];-1<navigator.userAgent.indexOf("Trident/5")?d._loadJs4Dependency(g,h,0,f):cc.async.map(h,function(a,c,b){a=cc.path.join(g,a);if(e[a])return b(null);d._createScript(a,!1,b)},f)},loadJsWithImg:function(a,c,b){var d=this._loadJsImg(),e=this._getArgs4Js(arguments);this.loadJs(e[0],e[1],function(a){if(a)throw a;d.parentNode.removeChild(d);if(e[2])e[2]()})},
_createScript:function(a,c,b){var d=document,e=cc.newElement("script");e.async=c;this._jsCache[a]=!0;cc.game.config.noCache&&"string"===typeof a?this._noCacheRex.test(a)?e.src=a+"\x26_t\x3d"+(new Date-0):e.src=a+"?_t\x3d"+(new Date-0):e.src=a;cc._addEventListener(e,"load",function(){e.parentNode.removeChild(e);this.removeEventListener("load",arguments.callee,!1);b()},!1);cc._addEventListener(e,"error",function(){e.parentNode.removeChild(e);b("Load "+a+" failed!")},!1);d.body.appendChild(e)},_loadJs4Dependency:function(a,
c,b,d){if(b>=c.length)d&&d();else{var e=this;e._createScript(cc.path.join(a,c[b]),!1,function(f){if(f)return d(f);e._loadJs4Dependency(a,c,b+1,d)})}},_loadJsImg:function(){var a=document,c=a.getElementById("cocos2d_loadJsImg");if(!c){c=cc.newElement("img");cc._loadingImage&&(c.src=cc._loadingImage);a=a.getElementById(cc.game.config.id);a.style.backgroundColor="black";a.parentNode.appendChild(c);var b=getComputedStyle?getComputedStyle(a):a.currentStyle;b||(b={width:a.width,height:a.height});c.style.left=
a.offsetLeft+(parseFloat(b.width)-c.width)/2+"px";c.style.top=a.offsetTop+(parseFloat(b.height)-c.height)/2+"px";c.style.position="absolute"}return c},loadTxt:function(a,c){if(cc._isNodeJs)require("fs").readFile(a,function(a,b){a?c(a):c(null,b.toString())});else{var b=this.getXMLHttpRequest(),d="load "+a+" failed!";b.open("GET",a,!0);/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(b.setRequestHeader("Accept-Charset","utf-8"),b.onreadystatechange=function(){4===b.readyState&&
(200===b.status?c(null,b.responseText):c(d))}):(b.overrideMimeType&&b.overrideMimeType("text/plain; charset\x3dutf-8"),b.onload=function(){4===b.readyState&&(200===b.status?c(null,b.responseText):c(d))});b.send(null)}},_loadTxtSync:function(a){if(cc._isNodeJs)return require("fs").readFileSync(a).toString();var c=this.getXMLHttpRequest();c.open("GET",a,!1);/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?c.setRequestHeader("Accept-Charset","utf-8"):c.overrideMimeType&&c.overrideMimeType("text/plain; charset\x3dutf-8");
c.send(null);return 4===!c.readyState||200!==c.status?null:c.responseText},loadCsb:function(a,c){var b=new XMLHttpRequest;b.open("GET",a,!0);b.responseType="arraybuffer";b.onload=function(){var d=b.response;d&&(window.msg=d);4===b.readyState&&(200===b.status?c(null,b.response):c("load "+a+" failed!"))};b.send(null)},loadJson:function(a,c){this.loadTxt(a,function(b,d){if(b)c(b);else{try{var e=JSON.parse(d)}catch(f){throw"parse json ["+a+"] failed : "+f;}c(null,e)}})},_checkIsImageURL:function(a){return null!=
/(\.png)|(\.jpg)|(\.bmp)|(\.jpeg)|(\.gif)/.exec(a)},loadImg:function(a,c,b){var d={isCrossOrigin:!0};void 0!==b?d.isCrossOrigin=null===c.isCrossOrigin?d.isCrossOrigin:c.isCrossOrigin:void 0!==c&&(b=c);var e=this.getRes(a);if(e)return b&&b(null,e),e;e=new Image;d.isCrossOrigin&&"file://"!==location.origin&&(e.crossOrigin="Anonymous");var f=function(){this.removeEventListener("load",f,!1);this.removeEventListener("error",h,!1);cc.loader.cache[a]=e;b&&b(null,e)},g=this,h=function(){this.removeEventListener("error",
h,!1);e.crossOrigin&&"anonymous"===e.crossOrigin.toLowerCase()?(d.isCrossOrigin=!1,g.release(a),cc.loader.loadImg(a,d,b)):"function"===typeof b&&b("load image failed")};cc._addEventListener(e,"load",f);cc._addEventListener(e,"error",h);e.src=a;return e},_loadResIterator:function(a,c,b){var d=this,e=null,f=a.type;f?(f="."+f.toLowerCase(),e=a.src?a.src:a.name+f):(e=a,f=cc.path.extname(e));if(c=d.getRes(e))return b(null,c);c=null;f&&(c=d._register[f.toLowerCase()]);if(!c)return cc.error("loader for ["+
f+"] not exists!"),b();f=c.getBasePath?c.getBasePath():d.resPath;f=d.getUrl(f,e);cc.game.config.noCache&&"string"===typeof f&&(f=d._noCacheRex.test(f)?f+("\x26_t\x3d"+(new Date-0)):f+("?_t\x3d"+(new Date-0)));c.load(f,e,a,function(a,c){a?(cc.log(a),d.cache[e]=null,delete d.cache[e],b()):(d.cache[e]=c,b(null,c))})},_noCacheRex:/\?/,getUrl:function(a,c){var b=this._langPathCache,d=cc.path;if(void 0!==a&&void 0===c){c=a;var e=d.extname(c),e=e?e.toLowerCase():"";a=(e=this._register[e])?e.getBasePath?
e.getBasePath():this.resPath:this.resPath}c=cc.path.join(a||"",c);if(c.match(/[\/(\\\\)]lang[\/(\\\\)]/i)){if(b[c])return b[c];d=d.extname(c)||"";c=b[c]=c.substring(0,c.length-d.length)+"_"+cc.sys.language+d}return c},load:function(a,c,b){var d=this,e=arguments.length;if(0===e)throw"arguments error!";3===e?"function"===typeof c&&(c="function"===typeof b?{trigger:c,cb:b}:{cb:c,cbTarget:b}):2===e?"function"===typeof c&&(c={cb:c}):1===e&&(c={});a instanceof Array||(a=[a]);e=new cc.AsyncPool(a,0,function(a,
b,e,k){d._loadResIterator(a,b,function(a){if(a)return e(a);var b=Array.prototype.slice.call(arguments,1);c.trigger&&c.trigger.call(c.triggerTarget,b[0],k.size,k.finishedSize);e(null,b[0])})},c.cb,c.cbTarget);e.flow();return e},_handleAliases:function(a,c){var b=this._aliases,d=[],e;for(e in a){var f=a[e];b[e]=f;d.push(f)}this.load(d,c)},loadAliases:function(a,c){var b=this,d=b.getRes(a);d?b._handleAliases(d.filenames,c):b.load(a,function(a,d){b._handleAliases(d[0].filenames,c)})},register:function(a,
c){if(a&&c){if("string"===typeof a)return this._register[a.trim().toLowerCase()]=c;for(var b=0,d=a.length;b<d;b++)this._register["."+a[b].trim().toLowerCase()]=c}},getRes:function(a){return this.cache[a]||this.cache[this._aliases[a]]},release:function(a){var c=this.cache,b=this._aliases;delete c[a];delete c[b[a]];delete b[a]},releaseAll:function(){var a=this.cache,c=this._aliases,b;for(b in a)delete a[b];for(b in c)delete c[b]}};
cc.formatStr=function(){var a=arguments,c=a.length;if(1>c)return"";var b=a[0],d=!0;"object"===typeof b&&(d=!1);for(var e=1;e<c;++e){var f=a[e];if(d)for(;;){var g=null;if("number"===typeof f&&(g=b.match(/(%d)|(%s)/))){b=b.replace(/(%d)|(%s)/,f);break}b=(g=b.match(/%s/))?b.replace(/%s/,f):b+("    "+f);break}else b+="    "+f}return b};
(function(){var a=window,c,b;cc.isUndefined(document.hidden)?cc.isUndefined(document.mozHidden)?cc.isUndefined(document.msHidden)?cc.isUndefined(document.webkitHidden)||(c="webkitHidden",b="webkitvisibilitychange"):(c="msHidden",b="msvisibilitychange"):(c="mozHidden",b="mozvisibilitychange"):(c="hidden",b="visibilitychange");var d=function(){cc.eventManager&&cc.game._eventHide&&cc.eventManager.dispatchEvent(cc.game._eventHide)},e=function(){cc.eventManager&&cc.game._eventShow&&cc.eventManager.dispatchEvent(cc.game._eventShow);
cc.game._intervalId&&(window.cancelAnimationFrame(cc.game._intervalId),cc.game._runMainLoop())};c?cc._addEventListener(document,b,function(){document[c]?d():e()},!1):(cc._addEventListener(a,"blur",d,!1),cc._addEventListener(a,"focus",e,!1));-1<navigator.userAgent.indexOf("MicroMessenger")&&(a.onfocus=function(){e()});"onpageshow"in window&&"onpagehide"in window&&(cc._addEventListener(a,"pagehide",d,!1),cc._addEventListener(a,"pageshow",e,!1));b=a=null})();cc.log=cc.warn=cc.error=cc.assert=function(){};
cc.create3DContext=function(a,c){for(var b=["webgl","experimental-webgl","webkit-3d","moz-webgl"],d=null,e=0;e<b.length;++e){try{d=a.getContext(b[e],c)}catch(f){}if(d)break}return d};
cc._initSys=function(a,c){cc._RENDER_TYPE_CANVAS=0;cc._RENDER_TYPE_WEBGL=1;cc.sys={};var b=cc.sys;b.LANGUAGE_ENGLISH="en";b.LANGUAGE_CHINESE="zh";b.LANGUAGE_FRENCH="fr";b.LANGUAGE_ITALIAN="it";b.LANGUAGE_GERMAN="de";b.LANGUAGE_SPANISH="es";b.LANGUAGE_DUTCH="du";b.LANGUAGE_RUSSIAN="ru";b.LANGUAGE_KOREAN="ko";b.LANGUAGE_JAPANESE="ja";b.LANGUAGE_HUNGARIAN="hu";b.LANGUAGE_PORTUGUESE="pt";b.LANGUAGE_ARABIC="ar";b.LANGUAGE_NORWEGIAN="no";b.LANGUAGE_POLISH="pl";b.OS_IOS="iOS";b.OS_ANDROID="Android";b.OS_WINDOWS=
"Windows";b.OS_MARMALADE="Marmalade";b.OS_LINUX="Linux";b.OS_BADA="Bada";b.OS_BLACKBERRY="Blackberry";b.OS_OSX="OS X";b.OS_WP8="WP8";b.OS_WINRT="WINRT";b.OS_UNKNOWN="Unknown";b.UNKNOWN=0;b.IOS=1;b.ANDROID=2;b.WIN32=3;b.MARMALADE=4;b.LINUX=5;b.BADA=6;b.BLACKBERRY=7;b.MACOS=8;b.NACL=9;b.EMSCRIPTEN=10;b.TIZEN=11;b.QT5=12;b.WP8=13;b.WINRT=14;b.MOBILE_BROWSER=100;b.DESKTOP_BROWSER=101;b.BROWSER_TYPE_WECHAT="wechat";b.BROWSER_TYPE_ANDROID="androidbrowser";b.BROWSER_TYPE_IE="ie";b.BROWSER_TYPE_QQ="qqbrowser";
b.BROWSER_TYPE_MOBILE_QQ="mqqbrowser";b.BROWSER_TYPE_UC="ucbrowser";b.BROWSER_TYPE_360="360browser";b.BROWSER_TYPE_BAIDU_APP="baiduboxapp";b.BROWSER_TYPE_BAIDU="baidubrowser";b.BROWSER_TYPE_MAXTHON="maxthon";b.BROWSER_TYPE_OPERA="opera";b.BROWSER_TYPE_OUPENG="oupeng";b.BROWSER_TYPE_MIUI="miuibrowser";b.BROWSER_TYPE_FIREFOX="firefox";b.BROWSER_TYPE_SAFARI="safari";b.BROWSER_TYPE_CHROME="chrome";b.BROWSER_TYPE_LIEBAO="liebao";b.BROWSER_TYPE_QZONE="qzone";b.BROWSER_TYPE_SOUGOU="sogou";b.BROWSER_TYPE_UNKNOWN=
"unknown";b.isNative=!1;var d=window,e=d.navigator,f=document,g=f.documentElement,h=e.userAgent.toLowerCase();b.isMobile=-1!==h.indexOf("mobile")||-1!==h.indexOf("android");b.platform=b.isMobile?b.MOBILE_BROWSER:b.DESKTOP_BROWSER;var k=e.language,k=(k=k?k:e.browserLanguage)?k.split("-")[0]:b.LANGUAGE_ENGLISH;b.language=k;var k=b.BROWSER_TYPE_UNKNOWN,l=h.match(/sogou|qzone|liebao|micromessenger|qqbrowser|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|trident|oupeng|opera|miuibrowser|firefox/i)||
h.match(/chrome|safari/i);l&&0<l.length?(k=l[0],"micromessenger"===k?k=b.BROWSER_TYPE_WECHAT:"safari"===k&&h.match(/android.*applewebkit/)?k=b.BROWSER_TYPE_ANDROID:"trident"===k?k=b.BROWSER_TYPE_IE:"360 aphone"===k&&(k=b.BROWSER_TYPE_360)):h.indexOf("iphone")&&h.indexOf("mobile")&&(k="safari");b.browserType=k;k=h.match(/(iPad|iPhone|iPod)/i)?!0:!1;h=h.match(/android/i)||e.platform.match(/android/i)?!0:!1;l=b.OS_UNKNOWN;-1!==e.appVersion.indexOf("Win")?l=b.OS_WINDOWS:k?l=b.OS_IOS:-1!==e.appVersion.indexOf("Mac")?
l=b.OS_OSX:-1!==e.appVersion.indexOf("X11")&&-1===e.appVersion.indexOf("Linux")?l=b.OS_UNIX:h?l=b.OS_ANDROID:-1!==e.appVersion.indexOf("Linux")&&(l=b.OS_LINUX);b.os=l;b._supportMultipleAudio=-1<[b.BROWSER_TYPE_BAIDU,b.BROWSER_TYPE_OPERA,b.BROWSER_TYPE_FIREFOX,b.BROWSER_TYPE_CHROME,b.BROWSER_TYPE_BAIDU_APP,b.BROWSER_TYPE_SAFARI,b.BROWSER_TYPE_UC,b.BROWSER_TYPE_QQ,b.BROWSER_TYPE_MOBILE_QQ,b.BROWSER_TYPE_IE].indexOf(b.browserType);(function(a,b){var e=b[c.renderMode]-0;if(isNaN(e)||2<e||0>e)e=0;var f=
[a.OS_ANDROID],g=[],h=cc.newElement("canvas");cc._renderType=cc._RENDER_TYPE_CANVAS;cc._supportRender=!1;var k=d.WebGLRenderingContext;if(2===e||0===e&&k&&-1===f.indexOf(a.os)&&-1===g.indexOf(a.browserType))try{cc.create3DContext(h,{stencil:!0,preserveDrawingBuffer:!0})&&(cc._renderType=cc._RENDER_TYPE_WEBGL,cc._supportRender=!0)}catch(l){}if(1===e||0===e&&!1===cc._supportRender)try{h.getContext("2d"),cc._renderType=cc._RENDER_TYPE_CANVAS,cc._supportRender=!0}catch(n){}})(b,a);b._canUseCanvasNewBlendModes=
function(){var a=document.createElement("canvas");a.width=1;a.height=1;a=a.getContext("2d");a.fillStyle="#000";a.fillRect(0,0,1,1);a.globalCompositeOperation="multiply";var c=document.createElement("canvas");c.width=1;c.height=1;var b=c.getContext("2d");b.fillStyle="#fff";b.fillRect(0,0,1,1);a.drawImage(c,0,0,1,1);return 0===a.getImageData(0,0,1,1).data[0]};b._supportCanvasNewBlendModes=b._canUseCanvasNewBlendModes();try{b._supportWebAudio=!(!d.AudioContext&&!d.webkitAudioContext&&!d.mozAudioContext)}catch(n){b._supportWebAudio=
!1}try{var m=b.localStorage=d.localStorage;m.setItem("storage","");m.removeItem("storage");m=null}catch(p){("SECURITY_ERR"===p.name||"QuotaExceededError"===p.name)&&cc.warn("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option"),b.localStorage=function(){}}m=b.capabilities={canvas:!0};cc._renderType===cc._RENDER_TYPE_WEBGL&&(m.opengl=!0);if(void 0!==g.ontouchstart||void 0!==f.ontouchstart||e.msPointerEnabled)m.touches=!0;void 0!==g.onmouseup&&(m.mouse=!0);void 0!==
g.onkeyup&&(m.keyboard=!0);if(d.DeviceMotionEvent||d.DeviceOrientationEvent)m.accelerometer=!0;b.garbageCollect=function(){};b.dumpRoot=function(){};b.restartVM=function(){};b.cleanScript=function(a){};b.isObjectValid=function(a){return a?!0:!1};b.dump=function(){var a;a=""+("isMobile : "+this.isMobile+"\r\n");a+="language : "+this.language+"\r\n";a+="browserType : "+this.browserType+"\r\n";a+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n";a+="os : "+this.os+"\r\n";a+="platform : "+this.platform+
"\r\n";cc.log(a)};b.openURL=function(a){window.open(a)}};cc.ORIENTATION_PORTRAIT=0;cc.ORIENTATION_PORTRAIT_UPSIDE_DOWN=1;cc.ORIENTATION_LANDSCAPE_LEFT=2;cc.ORIENTATION_LANDSCAPE_RIGHT=3;cc._drawingUtil=null;cc._renderContext=null;cc._canvas=null;cc._gameDiv=null;cc._rendererInitialized=!1;cc._setupCalled=!1;
cc._setup=function(a,c,b){if(!cc._setupCalled){cc._setupCalled=!0;var d=window,e=cc.$(a)||cc.$("#"+a),f;cc.game._setAnimFrame();"CANVAS"===e.tagName?(c=c||e.width,b=b||e.height,f=cc.container=cc.newElement("DIV"),a=cc._canvas=e,a.parentNode.insertBefore(f,a),a.appendTo(f),f.setAttribute("id","Cocos2dGameContainer")):("DIV"!==e.tagName&&cc.log("Warning: target element is not a DIV or CANVAS"),c=c||e.clientWidth,b=b||e.clientHeight,f=cc.container=e,a=cc._canvas=cc.$(cc.newElement("CANVAS")),e.appendChild(a));
a.addClass("gameCanvas");a.setAttribute("width",c||480);a.setAttribute("height",b||320);a.setAttribute("tabindex",99);a.style.outline="none";e=f.style;e.width=(c||480)+"px";e.height=(b||320)+"px";e.margin="0 auto";e.position="relative";e.overflow="hidden";f.top="100%";cc._renderType===cc._RENDER_TYPE_WEBGL&&(cc._renderContext=cc.webglContext=cc.create3DContext(a,{stencil:!0,preserveDrawingBuffer:!0,antialias:!cc.sys.isMobile,alpha:!1}));cc._renderContext?(d.gl=cc._renderContext,cc._drawingUtil=new cc.DrawingPrimitiveWebGL(cc._renderContext),
cc._rendererInitialized=!0,cc.textureCache._initializingRenderer(),cc.shaderCache._init()):(cc._renderContext=new cc.CanvasContextWrapper(a.getContext("2d")),cc._drawingUtil=cc.DrawingPrimitiveCanvas?new cc.DrawingPrimitiveCanvas(cc._renderContext):null);cc._gameDiv=f;cc.log(cc.ENGINE_VERSION);cc._setContextMenuEnable(!1);cc.sys.isMobile&&(c=cc.newElement("style"),c.type="text/css",document.body.appendChild(c),c.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}");
cc.view=cc.EGLView._getInstance();cc.inputManager.registerSystemEvent(cc._canvas);cc.director=cc.Director._getInstance();cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view);cc.winSize=cc.director.getWinSize();cc.saxParser=new cc.SAXParser;cc.plistParser=new cc.PlistParser}};cc._checkWebGLRenderMode=function(){if(cc._renderType!==cc._RENDER_TYPE_WEBGL)throw"This feature supports WebGL render mode only.";};cc._isContextMenuEnable=!1;
cc._setContextMenuEnable=function(a){cc._isContextMenuEnable=a;cc._canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1}};
cc.game={DEBUG_MODE_NONE:0,DEBUG_MODE_INFO:1,DEBUG_MODE_WARN:2,DEBUG_MODE_ERROR:3,DEBUG_MODE_INFO_FOR_WEB_PAGE:4,DEBUG_MODE_WARN_FOR_WEB_PAGE:5,DEBUG_MODE_ERROR_FOR_WEB_PAGE:6,EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",_eventHide:null,_eventShow:null,_onBeforeStartArr:[],CONFIG_KEY:{engineDir:"engineDir",dependencies:"dependencies",debugMode:"debugMode",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",jsList:"jsList",classReleaseMode:"classReleaseMode"},_prepareCalled:!1,
_prepared:!1,_paused:!0,_intervalId:null,_lastTime:null,_frameTime:null,config:null,onStart:null,onStop:null,setFrameRate:function(a){this.config[this.CONFIG_KEY.frameRate]=a;this._intervalId&&window.cancelAnimationFrame(this._intervalId);this._paused=!0;this._setAnimFrame();this._runMainLoop()},_setAnimFrame:function(){this._lastTime=new Date;this._frameTime=1E3/cc.game.config[cc.game.CONFIG_KEY.frameRate];cc.sys.os===cc.sys.OS_IOS&&cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT||60!==cc.game.config[cc.game.CONFIG_KEY.frameRate]?
(window.requestAnimFrame=this._stTime,window.cancelAnimationFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimationFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||
window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(a){var c=(new Date).getTime(),b=Math.max(0,cc.game._frameTime-(c-cc.game._lastTime)),d=window.setTimeout(function(){a()},b);cc.game._lastTime=c+b;return d},_ctTime:function(a){window.clearTimeout(a)},_runMainLoop:function(){var a=this,c,b=cc.director;b.setDisplayStats(a.config[a.CONFIG_KEY.showFPS]);c=function(){a._paused||(b.mainLoop(),a._intervalId&&
window.cancelAnimationFrame(a._intervalId),a._intervalId=window.requestAnimFrame(c))};window.requestAnimFrame(c);a._paused=!1},restart:function(){cc.director.popToSceneStackLevel(0);cc.audioEngine&&cc.audioEngine.end();cc.game.onStart()},run:function(a){var c=this,b=function(){a&&(c.config[c.CONFIG_KEY.id]=a);c._prepareCalled||c.prepare(function(){c._prepared=!0});cc._supportRender&&(c._checkPrepare=setInterval(function(){c._prepared&&(cc._setup(c.config[c.CONFIG_KEY.id]),c._runMainLoop(),c._eventHide=
c._eventHide||new cc.EventCustom(c.EVENT_HIDE),c._eventHide.setUserData(c),c._eventShow=c._eventShow||new cc.EventCustom(c.EVENT_SHOW),c._eventShow.setUserData(c),c.onStart(),clearInterval(c._checkPrepare))},10))};document.body?b():cc._addEventListener(window,"load",function(){this.removeEventListener("load",arguments.callee,!1);b()},!1)},_initConfig:function(){var a=this.CONFIG_KEY,c=function(c){c[a.engineDir]=c[a.engineDir]||"frameworks/cocos2d-html5";null==c[a.debugMode]&&(c[a.debugMode]=0);c[a.frameRate]=
c[a.frameRate]||60;null==c[a.renderMode]&&(c[a.renderMode]=1);return c};if(document.ccConfig)this.config=c(document.ccConfig);else try{for(var b=document.getElementsByTagName("script"),d=0;d<b.length;d++){var e=b[d].getAttribute("cocos");if(""===e||e)break}var f,g,h;if(d<b.length){if(f=b[d].src)h=/(.*)\//.exec(f)[0],cc.loader.resPath=h,f=cc.path.join(h,"project.json");g=cc.loader._loadTxtSync(f)}g||(g=cc.loader._loadTxtSync("project.json"));var k=JSON.parse(g);this.config=c(k||{})}catch(l){cc.log("Failed to read or parse project.json"),
this.config=c({})}cc._initSys(this.config,a)},_jsAddedCache:{},_getJsListOfModule:function(a,c,b){var d=this._jsAddedCache;if(d[c])return null;b=b||"";var e=[],f=a[c];if(!f)throw"can not find module ["+c+"]";c=cc.path;for(var g=0,h=f.length;g<h;g++){var k=f[g];if(!d[k]){var l=c.extname(k);l?".js"===l.toLowerCase()&&e.push(c.join(b,k)):(l=this._getJsListOfModule(a,k,b))&&(e=e.concat(l));d[k]=1}}return e},prepare:function(a){var c=this,b=c.config,d=c.CONFIG_KEY,e=b[d.engineDir],f=cc.loader;if(!cc._supportRender)throw"The renderer doesn't support the renderMode "+
b[d.renderMode];c._prepareCalled=!0;var g=b[d.jsList]||[];cc.Class?f.loadJsWithImg("",g,function(b){if(b)throw b;c._prepared=!0;a&&a()}):(d=cc.path.join(e,"moduleConfig.json"),f.loadJson(d,function(d,f){if(d)throw d;var l=b.modules||[],n=f.module,m=[];cc._renderType===cc._RENDER_TYPE_WEBGL?l.splice(0,0,"shaders"):0>l.indexOf("core")&&l.splice(0,0,"core");for(var p=0,q=l.length;p<q;p++){var s=c._getJsListOfModule(n,l[p],e);s&&(m=m.concat(s))}m=m.concat(g);cc.loader.loadJsWithImg(m,function(b){if(b)throw b;
c._prepared=!0;a&&a()})}))}};cc.game._initConfig();Function.prototype.bind=Function.prototype.bind||function(a){if(!cc.isFunction(this))throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var c=Array.prototype.slice.call(arguments,1),b=this,d=function(){},e=function(){return b.apply(this instanceof d&&a?this:a,c.concat(Array.prototype.slice.call(arguments)))};d.prototype=this.prototype;e.prototype=new d;return e};var cc=cc||{},ClassManager={id:0|998*Math.random(),instanceId:0|998*Math.random(),compileSuper:function(a,c,b){a=a.toString();var d=a.indexOf("("),e=a.indexOf(")"),d=a.substring(d+1,e),d=d.trim(),e=a.indexOf("{"),f=a.lastIndexOf("}");for(a=a.substring(e+1,f);-1!==a.indexOf("this._super");){var e=a.indexOf("this._super"),f=a.indexOf("(",e),g=a.indexOf(")",f),g=a.substring(f+1,g),g=(g=g.trim())?",":"";a=a.substring(0,e)+"ClassManager["+b+"]."+c+".call(this"+g+a.substring(f+1)}return Function(d,a)},
getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}};ClassManager.compileSuper.ClassManager=ClassManager;
(function(){var a=/\b_super\b/,c=cc.game.config[cc.game.CONFIG_KEY.classReleaseMode];c&&console.log("release Mode");cc.Class=function(){};cc.Class.extend=function(b){function d(){this.__instanceId=ClassManager.getNewInstanceId();this.ctor&&this.ctor.apply(this,arguments)}var e=this.prototype,f=Object.create(e),g=ClassManager.getNewID();ClassManager[g]=e;var h={writable:!0,enumerable:!1,configurable:!0};f.__instanceId=null;d.id=g;h.value=g;Object.defineProperty(f,"__pid",h);d.prototype=f;h.value=d;
Object.defineProperty(d.prototype,"constructor",h);this.__getters__&&(d.__getters__=cc.clone(this.__getters__));this.__setters__&&(d.__setters__=cc.clone(this.__setters__));for(var k=0,l=arguments.length;k<l;++k){var n=arguments[k],m;for(m in n){var p="function"===typeof n[m],q="function"===typeof e[m],s=a.test(n[m]);c&&p&&q&&s?(h.value=ClassManager.compileSuper(n[m],m,g),Object.defineProperty(f,m,h)):p&&q&&s?(h.value=function(a,c){return function(){var b=this._super;this._super=e[a];var d=c.apply(this,
arguments);this._super=b;return d}}(m,n[m]),Object.defineProperty(f,m,h)):p?(h.value=n[m],Object.defineProperty(f,m,h)):f[m]=n[m];if(p){var r,u;if(this.__getters__&&this.__getters__[m]){var p=this.__getters__[m],t;for(t in this.__setters__)if(this.__setters__[t]===p){u=t;break}cc.defineGetterSetter(f,p,n[m],n[u]?n[u]:f[u],m,u)}if(this.__setters__&&this.__setters__[m]){p=this.__setters__[m];for(t in this.__getters__)if(this.__getters__[t]===p){r=t;break}cc.defineGetterSetter(f,p,n[r]?n[r]:f[r],n[m],
r,m)}}}}d.extend=cc.Class.extend;d.implement=function(a){for(var c in a)f[c]=a[c]};return d}})();
cc.defineGetterSetter=function(a,c,b,d,e,f){if(a.__defineGetter__)b&&a.__defineGetter__(c,b),d&&a.__defineSetter__(c,d);else if(Object.defineProperty){var g={enumerable:!1,configurable:!0};b&&(g.get=b);d&&(g.set=d);Object.defineProperty(a,c,g)}else throw Error("browser does not support getters");if(!e&&!f)for(var g=null!=b,h=void 0!=d,k=Object.getOwnPropertyNames(a),l=0;l<k.length;l++){var n=k[l];if(!((a.__lookupGetter__?a.__lookupGetter__(n):Object.getOwnPropertyDescriptor(a,n))||"function"!==typeof a[n])){var m=
a[n];if(g&&m===b&&(e=n,!h||f))break;if(h&&m===d&&(f=n,!g||e))break}}a=a.constructor;e&&(a.__getters__||(a.__getters__={}),a.__getters__[e]=c);f&&(a.__setters__||(a.__setters__={}),a.__setters__[f]=c)};cc.clone=function(a){var c=a.constructor?new a.constructor:{},b;for(b in a){var d=a[b];c[b]="object"===typeof d&&d&&!(d instanceof cc.Node)&&!(d instanceof HTMLElement)?cc.clone(d):d}return c};cc.inject=function(a,c){for(var b in a)c[b]=a[b]};cc.Point=function(a,c){this.x=a||0;this.y=c||0};cc.p=function(a,c){return void 0===a?{x:0,y:0}:void 0===c?{x:a.x,y:a.y}:{x:a,y:c}};cc.pointEqualToPoint=function(a,c){return a&&c&&a.x===c.x&&a.y===c.y};cc.Size=function(a,c){this.width=a||0;this.height=c||0};cc.size=function(a,c){return void 0===a?{width:0,height:0}:void 0===c?{width:a.width,height:a.height}:{width:a,height:c}};cc.sizeEqualToSize=function(a,c){return a&&c&&a.width===c.width&&a.height===c.height};
cc.Rect=function(a,c,b,d){this.x=a||0;this.y=c||0;this.width=b||0;this.height=d||0};cc.rect=function(a,c,b,d){return void 0===a?{x:0,y:0,width:0,height:0}:void 0===c?{x:a.x,y:a.y,width:a.width,height:a.height}:{x:a,y:c,width:b,height:d}};cc.rectEqualToRect=function(a,c){return a&&c&&a.x===c.x&&a.y===c.y&&a.width===c.width&&a.height===c.height};cc._rectEqualToZero=function(a){return a&&0===a.x&&0===a.y&&0===a.width&&0===a.height};
cc.rectContainsRect=function(a,c){return!a||!c?!1:!(a.x>=c.x||a.y>=c.y||a.x+a.width<=c.x+c.width||a.y+a.height<=c.y+c.height)};cc.rectGetMaxX=function(a){return a.x+a.width};cc.rectGetMidX=function(a){return a.x+a.width/2};cc.rectGetMinX=function(a){return a.x};cc.rectGetMaxY=function(a){return a.y+a.height};cc.rectGetMidY=function(a){return a.y+a.height/2};cc.rectGetMinY=function(a){return a.y};
cc.rectContainsPoint=function(a,c){return c.x>=cc.rectGetMinX(a)&&c.x<=cc.rectGetMaxX(a)&&c.y>=cc.rectGetMinY(a)&&c.y<=cc.rectGetMaxY(a)};cc.rectIntersectsRect=function(a,c){var b=a.y+a.height,d=c.x+c.width,e=c.y+c.height;return!(a.x+a.width<c.x||d<a.x||b<c.y||e<a.y)};cc.rectOverlapsRect=function(a,c){return!(a.x+a.width<c.x||c.x+c.width<a.x||a.y+a.height<c.y||c.y+c.height<a.y)};
cc.rectUnion=function(a,c){var b=cc.rect(0,0,0,0);b.x=Math.min(a.x,c.x);b.y=Math.min(a.y,c.y);b.width=Math.max(a.x+a.width,c.x+c.width)-b.x;b.height=Math.max(a.y+a.height,c.y+c.height)-b.y;return b};cc.rectIntersection=function(a,c){var b=cc.rect(Math.max(cc.rectGetMinX(a),cc.rectGetMinX(c)),Math.max(cc.rectGetMinY(a),cc.rectGetMinY(c)),0,0);b.width=Math.min(cc.rectGetMaxX(a),cc.rectGetMaxX(c))-cc.rectGetMinX(b);b.height=Math.min(cc.rectGetMaxY(a),cc.rectGetMaxY(c))-cc.rectGetMinY(b);return b};cc.SAXParser=cc.Class.extend({_parser:null,_isSupportDOMParser:null,ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):this._isSupportDOMParser=!1},parse:function(a){return this._parseXML(a)},_parseXML:function(a){var c;this._isSupportDOMParser?c=this._parser.parseFromString(a,"text/xml"):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(a));return c}});
cc.PlistParser=cc.SAXParser.extend({parse:function(a){a=this._parseXML(a).documentElement;if("plist"!==a.tagName)throw"Not a plist file!";for(var c=null,b=0,d=a.childNodes.length;b<d&&!(c=a.childNodes[b],1===c.nodeType);b++);return this._parseNode(c)},_parseNode:function(a){var c=null,b=a.tagName;if("dict"===b)c=this._parseDict(a);else if("array"===b)c=this._parseArray(a);else if("string"===b)if(1===a.childNodes.length)c=a.firstChild.nodeValue;else{c="";for(b=0;b<a.childNodes.length;b++)c+=a.childNodes[b].nodeValue}else"false"===
b?c=!1:"true"===b?c=!0:"real"===b?c=parseFloat(a.firstChild.nodeValue):"integer"===b&&(c=parseInt(a.firstChild.nodeValue,10));return c},_parseArray:function(a){for(var c=[],b=0,d=a.childNodes.length;b<d;b++){var e=a.childNodes[b];1===e.nodeType&&c.push(this._parseNode(e))}return c},_parseDict:function(a){for(var c={},b=null,d=0,e=a.childNodes.length;d<e;d++){var f=a.childNodes[d];1===f.nodeType&&("key"===f.tagName?b=f.firstChild.nodeValue:c[b]=this._parseNode(f))}return c}});cc._txtLoader={load:function(a,c,b,d){cc.loader.loadTxt(a,d)}};cc.loader.register(["txt","xml","vsh","fsh","atlas"],cc._txtLoader);cc._jsonLoader={load:function(a,c,b,d){cc.loader.loadJson(a,d)}};cc.loader.register(["json","ExportJson"],cc._jsonLoader);cc._jsLoader={load:function(a,c,b,d){cc.loader.loadJs(a,d)}};cc.loader.register(["js"],cc._jsLoader);
cc._imgLoader={load:function(a,c,b,d){cc.loader.cache[c]=cc.loader.loadImg(a,function(a,b){if(a)return d(a);cc.textureCache.handleLoadedTexture(c);d(null,b)})}};cc.loader.register("png jpg bmp jpeg gif ico".split(" "),cc._imgLoader);cc._serverImgLoader={load:function(a,c,b,d){cc.loader.cache[c]=cc.loader.loadImg(b.src,function(a,b){if(a)return d(a);cc.textureCache.handleLoadedTexture(c);d(null,b)})}};cc.loader.register(["serverImg"],cc._serverImgLoader);
cc._plistLoader={load:function(a,c,b,d){cc.loader.loadTxt(a,function(a,c){if(a)return d(a);d(null,cc.plistParser.parse(c))})}};cc.loader.register(["plist"],cc._plistLoader);
cc._fontLoader={TYPE:{".eot":"embedded-opentype",".ttf":"truetype",".woff":"woff",".svg":"svg"},_loadFont:function(a,c,b){var d=document,e=cc.path,f=this.TYPE,g=cc.newElement("style");g.type="text/css";d.body.appendChild(g);var h="@font-face { font-family:"+a+"; src:";if(c instanceof Array)for(var k=0,l=c.length;k<l;k++)b=e.extname(c[k]).toLowerCase(),h+="url('"+c[k]+"') format('"+f[b]+"')",h+=k===l-1?";":",";else h+="url('"+c+"') format('"+f[b]+"');";g.textContent+=h+"};";c=cc.newElement("div");
b=c.style;b.fontFamily=a;c.innerHTML=".";b.position="absolute";b.left="-100px";b.top="-100px";d.body.appendChild(c)},load:function(a,c,b,d){c=b.type;a=b.name;c=b.srcs;cc.isString(b)?(c=cc.path.extname(b),a=cc.path.basename(b,c),this._loadFont(a,b,c)):this._loadFont(a,c);d(null,!0)}};cc.loader.register(["font","eot","ttf","woff","svg"],cc._fontLoader);cc._binaryLoader={load:function(a,c,b,d){cc.loader.loadBinary(a,d)}};cc._csbLoader={load:function(a,c,b,d){cc.loader.loadCsb(a,d)}};
cc.loader.register(["csb"],cc._csbLoader);window.CocosEngine=cc.ENGINE_VERSION="Cocos2d-JS v3.6";cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0;cc.DIRECTOR_STATS_POSITION=cc.p(0,0);cc.DIRECTOR_FPS_INTERVAL=0.5;cc.COCOSNODE_RENDER_SUBPIXEL=1;cc.SPRITEBATCHNODE_RENDER_SUBPIXEL=1;cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=0;cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0;cc.TEXTURE_ATLAS_USE_VAO=0;cc.TEXTURE_NPOT_SUPPORT=0;cc.RETINA_DISPLAY_SUPPORT=1;cc.RETINA_DISPLAY_FILENAME_SUFFIX="-hd";cc.USE_LA88_LABELS=1;cc.SPRITE_DEBUG_DRAW=0;
cc.SPRITEBATCHNODE_DEBUG_DRAW=0;cc.LABELBMFONT_DEBUG_DRAW=0;cc.LABELATLAS_DEBUG_DRAW=0;cc.IS_RETINA_DISPLAY_SUPPORTED=1;cc.DEFAULT_ENGINE=cc.ENGINE_VERSION+"-canvas";cc.ENABLE_STACKABLE_ACTIONS=1;cc.ENABLE_GL_STATE_CACHE=1;cc.$=function(a){var c=this===cc?document:this;if(a=a instanceof HTMLElement?a:c.querySelector(a))a.find=a.find||cc.$,a.hasClass=a.hasClass||function(a){return this.className.match(RegExp("(\\s|^)"+a+"(\\s|$)"))},a.addClass=a.addClass||function(a){this.hasClass(a)||(this.className&&(this.className+=" "),this.className+=a);return this},a.removeClass=a.removeClass||function(a){this.hasClass(a)&&(this.className=this.className.replace(a,""));return this},a.remove=a.remove||function(){this.parentNode&&
this.parentNode.removeChild(this);return this},a.appendTo=a.appendTo||function(a){a.appendChild(this);return this},a.prependTo=a.prependTo||function(a){a.childNodes[0]?a.insertBefore(this,a.childNodes[0]):a.appendChild(this);return this},a.transforms=a.transforms||function(){this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew);return this},a.position=a.position||{x:0,y:0},a.rotation=a.rotation||0,a.scale=a.scale||{x:1,y:1},a.skew=
a.skew||{x:0,y:0},a.translates=function(a,c){this.position.x=a;this.position.y=c;this.transforms();return this},a.rotate=function(a){this.rotation=a;this.transforms();return this},a.resize=function(a,c){this.scale.x=a;this.scale.y=c;this.transforms();return this},a.setSkew=function(a,c){this.skew.x=a;this.skew.y=c;this.transforms();return this};return a};
switch(cc.sys.browserType){case cc.sys.BROWSER_TYPE_FIREFOX:cc.$.pfx="Moz";cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_CHROME:case cc.sys.BROWSER_TYPE_SAFARI:cc.$.pfx="webkit";cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_OPERA:cc.$.pfx="O";cc.$.hd=!1;break;case cc.sys.BROWSER_TYPE_IE:cc.$.pfx="ms";cc.$.hd=!1;break;default:cc.$.pfx="webkit",cc.$.hd=!0}cc.$.trans=cc.$.pfx+"Transform";
cc.$.translate=cc.$.hd?function(a){return"translate3d("+a.x+"px, "+a.y+"px, 0) "}:function(a){return"translate("+a.x+"px, "+a.y+"px) "};cc.$.rotate=cc.$.hd?function(a){return"rotateZ("+a+"deg) "}:function(a){return"rotate("+a+"deg) "};cc.$.scale=function(a){return"scale("+a.x+", "+a.y+") "};cc.$.skew=function(a){return"skewX("+-a.x+"deg) skewY("+a.y+"deg)"};cc.$new=function(a){return cc.$(document.createElement(a))};
cc.$.findpos=function(a){var c=0,b=0;do c+=a.offsetLeft,b+=a.offsetTop;while(a=a.offsetParent);return{x:c,y:b}};cc.INVALID_INDEX=-1;cc.PI=Math.PI;cc.FLT_MAX=parseFloat("3.402823466e+38F");cc.FLT_MIN=parseFloat("1.175494351e-38F");cc.RAD=cc.PI/180;cc.DEG=180/cc.PI;cc.UINT_MAX=4294967295;cc.swap=function(a,c,b){if(cc.isObject(b)&&!cc.isUndefined(b.x)&&!cc.isUndefined(b.y)){var d=b[a];b[a]=b[c];b[c]=d}else cc.log(cc._LogInfos.swap)};cc.lerp=function(a,c,b){return a+(c-a)*b};cc.rand=function(){return 16777215*Math.random()};cc.randomMinus1To1=function(){return 2*(Math.random()-0.5)};cc.random0To1=Math.random;
cc.degreesToRadians=function(a){return a*cc.RAD};cc.radiansToDegrees=function(a){return a*cc.DEG};cc.radiansToDegress=function(a){cc.log(cc._LogInfos.radiansToDegress);return a*cc.DEG};cc.REPEAT_FOREVER=Number.MAX_VALUE-1;cc.BLEND_SRC=cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA?1:770;cc.BLEND_DST=771;cc.nodeDrawSetup=function(a){a._shaderProgram&&(a._shaderProgram.use(),a._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())};cc.enableDefaultGLStates=function(){};
cc.disableDefaultGLStates=function(){};cc.incrementGLDraws=function(a){cc.g_NumberOfDraws+=a};cc.FLT_EPSILON=1.192092896E-7;cc.contentScaleFactor=cc.IS_RETINA_DISPLAY_SUPPORTED?function(){return cc.director.getContentScaleFactor()}:function(){return 1};cc.pointPointsToPixels=function(a){var c=cc.contentScaleFactor();return cc.p(a.x*c,a.y*c)};cc.pointPixelsToPoints=function(a){var c=cc.contentScaleFactor();return cc.p(a.x/c,a.y/c)};
cc._pointPixelsToPointsOut=function(a,c){var b=cc.contentScaleFactor();c.x=a.x/b;c.y=a.y/b};cc.sizePointsToPixels=function(a){var c=cc.contentScaleFactor();return cc.size(a.width*c,a.height*c)};cc.sizePixelsToPoints=function(a){var c=cc.contentScaleFactor();return cc.size(a.width/c,a.height/c)};cc._sizePixelsToPointsOut=function(a,c){var b=cc.contentScaleFactor();c.width=a.width/b;c.height=a.height/b};
cc.rectPixelsToPoints=cc.IS_RETINA_DISPLAY_SUPPORTED?function(a){var c=cc.contentScaleFactor();return cc.rect(a.x/c,a.y/c,a.width/c,a.height/c)}:function(a){return a};cc.rectPointsToPixels=cc.IS_RETINA_DISPLAY_SUPPORTED?function(a){var c=cc.contentScaleFactor();return cc.rect(a.x*c,a.y*c,a.width*c,a.height*c)}:function(a){return a};cc.ONE=1;cc.ZERO=0;cc.SRC_ALPHA=770;cc.SRC_ALPHA_SATURATE=776;cc.SRC_COLOR=768;cc.DST_ALPHA=772;cc.DST_COLOR=774;cc.ONE_MINUS_SRC_ALPHA=771;cc.ONE_MINUS_SRC_COLOR=769;
cc.ONE_MINUS_DST_ALPHA=773;cc.ONE_MINUS_DST_COLOR=775;cc.ONE_MINUS_CONSTANT_ALPHA=32772;cc.ONE_MINUS_CONSTANT_COLOR=32770;cc.LINEAR=9729;cc.REPEAT=10497;cc.CLAMP_TO_EDGE=33071;cc.MIRRORED_REPEAT=33648;cc.checkGLErrorDebug=function(){if(cc.renderMode===cc._RENDER_TYPE_WEBGL){var a=cc._renderContext.getError();a&&cc.log(cc._LogInfos.checkGLErrorDebug,a)}};cc.DEVICE_ORIENTATION_PORTRAIT=0;cc.DEVICE_ORIENTATION_LANDSCAPE_LEFT=1;cc.DEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN=2;
cc.DEVICE_ORIENTATION_LANDSCAPE_RIGHT=3;cc.DEVICE_MAX_ORIENTATIONS=2;cc.VERTEX_ATTRIB_FLAG_NONE=0;cc.VERTEX_ATTRIB_FLAG_POSITION=1;cc.VERTEX_ATTRIB_FLAG_COLOR=2;cc.VERTEX_ATTRIB_FLAG_TEX_COORDS=4;cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX=cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS;cc.GL_ALL=0;cc.VERTEX_ATTRIB_POSITION=0;cc.VERTEX_ATTRIB_COLOR=1;cc.VERTEX_ATTRIB_TEX_COORDS=2;cc.VERTEX_ATTRIB_MAX=3;cc.UNIFORM_PMATRIX=0;cc.UNIFORM_MVMATRIX=1;
cc.UNIFORM_MVPMATRIX=2;cc.UNIFORM_TIME=3;cc.UNIFORM_SINTIME=4;cc.UNIFORM_COSTIME=5;cc.UNIFORM_RANDOM01=6;cc.UNIFORM_SAMPLER=7;cc.UNIFORM_MAX=8;cc.SHADER_POSITION_TEXTURECOLOR="ShaderPositionTextureColor";cc.SHADER_POSITION_TEXTURECOLORALPHATEST="ShaderPositionTextureColorAlphaTest";cc.SHADER_POSITION_COLOR="ShaderPositionColor";cc.SHADER_POSITION_TEXTURE="ShaderPositionTexture";cc.SHADER_POSITION_TEXTURE_UCOLOR="ShaderPositionTexture_uColor";cc.SHADER_POSITION_TEXTUREA8COLOR="ShaderPositionTextureA8Color";
cc.SHADER_POSITION_UCOLOR="ShaderPosition_uColor";cc.SHADER_POSITION_LENGTHTEXTURECOLOR="ShaderPositionLengthTextureColor";cc.UNIFORM_PMATRIX_S="CC_PMatrix";cc.UNIFORM_MVMATRIX_S="CC_MVMatrix";cc.UNIFORM_MVPMATRIX_S="CC_MVPMatrix";cc.UNIFORM_TIME_S="CC_Time";cc.UNIFORM_SINTIME_S="CC_SinTime";cc.UNIFORM_COSTIME_S="CC_CosTime";cc.UNIFORM_RANDOM01_S="CC_Random01";cc.UNIFORM_SAMPLER_S="CC_Texture0";cc.UNIFORM_ALPHA_TEST_VALUE_S="CC_alpha_value";cc.ATTRIBUTE_NAME_COLOR="a_color";
cc.ATTRIBUTE_NAME_POSITION="a_position";cc.ATTRIBUTE_NAME_TEX_COORD="a_texCoord";cc.ITEM_SIZE=32;cc.CURRENT_ITEM=3233828865;cc.ZOOM_ACTION_TAG=3233828866;cc.NORMAL_TAG=8801;cc.SELECTED_TAG=8802;cc.DISABLE_TAG=8803;cc.arrayVerifyType=function(a,c){if(a&&0<a.length)for(var b=0;b<a.length;b++)if(!(a[b]instanceof c))return cc.log("element type is wrong!"),!1;return!0};cc.arrayRemoveObject=function(a,c){for(var b=0,d=a.length;b<d;b++)if(a[b]===c){a.splice(b,1);break}};
cc.arrayRemoveArray=function(a,c){for(var b=0,d=c.length;b<d;b++)cc.arrayRemoveObject(a,c[b])};cc.arrayAppendObjectsToIndex=function(a,c,b){a.splice.apply(a,[b,0].concat(c));return a};cc.copyArray=function(a){var c,b=a.length,d=Array(b);for(c=0;c<b;c+=1)d[c]=a[c];return d};cc._tmp.PrototypeColor=function(){var a=cc.color;a._getWhite=function(){return a(255,255,255)};a._getYellow=function(){return a(255,255,0)};a._getBlue=function(){return a(0,0,255)};a._getGreen=function(){return a(0,255,0)};a._getRed=function(){return a(255,0,0)};a._getMagenta=function(){return a(255,0,255)};a._getBlack=function(){return a(0,0,0)};a._getOrange=function(){return a(255,127,0)};a._getGray=function(){return a(166,166,166)};cc.defineGetterSetter(a,"WHITE",a._getWhite);cc.defineGetterSetter(a,
"YELLOW",a._getYellow);cc.defineGetterSetter(a,"BLUE",a._getBlue);cc.defineGetterSetter(a,"GREEN",a._getGreen);cc.defineGetterSetter(a,"RED",a._getRed);cc.defineGetterSetter(a,"MAGENTA",a._getMagenta);cc.defineGetterSetter(a,"BLACK",a._getBlack);cc.defineGetterSetter(a,"ORANGE",a._getOrange);cc.defineGetterSetter(a,"GRAY",a._getGray);cc.BlendFunc._disable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)};cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA)};
cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)};cc.BlendFunc._additive=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE)};cc.defineGetterSetter(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable);cc.defineGetterSetter(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied);cc.defineGetterSetter(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied);cc.defineGetterSetter(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive)};cc.Color=function(a,c,b,d){this.r=a||0;this.g=c||0;this.b=b||0;this.a=null==d?255:d};cc.color=function(a,c,b,d){return void 0===a?{r:0,g:0,b:0,a:255}:cc.isString(a)?cc.hexToColor(a):cc.isObject(a)?{r:a.r,g:a.g,b:a.b,a:null==a.a?255:a.a}:{r:a,g:c,b:b,a:null==d?255:d}};cc.colorEqual=function(a,c){return a.r===c.r&&a.g===c.g&&a.b===c.b};cc.Acceleration=function(a,c,b,d){this.x=a||0;this.y=c||0;this.z=b||0;this.timestamp=d||0};cc.Vertex2F=function(a,c){this.x=a||0;this.y=c||0};
cc.vertex2=function(a,c){return new cc.Vertex2F(a,c)};cc.Vertex3F=function(a,c,b){this.x=a||0;this.y=c||0;this.z=b||0};cc.vertex3=function(a,c,b){return new cc.Vertex3F(a,c,b)};cc.Tex2F=function(a,c){this.u=a||0;this.v=c||0};cc.tex2=function(a,c){return new cc.Tex2F(a,c)};cc.BlendFunc=function(a,c){this.src=a;this.dst=c};cc.blendFuncDisable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)};cc.hexToColor=function(a){a=a.replace(/^#?/,"0x");a=parseInt(a);return cc.color(a>>16,(a>>8)%256,a%256)};
cc.colorToHex=function(a){var c=a.r.toString(16),b=a.g.toString(16),d=a.b.toString(16);return"#"+(16>a.r?"0"+c:c)+(16>a.g?"0"+b:b)+(16>a.b?"0"+d:d)};cc.TEXT_ALIGNMENT_LEFT=0;cc.TEXT_ALIGNMENT_CENTER=1;cc.TEXT_ALIGNMENT_RIGHT=2;cc.VERTICAL_TEXT_ALIGNMENT_TOP=0;cc.VERTICAL_TEXT_ALIGNMENT_CENTER=1;cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM=2;
cc._Dictionary=cc.Class.extend({_keyMapTb:null,_valueMapTb:null,__currId:0,ctor:function(){this._keyMapTb={};this._valueMapTb={};this.__currId=2<<(0|10*Math.random())},__getKey:function(){this.__currId++;return"key_"+this.__currId},setObject:function(a,c){if(null!=c){var b=this.__getKey();this._keyMapTb[b]=c;this._valueMapTb[b]=a}},objectForKey:function(a){if(null==a)return null;var c=this._keyMapTb,b;for(b in c)if(c[b]===a)return this._valueMapTb[b];return null},valueForKey:function(a){return this.objectForKey(a)},
removeObjectForKey:function(a){if(null!=a){var c=this._keyMapTb,b;for(b in c)if(c[b]===a){delete this._valueMapTb[b];delete c[b];break}}},removeObjectsForKeys:function(a){if(null!=a)for(var c=0;c<a.length;c++)this.removeObjectForKey(a[c])},allKeys:function(){var a=[],c=this._keyMapTb,b;for(b in c)a.push(c[b]);return a},removeAllObjects:function(){this._keyMapTb={};this._valueMapTb={}},count:function(){return this.allKeys().length}});
cc.FontDefinition=function(a){this.fontName="Arial";this.fontSize=12;this.textAlign=cc.TEXT_ALIGNMENT_CENTER;this.verticalAlign=cc.VERTICAL_TEXT_ALIGNMENT_TOP;this.fillStyle=cc.color(255,255,255,255);this.boundingHeight=this.boundingWidth=0;this.strokeEnabled=!1;this.strokeStyle=cc.color(255,255,255,255);this.lineWidth=1;this.fontWeight=this.fontStyle=this.lineHeight="normal";this.shadowEnabled=!1;this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.shadowOpacity=1;if(a&&a instanceof Object)for(var c in a)this[c]=
a[c]};cc.FontDefinition.prototype._getCanvasFontStr=function(){return this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px/"+(!this.lineHeight.charAt?this.lineHeight+"px":this.lineHeight)+" '"+this.fontName+"'"};cc._renderType===cc._RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLColor),cc._LogInfos.MissingFile,"CCTypesWebGL.js"),cc._tmp.WebGLColor(),delete cc._tmp.WebGLColor);cc.assert(cc.isFunction(cc._tmp.PrototypeColor),cc._LogInfos.MissingFile,"CCTypesPropertyDefine.js");cc._tmp.PrototypeColor();
delete cc._tmp.PrototypeColor;cc.Touches=[];cc.TouchesIntergerDict={};cc.DENSITYDPI_DEVICE="device-dpi";cc.DENSITYDPI_HIGH="high-dpi";cc.DENSITYDPI_MEDIUM="medium-dpi";cc.DENSITYDPI_LOW="low-dpi";cc.__BrowserGetter={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(a){return!a||a===this.html?window.innerWidth:a.clientWidth},availHeight:function(a){return!a||a===this.html?window.innerHeight:a.clientHeight},meta:{width:"device-width","user-scalable":"no"},adaptationType:cc.sys.browserType};
-1<window.navigator.userAgent.indexOf("OS 8_1_")&&(cc.__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_MIUI);cc.sys.os===cc.sys.OS_IOS&&(cc.__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_SAFARI);
switch(cc.__BrowserGetter.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:cc.__BrowserGetter.meta["minimal-ui"]="true";cc.__BrowserGetter.availWidth=function(a){return a.clientWidth};cc.__BrowserGetter.availHeight=function(a){return a.clientHeight};break;case cc.sys.BROWSER_TYPE_CHROME:cc.__BrowserGetter.__defineGetter__("target-densitydpi",function(){return cc.view._targetDensityDPI});case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:cc.__BrowserGetter.availWidth=function(a){return a.clientWidth};
cc.__BrowserGetter.availHeight=function(a){return a.clientHeight};break;case cc.sys.BROWSER_TYPE_MIUI:cc.__BrowserGetter.init=function(a){if(!a.__resizeWithBrowserSize){var c=function(){a.setDesignResolutionSize(a._designResolutionSize.width,a._designResolutionSize.height,a._resolutionPolicy);window.removeEventListener("resize",c,!1)};window.addEventListener("resize",c,!1)}}}
cc.EGLView=cc.Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:!1,_autoFullScreen:!0,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_indexBitsUsed:0,_maxTouches:5,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_captured:!1,_wnd:null,_hDC:null,_hRC:null,
_supportTouch:!1,_contentTranslateLeftTop:null,_frame:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,_targetDensityDPI:null,ctor:function(){var a=document,c=cc.ContainerStrategy,b=cc.ContentStrategy;cc.__BrowserGetter.init(this);this._frame=cc.container.parentNode===a.body?a.documentElement:cc.container.parentNode;this._frameSize=cc.size(0,0);this._initFrameSize();var a=cc._canvas.width,d=cc._canvas.height;this._designResolutionSize=cc.size(a,d);this._originalDesignResolutionSize=
cc.size(a,d);this._viewPortRect=cc.rect(0,0,a,d);this._visibleRect=cc.rect(0,0,a,d);this._contentTranslateLeftTop={left:0,top:0};this._viewName="Cocos2dHTML5";a=cc.sys;this.enableRetina(a.os===a.OS_IOS||a.os===a.OS_OSX);cc.visibleRect&&cc.visibleRect.init(this._visibleRect);this._rpExactFit=new cc.ResolutionPolicy(c.EQUAL_TO_FRAME,b.EXACT_FIT);this._rpShowAll=new cc.ResolutionPolicy(c.PROPORTION_TO_FRAME,b.SHOW_ALL);this._rpNoBorder=new cc.ResolutionPolicy(c.EQUAL_TO_FRAME,b.NO_BORDER);this._rpFixedHeight=
new cc.ResolutionPolicy(c.EQUAL_TO_FRAME,b.FIXED_HEIGHT);this._rpFixedWidth=new cc.ResolutionPolicy(c.EQUAL_TO_FRAME,b.FIXED_WIDTH);this._hDC=cc._canvas;this._hRC=cc._renderContext;this._targetDensityDPI=cc.DENSITYDPI_HIGH},_resizeEvent:function(){var a;a=this.setDesignResolutionSize?this:cc.view;var c=a._frameSize.width,b=a._frameSize.height;a._initFrameSize();a._frameSize.width===c&&a._frameSize.height===b||(a._resizeCallback&&a._resizeCallback.call(),c=a._originalDesignResolutionSize.width,b=a._originalDesignResolutionSize.height,
0<c&&a.setDesignResolutionSize(c,b,a._resolutionPolicy))},setTargetDensityDPI:function(a){this._targetDensityDPI=a;this._setViewPortMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(a){a?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,cc._addEventListener(window,"resize",this._resizeEvent),cc._addEventListener(window,"orientationchange",this._resizeEvent)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",
this._resizeEvent),window.removeEventListener("orientationchange",this._resizeEvent))},setResizeCallback:function(a){if(cc.isFunction(a)||null==a)this._resizeCallback=a},_initFrameSize:function(){var a=this._frameSize;a.width=cc.__BrowserGetter.availWidth(this._frame);a.height=cc.__BrowserGetter.availHeight(this._frame)},_adjustSizeKeepCanvasSize:function(){var a=this._originalDesignResolutionSize.width,c=this._originalDesignResolutionSize.height;0<a&&this.setDesignResolutionSize(a,c,this._resolutionPolicy)},
_setViewPortMeta:function(){if(this._isAdjustViewPort){var a=document.getElementById("cocosMetaElement");a&&document.head.removeChild(a);var c,b=(a=document.getElementsByName("viewport"))?a[0]:null,d,a=cc.newElement("meta");a.id="cocosMetaElement";a.name="viewport";a.content="";c=cc.__BrowserGetter.meta;d=b?b.content:"";for(var e in c)RegExp(e).test(d)||(d+=","+e+"\x3d"+c[e]);/^,/.test(d)&&(d=d.substr(1));a.content=d;b&&(b.content=d);document.head.appendChild(a)}},_setScaleXYForRenderTexture:function(){var a=
cc.contentScaleFactor();this._scaleY=this._scaleX=a},_resetScale:function(){this._scaleX=this._originalScaleX;this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(a){this._isAdjustViewPort=a},enableRetina:function(a){this._retinaEnabled=a?!0:!1},isRetinaEnabled:function(){return this._retinaEnabled},enableAutoFullScreen:function(a){this._autoFullScreen=a?!0:!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},
end:function(){},isOpenGLReady:function(){return null!==this._hDC&&null!==this._hRC},setFrameZoomFactor:function(a){this._frameZoomFactor=a;this.centerWindow();cc.director.setProjection(cc.director.getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(a){},setContentTranslateLeftTop:function(a,c){this._contentTranslateLeftTop={left:a,top:c}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},
setFrameSize:function(a,c){this._frameSize.width=a;this._frameSize.height=c;this._frame.style.width=a+"px";this._frame.style.height=c+"px";this._resizeEvent();cc.director.setProjection(cc.director.getProjection())},centerWindow:function(){},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},
setResolutionPolicy:function(a){if(a instanceof cc.ResolutionPolicy)this._resolutionPolicy=a;else{var c=cc.ResolutionPolicy;a===c.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit);a===c.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll);a===c.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder);a===c.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight);a===c.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},setDesignResolutionSize:function(a,c,b){if(0<a||0<c)if(this.setResolutionPolicy(b),
b=this._resolutionPolicy){b.preApply(this);cc.sys.isMobile&&this._setViewPortMeta();this._initFrameSize();this._originalDesignResolutionSize.width=this._designResolutionSize.width=a;this._originalDesignResolutionSize.height=this._designResolutionSize.height=c;var d=b.apply(this,this._designResolutionSize);d.scale&&2===d.scale.length&&(this._scaleX=d.scale[0],this._scaleY=d.scale[1]);d.viewport&&(a=this._viewPortRect,c=this._visibleRect,d=d.viewport,a.x=d.x,a.y=d.y,a.width=d.width,a.height=d.height,
c.x=-a.x/this._scaleX,c.y=-a.y/this._scaleY,c.width=cc._canvas.width/this._scaleX,c.height=cc._canvas.height/this._scaleY,cc._renderContext.setOffset&&cc._renderContext.setOffset(a.x,-a.y));a=cc.director;a._winSizeInPoints.width=this._designResolutionSize.width;a._winSizeInPoints.height=this._designResolutionSize.height;b.postApply(this);cc.winSize.width=a._winSizeInPoints.width;cc.winSize.height=a._winSizeInPoints.height;cc._renderType===cc._RENDER_TYPE_WEBGL&&(a._createStatsLabel(),a.setGLDefaultValues());
this._originalScaleX=this._scaleX;this._originalScaleY=this._scaleY;cc.DOM&&cc.DOM._resetEGLViewDiv();cc.visibleRect&&cc.visibleRect.init(this._visibleRect)}else cc.log(cc._LogInfos.EGLView_setDesignResolutionSize_2);else cc.log(cc._LogInfos.EGLView_setDesignResolutionSize)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setViewPortInPoints:function(a,c,b,d){var e=this._frameZoomFactor,f=this._scaleX,g=this._scaleY;cc._renderContext.viewport(a*
f*e+this._viewPortRect.x*e,c*g*e+this._viewPortRect.y*e,b*f*e,d*g*e)},setScissorInPoints:function(a,c,b,d){var e=this._frameZoomFactor,f=this._scaleX,g=this._scaleY;cc._renderContext.scissor(a*f*e+this._viewPortRect.x*e,c*g*e+this._viewPortRect.y*e,b*f*e,d*g*e)},isScissorEnabled:function(){var a=cc._renderContext;return a.isEnabled(a.SCISSOR_TEST)},getScissorRect:function(){var a=cc._renderContext,c=this._scaleX,b=this._scaleY,a=a.getParameter(a.SCISSOR_BOX);return cc.rect((a[0]-this._viewPortRect.x)/
c,(a[1]-this._viewPortRect.y)/b,a[2]/c,a[3]/b)},setViewName:function(a){null!=a&&0<a.length&&(this._viewName=a)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(a,c,b){return{x:this._devicePixelRatio*(a-b.left),y:this._devicePixelRatio*(b.top+b.height-c)}},_convertMouseToLocationInView:function(a,
c){var b=this._viewPortRect;a.x=(this._devicePixelRatio*(a.x-c.left)-b.x)/this._scaleX;a.y=(this._devicePixelRatio*(c.top+c.height-a.y)-b.y)/this._scaleY},_convertTouchesWithScale:function(a){for(var c=this._viewPortRect,b=this._scaleX,d=this._scaleY,e,f,g,h=0;h<a.length;h++)e=a[h],f=e._point,g=e._prevPoint,e._setPoint((f.x-c.x)/b,(f.y-c.y)/d),e._setPrevPoint((g.x-c.x)/b,(g.y-c.y)/d)}});
cc.EGLView._getInstance=function(){this._instance||(this._instance=this._instance||new cc.EGLView,this._instance.initialize());return this._instance};
cc.ContainerStrategy=cc.Class.extend({preApply:function(a){},apply:function(a,c){},postApply:function(a){},_setupContainer:function(a,c,b){var d=a._frame;cc.view._autoFullScreen&&(cc.sys.isMobile&&d===document.documentElement)&&cc.screen.autoFullScreen(d);var d=cc._canvas,e=cc.container;e.style.width=d.style.width=c+"px";e.style.height=d.style.height=b+"px";e=a._devicePixelRatio=1;a.isRetinaEnabled()&&(e=a._devicePixelRatio=window.devicePixelRatio||1);d.width=c*e;d.height=b*e;cc._renderContext.resetCache&&
cc._renderContext.resetCache();a=document.body;var f;if(a&&(f=a.style))f.paddingTop=f.paddingTop||"0px",f.paddingRight=f.paddingRight||"0px",f.paddingBottom=f.paddingBottom||"0px",f.paddingLeft=f.paddingLeft||"0px",f.borderTop=f.borderTop||"0px",f.borderRight=f.borderRight||"0px",f.borderBottom=f.borderBottom||"0px",f.borderLeft=f.borderLeft||"0px",f.marginTop=f.marginTop||"0px",f.marginRight=f.marginRight||"0px",f.marginBottom=f.marginBottom||"0px",f.marginLeft=f.marginLeft||"0px"},_fixContainer:function(){document.body.insertBefore(cc.container,
document.body.firstChild);var a=document.body.style;a.width=window.innerWidth+"px";a.height=window.innerHeight+"px";a.overflow="hidden";a=cc.container.style;a.position="fixed";a.left=a.top="0px";document.body.scrollTop=0}});
cc.ContentStrategy=cc.Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(a,c,b,d,e,f){2>Math.abs(a-b)&&(b=a);2>Math.abs(c-d)&&(d=c);a=cc.rect(Math.round((a-b)/2),Math.round((c-d)/2),b,d);this._result.scale=[e,f];this._result.viewport=a;return this._result},preApply:function(a){},apply:function(a,c){return{scale:[1,1]}},postApply:function(a){}});
(function(){var a=cc.ContainerStrategy.extend({apply:function(a){this._setupContainer(a,a._frameSize.width,a._frameSize.height)}}),c=cc.ContainerStrategy.extend({apply:function(a,c){var b=a._frameSize.width,d=a._frameSize.height,e=cc.container.style,n=c.width,m=c.height,p=b/n,q=d/m,s,r;p<q?(s=b,r=m*p):(s=n*q,r=d);n=Math.round((b-s)/2);r=Math.round((d-r)/2);this._setupContainer(a,b-2*n,d-2*r);e.marginLeft=n+"px";e.marginRight=n+"px";e.marginTop=r+"px";e.marginBottom=r+"px"}});a.extend({preApply:function(a){this._super(a);
a._frame=document.documentElement},apply:function(a){this._super(a);this._fixContainer()}});c.extend({preApply:function(a){this._super(a);a._frame=document.documentElement},apply:function(a,c){this._super(a,c);this._fixContainer()}});var b=cc.ContainerStrategy.extend({apply:function(a){this._setupContainer(a,cc._canvas.width,cc._canvas.height)}});cc.ContainerStrategy.EQUAL_TO_FRAME=new a;cc.ContainerStrategy.PROPORTION_TO_FRAME=new c;cc.ContainerStrategy.ORIGINAL_CONTAINER=new b;var a=cc.ContentStrategy.extend({apply:function(a,
c){var b=cc._canvas.width,d=cc._canvas.height;return this._buildResult(b,d,b,d,b/c.width,d/c.height)}}),c=cc.ContentStrategy.extend({apply:function(a,c){var b=cc._canvas.width,d=cc._canvas.height,e=c.width,n=c.height,m=b/e,p=d/n,q=0,s,r;m<p?(q=m,s=b,r=n*q):(q=p,s=e*q,r=d);return this._buildResult(b,d,s,r,q,q)}}),b=cc.ContentStrategy.extend({apply:function(a,c){var b=cc._canvas.width,d=cc._canvas.height,e=c.width,n=c.height,m=b/e,p=d/n,q,s,r;m<p?(q=p,s=e*q,r=d):(q=m,s=b,r=n*q);return this._buildResult(b,
d,s,r,q,q)}}),d=cc.ContentStrategy.extend({apply:function(a,c){var b=cc._canvas.width,d=cc._canvas.height,e=d/c.height;return this._buildResult(b,d,b,d,e,e)},postApply:function(a){cc.director._winSizeInPoints=a.getVisibleSize()}}),e=cc.ContentStrategy.extend({apply:function(a,c){var b=cc._canvas.width,d=cc._canvas.height,e=b/c.width;return this._buildResult(b,d,b,d,e,e)},postApply:function(a){cc.director._winSizeInPoints=a.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new a;cc.ContentStrategy.SHOW_ALL=
new c;cc.ContentStrategy.NO_BORDER=new b;cc.ContentStrategy.FIXED_HEIGHT=new d;cc.ContentStrategy.FIXED_WIDTH=new e})();
cc.ResolutionPolicy=cc.Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(a,c){this.setContainerStrategy(a);this.setContentStrategy(c)},preApply:function(a){this._containerStrategy.preApply(a);this._contentStrategy.preApply(a)},apply:function(a,c){this._containerStrategy.apply(a,c);return this._contentStrategy.apply(a,c)},postApply:function(a){this._containerStrategy.postApply(a);this._contentStrategy.postApply(a)},setContainerStrategy:function(a){a instanceof cc.ContainerStrategy&&
(this._containerStrategy=a)},setContentStrategy:function(a){a instanceof cc.ContentStrategy&&(this._contentStrategy=a)}});cc.ResolutionPolicy.EXACT_FIT=0;cc.ResolutionPolicy.NO_BORDER=1;cc.ResolutionPolicy.SHOW_ALL=2;cc.ResolutionPolicy.FIXED_HEIGHT=3;cc.ResolutionPolicy.FIXED_WIDTH=4;cc.ResolutionPolicy.UNKNOWN=5;cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(a){var c=this.width=a.width,b=this.height=a.height,d=a.x;a=a.y;var e=a+b,f=d+c;this.topLeft.x=d;this.topLeft.y=e;this.topRight.x=f;this.topRight.y=e;this.top.x=d+c/2;this.top.y=e;this.bottomLeft.x=d;this.bottomLeft.y=a;this.bottomRight.x=f;this.bottomRight.y=a;this.bottom.x=d+c/2;this.bottom.y=
a;this.center.x=d+c/2;this.center.y=a+b/2;this.left.x=d;this.left.y=a+b/2;this.right.x=f;this.right.y=a+b/2}};cc.UIInterfaceOrientationLandscapeLeft=-90;cc.UIInterfaceOrientationLandscapeRight=90;cc.UIInterfaceOrientationPortraitUpsideDown=180;cc.UIInterfaceOrientationPortrait=0;
cc.inputManager={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var a=this._indexBitsUsed,c=0;c<this._maxTouches;c++){if(!(a&1))return this._indexBitsUsed|=1<<c,c;a>>=1}return-1},_removeUsedIndexBit:function(a){0>a||
a>=this._maxTouches||(a=~(1<<a),this._indexBitsUsed&=a)},_glView:null,handleTouchesBegin:function(a){for(var c,b,d,e=[],f=this._touchesIntegerDict,g=0,h=a.length;g<h;g++)if(c=a[g],d=c.getID(),b=f[d],null==b){var k=this._getUnUsedIndex();-1===k?cc.log(cc._LogInfos.inputManager_handleTouchesBegin,k):(b=this._touches[k]=new cc.Touch(c._point.x,c._point.y,c.getID()),b._setPrevPoint(c._prevPoint),f[d]=k,e.push(b))}0<e.length&&(this._glView._convertTouchesWithScale(e),a=new cc.EventTouch(e),a._eventCode=
cc.EventTouch.EventCode.BEGAN,cc.eventManager.dispatchEvent(a))},handleTouchesMove:function(a){for(var c,b,d=[],e=this._touches,f=0,g=a.length;f<g;f++)c=a[f],b=c.getID(),b=this._touchesIntegerDict[b],null!=b&&e[b]&&(e[b]._setPoint(c._point),e[b]._setPrevPoint(c._prevPoint),d.push(e[b]));0<d.length&&(this._glView._convertTouchesWithScale(d),a=new cc.EventTouch(d),a._eventCode=cc.EventTouch.EventCode.MOVED,cc.eventManager.dispatchEvent(a))},handleTouchesEnd:function(a){a=this.getSetOfTouchesEndOrCancel(a);
0<a.length&&(this._glView._convertTouchesWithScale(a),a=new cc.EventTouch(a),a._eventCode=cc.EventTouch.EventCode.ENDED,cc.eventManager.dispatchEvent(a))},handleTouchesCancel:function(a){a=this.getSetOfTouchesEndOrCancel(a);0<a.length&&(this._glView._convertTouchesWithScale(a),a=new cc.EventTouch(a),a._eventCode=cc.EventTouch.EventCode.CANCELLED,cc.eventManager.dispatchEvent(a))},getSetOfTouchesEndOrCancel:function(a){for(var c,b,d,e=[],f=this._touches,g=this._touchesIntegerDict,h=0,k=a.length;h<
k;h++)c=a[h],d=c.getID(),b=g[d],null!=b&&f[b]&&(f[b]._setPoint(c._point),f[b]._setPrevPoint(c._prevPoint),e.push(f[b]),this._removeUsedIndexBit(b),delete g[d]);return e},getHTMLElementPosition:function(a){var c=document.documentElement,b=window,d=null,d=cc.isFunction(a.getBoundingClientRect)?a.getBoundingClientRect():a instanceof HTMLCanvasElement?{left:0,top:0,width:a.width,height:a.height}:{left:0,top:0,width:parseInt(a.style.width),height:parseInt(a.style.height)};return{left:d.left+b.pageXOffset-
c.clientLeft,top:d.top+b.pageYOffset-c.clientTop,width:d.width,height:d.height}},getPreTouch:function(a){for(var c=null,b=this._preTouchPool,d=a.getID(),e=b.length-1;0<=e;e--)if(b[e].getID()===d){c=b[e];break}c||(c=a);return c},setPreTouch:function(a){for(var c=!1,b=this._preTouchPool,d=a.getID(),e=b.length-1;0<=e;e--)if(b[e].getID()===d){b[e]=a;c=!0;break}c||(50>=b.length?b.push(a):(b[this._preTouchPoolPointer]=a,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(a,
c,b){var d=this._preTouchPoint;a=this._glView.convertToLocationInView(a,c,b);c=new cc.Touch(a.x,a.y);c._setPrevPoint(d.x,d.y);d.x=a.x;d.y=a.y;return c},getMouseEvent:function(a,c,b){var d=this._prevMousePoint;this._glView._convertMouseToLocationInView(a,c);c=new cc.EventMouse(b);c.setLocation(a.x,a.y);c._setPrevCursor(d.x,d.y);d.x=a.x;d.y=a.y;return c},getPointByEvent:function(a,c){if(null!=a.pageX)return{x:a.pageX,y:a.pageY};c.left-=document.body.scrollLeft;c.top-=document.body.scrollTop;return{x:a.clientX,
y:a.clientY}},getTouchesByEvent:function(a,c){for(var b=[],d=this._glView,e,f,g=this._preTouchPoint,h=a.changedTouches.length,k=0;k<h;k++)if(e=a.changedTouches[k]){var l;l=cc.sys.BROWSER_TYPE_FIREFOX===cc.sys.browserType?d.convertToLocationInView(e.pageX,e.pageY,c):d.convertToLocationInView(e.clientX,e.clientY,c);null!=e.identifier?(e=new cc.Touch(l.x,l.y,e.identifier),f=this.getPreTouch(e).getLocation(),e._setPrevPoint(f.x,f.y),this.setPreTouch(e)):(e=new cc.Touch(l.x,l.y),e._setPrevPoint(g.x,g.y));
g.x=l.x;g.y=l.y;b.push(e)}return b},registerSystemEvent:function(a){if(!this._isRegisterEvent){this._glView=cc.view;var c=this,b="mouse"in cc.sys.capabilities,d="touches"in cc.sys.capabilities,e=!1;cc.sys.isMobile&&(e=!0);b&&(cc._addEventListener(window,"mousedown",function(){c._mousePressed=!0},!1),cc._addEventListener(window,"mouseup",function(b){if(!e){var d=c._mousePressed;c._mousePressed=!1;if(d){var d=c.getHTMLElementPosition(a),f=c.getPointByEvent(b,d);cc.rectContainsPoint(new cc.Rect(d.left,
d.top,d.width,d.height),f)||(c.handleTouchesEnd([c.getTouchByXY(f.x,f.y,d)]),d=c.getMouseEvent(f,d,cc.EventMouse.UP),d.setButton(b.button),cc.eventManager.dispatchEvent(d))}}},!1),cc._addEventListener(a,"mousedown",function(b){if(!e){c._mousePressed=!0;var d=c.getHTMLElementPosition(a),f=c.getPointByEvent(b,d);c.handleTouchesBegin([c.getTouchByXY(f.x,f.y,d)]);d=c.getMouseEvent(f,d,cc.EventMouse.DOWN);d.setButton(b.button);cc.eventManager.dispatchEvent(d);b.stopPropagation();b.preventDefault();a.focus()}},
!1),cc._addEventListener(a,"mouseup",function(b){if(!e){c._mousePressed=!1;var d=c.getHTMLElementPosition(a),f=c.getPointByEvent(b,d);c.handleTouchesEnd([c.getTouchByXY(f.x,f.y,d)]);d=c.getMouseEvent(f,d,cc.EventMouse.UP);d.setButton(b.button);cc.eventManager.dispatchEvent(d);b.stopPropagation();b.preventDefault()}},!1),cc._addEventListener(a,"mousemove",function(b){if(!e){var d=c.getHTMLElementPosition(a),f=c.getPointByEvent(b,d);c.handleTouchesMove([c.getTouchByXY(f.x,f.y,d)]);d=c.getMouseEvent(f,
d,cc.EventMouse.MOVE);c._mousePressed?d.setButton(b.button):d.setButton(null);cc.eventManager.dispatchEvent(d);b.stopPropagation();b.preventDefault()}},!1),cc._addEventListener(a,"mousewheel",function(b){var d=c.getHTMLElementPosition(a),e=c.getPointByEvent(b,d),d=c.getMouseEvent(e,d,cc.EventMouse.SCROLL);d.setButton(b.button);d.setScrollData(0,b.wheelDelta);cc.eventManager.dispatchEvent(d);b.stopPropagation();b.preventDefault()},!1),cc._addEventListener(a,"DOMMouseScroll",function(b){var d=c.getHTMLElementPosition(a),
e=c.getPointByEvent(b,d),d=c.getMouseEvent(e,d,cc.EventMouse.SCROLL);d.setButton(b.button);d.setScrollData(0,-120*b.detail);cc.eventManager.dispatchEvent(d);b.stopPropagation();b.preventDefault()},!1));if(window.navigator.msPointerEnabled){var b={MSPointerDown:c.handleTouchesBegin,MSPointerMove:c.handleTouchesMove,MSPointerUp:c.handleTouchesEnd,MSPointerCancel:c.handleTouchesCancel},f;for(f in b)(function(b,d){cc._addEventListener(a,b,function(b){var e=c.getHTMLElementPosition(a);e.left-=document.documentElement.scrollLeft;
e.top-=document.documentElement.scrollTop;d.call(c,[c.getTouchByXY(b.clientX,b.clientY,e)]);b.stopPropagation()},!1)})(f,b[f])}d&&(cc._addEventListener(a,"touchstart",function(b){if(b.changedTouches){var d=c.getHTMLElementPosition(a);d.left-=document.body.scrollLeft;d.top-=document.body.scrollTop;c.handleTouchesBegin(c.getTouchesByEvent(b,d));b.stopPropagation();b.preventDefault();a.focus()}},!1),cc._addEventListener(a,"touchmove",function(b){if(b.changedTouches){var d=c.getHTMLElementPosition(a);
d.left-=document.body.scrollLeft;d.top-=document.body.scrollTop;c.handleTouchesMove(c.getTouchesByEvent(b,d));b.stopPropagation();b.preventDefault()}},!1),cc._addEventListener(a,"touchend",function(b){if(b.changedTouches){var d=c.getHTMLElementPosition(a);d.left-=document.body.scrollLeft;d.top-=document.body.scrollTop;c.handleTouchesEnd(c.getTouchesByEvent(b,d));b.stopPropagation();b.preventDefault()}},!1),cc._addEventListener(a,"touchcancel",function(b){if(b.changedTouches){var d=c.getHTMLElementPosition(a);
d.left-=document.body.scrollLeft;d.top-=document.body.scrollTop;c.handleTouchesCancel(c.getTouchesByEvent(b,d));b.stopPropagation();b.preventDefault()}},!1));this._registerKeyboardEvent();this._registerAccelerometerEvent();this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(a){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,cc.eventManager.dispatchEvent(new cc.EventAcceleration(this._acceleration)));
this._accelCurTime+=a}};cc.AffineTransform=function(a,c,b,d,e,f){this.a=a;this.b=c;this.c=b;this.d=d;this.tx=e;this.ty=f};cc.affineTransformMake=function(a,c,b,d,e,f){return{a:a,b:c,c:b,d:d,tx:e,ty:f}};cc.pointApplyAffineTransform=function(a,c,b){var d;void 0===b?(b=c,d=a.x,a=a.y):(d=a,a=c);return{x:b.a*d+b.c*a+b.tx,y:b.b*d+b.d*a+b.ty}};cc._pointApplyAffineTransform=function(a,c,b){return cc.pointApplyAffineTransform(a,c,b)};
cc.sizeApplyAffineTransform=function(a,c){return{width:c.a*a.width+c.c*a.height,height:c.b*a.width+c.d*a.height}};cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}};cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}};
cc.rectApplyAffineTransform=function(a,c){var b=cc.rectGetMinY(a),d=cc.rectGetMinX(a),e=cc.rectGetMaxX(a),f=cc.rectGetMaxY(a),g=cc.pointApplyAffineTransform(d,b,c),b=cc.pointApplyAffineTransform(e,b,c),d=cc.pointApplyAffineTransform(d,f,c),h=cc.pointApplyAffineTransform(e,f,c),e=Math.min(g.x,b.x,d.x,h.x),f=Math.max(g.x,b.x,d.x,h.x),k=Math.min(g.y,b.y,d.y,h.y),g=Math.max(g.y,b.y,d.y,h.y);return cc.rect(e,k,f-e,g-k)};
cc._rectApplyAffineTransformIn=function(a,c){var b=cc.rectGetMinY(a),d=cc.rectGetMinX(a),e=cc.rectGetMaxX(a),f=cc.rectGetMaxY(a),g=cc.pointApplyAffineTransform(d,b,c),b=cc.pointApplyAffineTransform(e,b,c),d=cc.pointApplyAffineTransform(d,f,c),h=cc.pointApplyAffineTransform(e,f,c),e=Math.min(g.x,b.x,d.x,h.x),f=Math.max(g.x,b.x,d.x,h.x),k=Math.min(g.y,b.y,d.y,h.y),g=Math.max(g.y,b.y,d.y,h.y);a.x=e;a.y=k;a.width=f-e;a.height=g-k;return a};
cc.affineTransformTranslate=function(a,c,b){return{a:a.a,b:a.b,c:a.c,d:a.d,tx:a.tx+a.a*c+a.c*b,ty:a.ty+a.b*c+a.d*b}};cc.affineTransformScale=function(a,c,b){return{a:a.a*c,b:a.b*c,c:a.c*b,d:a.d*b,tx:a.tx,ty:a.ty}};cc.affineTransformRotate=function(a,c){var b=Math.sin(c),d=Math.cos(c);return{a:a.a*d+a.c*b,b:a.b*d+a.d*b,c:a.c*d-a.a*b,d:a.d*d-a.b*b,tx:a.tx,ty:a.ty}};
cc.affineTransformConcat=function(a,c){return{a:a.a*c.a+a.b*c.c,b:a.a*c.b+a.b*c.d,c:a.c*c.a+a.d*c.c,d:a.c*c.b+a.d*c.d,tx:a.tx*c.a+a.ty*c.c+c.tx,ty:a.tx*c.b+a.ty*c.d+c.ty}};cc.affineTransformEqualToTransform=function(a,c){return a.a===c.a&&a.b===c.b&&a.c===c.c&&a.d===c.d&&a.tx===c.tx&&a.ty===c.ty};cc.affineTransformInvert=function(a){var c=1/(a.a*a.d-a.b*a.c);return{a:c*a.d,b:-c*a.b,c:-c*a.c,d:c*a.a,tx:c*(a.c*a.ty-a.d*a.tx),ty:c*(a.b*a.tx-a.a*a.ty)}};cc.POINT_EPSILON=parseFloat("1.192092896e-07F");cc.pNeg=function(a){return cc.p(-a.x,-a.y)};cc.pAdd=function(a,c){return cc.p(a.x+c.x,a.y+c.y)};cc.pSub=function(a,c){return cc.p(a.x-c.x,a.y-c.y)};cc.pMult=function(a,c){return cc.p(a.x*c,a.y*c)};cc.pMidpoint=function(a,c){return cc.pMult(cc.pAdd(a,c),0.5)};cc.pDot=function(a,c){return a.x*c.x+a.y*c.y};cc.pCross=function(a,c){return a.x*c.y-a.y*c.x};cc.pPerp=function(a){return cc.p(-a.y,a.x)};cc.pRPerp=function(a){return cc.p(a.y,-a.x)};
cc.pProject=function(a,c){return cc.pMult(c,cc.pDot(a,c)/cc.pDot(c,c))};cc.pRotate=function(a,c){return cc.p(a.x*c.x-a.y*c.y,a.x*c.y+a.y*c.x)};cc.pUnrotate=function(a,c){return cc.p(a.x*c.x+a.y*c.y,a.y*c.x-a.x*c.y)};cc.pLengthSQ=function(a){return cc.pDot(a,a)};cc.pDistanceSQ=function(a,c){return cc.pLengthSQ(cc.pSub(a,c))};cc.pLength=function(a){return Math.sqrt(cc.pLengthSQ(a))};cc.pDistance=function(a,c){return cc.pLength(cc.pSub(a,c))};
cc.pNormalize=function(a){var c=cc.pLength(a);return 0===c?cc.p(a):cc.pMult(a,1/c)};cc.pForAngle=function(a){return cc.p(Math.cos(a),Math.sin(a))};cc.pToAngle=function(a){return Math.atan2(a.y,a.x)};cc.clampf=function(a,c,b){if(c>b){var d=c;c=b;b=d}return a<c?c:a<b?a:b};cc.pClamp=function(a,c,b){return cc.p(cc.clampf(a.x,c.x,b.x),cc.clampf(a.y,c.y,b.y))};cc.pFromSize=function(a){return cc.p(a.width,a.height)};cc.pCompOp=function(a,c){return cc.p(c(a.x),c(a.y))};
cc.pLerp=function(a,c,b){return cc.pAdd(cc.pMult(a,1-b),cc.pMult(c,b))};cc.pFuzzyEqual=function(a,c,b){return a.x-b<=c.x&&c.x<=a.x+b&&a.y-b<=c.y&&c.y<=a.y+b?!0:!1};cc.pCompMult=function(a,c){return cc.p(a.x*c.x,a.y*c.y)};cc.pAngleSigned=function(a,c){var b=cc.pNormalize(a),d=cc.pNormalize(c),b=Math.atan2(b.x*d.y-b.y*d.x,cc.pDot(b,d));return Math.abs(b)<cc.POINT_EPSILON?0:b};cc.pAngle=function(a,c){var b=Math.acos(cc.pDot(cc.pNormalize(a),cc.pNormalize(c)));return Math.abs(b)<cc.POINT_EPSILON?0:b};
cc.pRotateByAngle=function(a,c,b){a=cc.pSub(a,c);var d=Math.cos(b);b=Math.sin(b);var e=a.x;a.x=e*d-a.y*b+c.x;a.y=e*b+a.y*d+c.y;return a};cc.pLineIntersect=function(a,c,b,d,e){if(a.x===c.x&&a.y===c.y||b.x===d.x&&b.y===d.y)return!1;var f=c.x-a.x;c=c.y-a.y;var g=d.x-b.x;d=d.y-b.y;var h=a.x-b.x;a=a.y-b.y;b=d*f-g*c;e.x=g*a-d*h;e.y=f*a-c*h;if(0===b)return 0===e.x||0===e.y?!0:!1;e.x/=b;e.y/=b;return!0};
cc.pSegmentIntersect=function(a,c,b,d){var e=cc.p(0,0);return cc.pLineIntersect(a,c,b,d,e)&&0<=e.x&&1>=e.x&&0<=e.y&&1>=e.y?!0:!1};cc.pIntersectPoint=function(a,c,b,d){var e=cc.p(0,0);return cc.pLineIntersect(a,c,b,d,e)?(b=cc.p(0,0),b.x=a.x+e.x*(c.x-a.x),b.y=a.y+e.x*(c.y-a.y),b):cc.p(0,0)};cc.pSameAs=function(a,c){return null!=a&&null!=c?a.x===c.x&&a.y===c.y:!1};cc.pZeroIn=function(a){a.x=0;a.y=0};cc.pIn=function(a,c){a.x=c.x;a.y=c.y};cc.pMultIn=function(a,c){a.x*=c;a.y*=c};
cc.pSubIn=function(a,c){a.x-=c.x;a.y-=c.y};cc.pAddIn=function(a,c){a.x+=c.x;a.y+=c.y};cc.pNormalizeIn=function(a){cc.pMultIn(a,1/Math.sqrt(a.x*a.x+a.y*a.y))};cc.Touch=cc.Class.extend({_point:null,_prevPoint:null,_id:0,_startPointCaptured:!1,_startPoint:null,ctor:function(a,c,b){this._point=cc.p(a||0,c||0);this._id=b||0},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,
this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getID:function(){return this._id},getId:function(){cc.log("getId is deprecated. Please use getID instead.");return this._id},setTouchInfo:function(a,c,b){this._prevPoint=this._point;this._point=cc.p(c||0,b||0);this._id=a;this._startPointCaptured||
(this._startPoint=cc.p(this._point),this._startPointCaptured=!0)},_setPoint:function(a,c){void 0===c?(this._point.x=a.x,this._point.y=a.y):(this._point.x=a,this._point.y=c)},_setPrevPoint:function(a,c){this._prevPoint=void 0===c?cc.p(a.x,a.y):cc.p(a||0,c||0)}});cc.Event=cc.Class.extend({_type:0,_isStopped:!1,_currentTarget:null,_setCurrentTarget:function(a){this._currentTarget=a},ctor:function(a){this._type=a},getType:function(){return this._type},stopPropagation:function(){this._isStopped=!0},isStopped:function(){return this._isStopped},getCurrentTarget:function(){return this._currentTarget}});cc.Event.TOUCH=0;cc.Event.KEYBOARD=1;cc.Event.ACCELERATION=2;cc.Event.MOUSE=3;cc.Event.FOCUS=4;cc.Event.CUSTOM=6;
cc.EventCustom=cc.Event.extend({_eventName:null,_userData:null,ctor:function(a){cc.Event.prototype.ctor.call(this,cc.Event.CUSTOM);this._eventName=a},setUserData:function(a){this._userData=a},getUserData:function(){return this._userData},getEventName:function(){return this._eventName}});
cc.EventMouse=cc.Event.extend({_eventType:0,_button:0,_x:0,_y:0,_prevX:0,_prevY:0,_scrollX:0,_scrollY:0,ctor:function(a){cc.Event.prototype.ctor.call(this,cc.Event.MOUSE);this._eventType=a},setScrollData:function(a,c){this._scrollX=a;this._scrollY=c},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(a,c){this._x=a;this._y=c},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:cc.view._designResolutionSize.height-
this._y}},_setPrevCursor:function(a,c){this._prevX=a;this._prevY=c},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(a){this._button=a},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}});cc.EventMouse.NONE=0;cc.EventMouse.DOWN=1;cc.EventMouse.UP=2;cc.EventMouse.MOVE=3;
cc.EventMouse.SCROLL=4;cc.EventMouse.BUTTON_LEFT=0;cc.EventMouse.BUTTON_RIGHT=2;cc.EventMouse.BUTTON_MIDDLE=1;cc.EventMouse.BUTTON_4=3;cc.EventMouse.BUTTON_5=4;cc.EventMouse.BUTTON_6=5;cc.EventMouse.BUTTON_7=6;cc.EventMouse.BUTTON_8=7;
cc.EventTouch=cc.Event.extend({_eventCode:0,_touches:null,ctor:function(a){cc.Event.prototype.ctor.call(this,cc.Event.TOUCH);this._touches=a||[]},getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(a){this._eventCode=a},_setTouches:function(a){this._touches=a}});cc.EventTouch.MAX_TOUCHES=5;cc.EventTouch.EventCode={BEGAN:0,MOVED:1,ENDED:2,CANCELLED:3};
cc.EventFocus=cc.Event.extend({_widgetGetFocus:null,_widgetLoseFocus:null,ctor:function(a,c){cc.Event.prototype.ctor.call(this,cc.Event.FOCUS);this._widgetGetFocus=c;this._widgetLoseFocus=a}});cc.EventListener=cc.Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:!1,_fixedPriority:0,_node:null,_paused:!0,_isEnabled:!0,ctor:function(a,c,b){this._onEvent=b;this._type=a||0;this._listenerID=c||""},_setPaused:function(a){this._paused=a},_isPaused:function(){return this._paused},_setRegistered:function(a){this._registered=a},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(a){this._fixedPriority=
a},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(a){this._node=a},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(a){this._isEnabled=a},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}});cc.EventListener.UNKNOWN=0;cc.EventListener.TOUCH_ONE_BY_ONE=1;cc.EventListener.TOUCH_ALL_AT_ONCE=2;
cc.EventListener.KEYBOARD=3;cc.EventListener.MOUSE=4;cc.EventListener.ACCELERATION=5;cc.EventListener.ACCELERATION=6;cc.EventListener.CUSTOM=8;cc.EventListener.FOCUS=7;
cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(a,c){this._onCustomEvent=c;var b=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,a,function(a){null!==b._onCustomEvent&&b._onCustomEvent(a)})},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}});
cc._EventListenerCustom.create=function(a,c){return new cc._EventListenerCustom(a,c)};
cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){var a=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,function(c){var b=cc.EventMouse;switch(c._eventType){case b.DOWN:if(a.onMouseDown)a.onMouseDown(c);break;case b.UP:if(a.onMouseUp)a.onMouseUp(c);break;case b.MOVE:if(a.onMouseMove)a.onMouseMove(c);break;case b.SCROLL:if(a.onMouseScroll)a.onMouseScroll(c)}})},
clone:function(){var a=new cc._EventListenerMouse;a.onMouseDown=this.onMouseDown;a.onMouseUp=this.onMouseUp;a.onMouseMove=this.onMouseMove;a.onMouseScroll=this.onMouseScroll;return a},checkAvailable:function(){return!0}});cc._EventListenerMouse.LISTENER_ID="__cc_mouse";cc._EventListenerMouse.create=function(){return new cc._EventListenerMouse};
cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null);this._claimedTouches=[]},setSwallowTouches:function(a){this.swallowTouches=a},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var a=new cc._EventListenerTouchOneByOne;
a.onTouchBegan=this.onTouchBegan;a.onTouchMoved=this.onTouchMoved;a.onTouchEnded=this.onTouchEnded;a.onTouchCancelled=this.onTouchCancelled;a.swallowTouches=this.swallowTouches;return a},checkAvailable:function(){return!this.onTouchBegan?(cc.log(cc._LogInfos._EventListenerTouchOneByOne_checkAvailable),!1):!0}});cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one";cc._EventListenerTouchOneByOne.create=function(){return new cc._EventListenerTouchOneByOne};
cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var a=new cc._EventListenerTouchAllAtOnce;a.onTouchesBegan=this.onTouchesBegan;a.onTouchesMoved=this.onTouchesMoved;a.onTouchesEnded=this.onTouchesEnded;a.onTouchesCancelled=this.onTouchesCancelled;return a},
checkAvailable:function(){return null===this.onTouchesBegan&&null===this.onTouchesMoved&&null===this.onTouchesEnded&&null===this.onTouchesCancelled?(cc.log(cc._LogInfos._EventListenerTouchAllAtOnce_checkAvailable),!1):!0}});cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once";cc._EventListenerTouchAllAtOnce.create=function(){return new cc._EventListenerTouchAllAtOnce};
cc.EventListener.create=function(a){cc.assert(a&&a.event,cc._LogInfos.EventListener_create);var c=a.event;delete a.event;var b=null;c===cc.EventListener.TOUCH_ONE_BY_ONE?b=new cc._EventListenerTouchOneByOne:c===cc.EventListener.TOUCH_ALL_AT_ONCE?b=new cc._EventListenerTouchAllAtOnce:c===cc.EventListener.MOUSE?b=new cc._EventListenerMouse:c===cc.EventListener.CUSTOM?(b=new cc._EventListenerCustom(a.eventName,a.callback),delete a.eventName,delete a.callback):c===cc.EventListener.KEYBOARD?b=new cc._EventListenerKeyboard:
c===cc.EventListener.ACCELERATION?(b=new cc._EventListenerAcceleration(a.callback),delete a.callback):c===cc.EventListener.FOCUS&&(b=new cc._EventListenerFocus);for(var d in a)b[d]=a[d];return b};
cc._EventListenerFocus=cc.EventListener.extend({clone:function(){var a=new cc._EventListenerFocus;a.onFocusChanged=this.onFocusChanged;return a},checkAvailable:function(){return!this.onFocusChanged?(cc.log("Invalid EventListenerFocus!"),!1):!0},onFocusChanged:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.FOCUS,cc._EventListenerFocus.LISTENER_ID,function(a){if(this.onFocusChanged)this.onFocusChanged(a._widgetLoseFocus,a._widgetGetFocus)})}});
cc._EventListenerFocus.LISTENER_ID="__cc_focus_event";cc._EventListenerVector=cc.Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=[];this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(a){0===a._getFixedPriority()?this._sceneGraphListeners.push(a):this._fixedListeners.push(a)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=
0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0;this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}});
cc.__getListenerID=function(a){var c=cc.Event,b=a.getType();if(b===c.ACCELERATION)return cc._EventListenerAcceleration.LISTENER_ID;if(b===c.CUSTOM)return a.getEventName();if(b===c.KEYBOARD)return cc._EventListenerKeyboard.LISTENER_ID;if(b===c.MOUSE)return cc._EventListenerMouse.LISTENER_ID;if(b===c.FOCUS)return cc._EventListenerFocus.LISTENER_ID;b===c.TOUCH&&cc.log(cc._LogInfos.__getListenerID);return""};
cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[cc.game.EVENT_HIDE,cc.game.EVENT_SHOW],_setDirtyForNode:function(a){null!=this._nodeListenersMap[a.__instanceId]&&this._dirtyNodes.push(a);a=a.getChildren();for(var c=0,b=a.length;c<b;c++)this._setDirtyForNode(a[c])},
pauseTarget:function(a,c){var b=this._nodeListenersMap[a.__instanceId],d,e;if(b){d=0;for(e=b.length;d<e;d++)b[d]._setPaused(!0)}if(!0===c){b=a.getChildren();d=0;for(e=b.length;d<e;d++)this.pauseTarget(b[d],!0)}},resumeTarget:function(a,c){var b=this._nodeListenersMap[a.__instanceId],d,e;if(b){d=0;for(e=b.length;d<e;d++)b[d]._setPaused(!1)}this._setDirtyForNode(a);if(!0===c){b=a.getChildren();d=0;for(e=b.length;d<e;d++)this.resumeTarget(b[d],!0)}},_addListener:function(a){0===this._inDispatch?this._forceAddEventListener(a):
this._toAddedListeners.push(a)},_forceAddEventListener:function(a){var c=a._getListenerID(),b=this._listenersMap[c];b||(b=new cc._EventListenerVector,this._listenersMap[c]=b);b.push(a);0===a._getFixedPriority()?(this._setDirty(c,this.DIRTY_SCENE_GRAPH_PRIORITY),c=a._getSceneGraphPriority(),null===c&&cc.log(cc._LogInfos.eventManager__forceAddEventListener),this._associateNodeAndEventListener(c,a),c.isRunning()&&this.resumeTarget(c)):this._setDirty(c,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(a){return this._listenersMap[a]},
_updateDirtyFlagForSceneGraph:function(){if(0!==this._dirtyNodes.length){for(var a=this._dirtyNodes,c,b,d=this._nodeListenersMap,e=0,f=a.length;e<f;e++)if(c=d[a[e].__instanceId])for(var g=0,h=c.length;g<h;g++)(b=c[g])&&this._setDirty(b._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(a){if(a)for(var c,b=0;b<a.length;)c=a[b],c._setRegistered(!1),null!=c._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(c._getSceneGraphPriority(),
c),c._setSceneGraphPriority(null)),0===this._inDispatch?cc.arrayRemoveObject(a,c):++b},_removeListenersForListenerID:function(a){var c=this._listenersMap[a];if(c){var b=c.getFixedPriorityListeners(),d=c.getSceneGraphPriorityListeners();this._removeAllListenersInVector(d);this._removeAllListenersInVector(b);delete this._priorityDirtyFlagMap[a];this._inDispatch||(c.clear(),delete this._listenersMap[a])}b=this._toAddedListeners;for(c=0;c<b.length;)(d=b[c])&&d._getListenerID()===a?cc.arrayRemoveObject(b,
d):++c},_sortEventListeners:function(a){var c=this.DIRTY_NONE,b=this._priorityDirtyFlagMap;b[a]&&(c=b[a]);c!==this.DIRTY_NONE&&(b[a]=this.DIRTY_NONE,c&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(a),c&this.DIRTY_SCENE_GRAPH_PRIORITY&&((c=cc.director.getRunningScene())?this._sortListenersOfSceneGraphPriority(a,c):b[a]=this.DIRTY_SCENE_GRAPH_PRIORITY))},_sortListenersOfSceneGraphPriority:function(a,c){var b=this._getListeners(a);if(b){var d=b.getSceneGraphPriorityListeners();d&&0!==
d.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(c,!0),b.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(a,c){var b=cc.eventManager._nodePriorityMap,d=a._getSceneGraphPriority(),e=c._getSceneGraphPriority();return!a||!c||!d||!e||!b[d.__instanceId]||!b[e.__instanceId]?-1:b[c._getSceneGraphPriority().__instanceId]-b[a._getSceneGraphPriority().__instanceId]},_sortListenersOfFixedPriority:function(a){if(a=
this._listenersMap[a]){var c=a.getFixedPriorityListeners();if(c&&0!==c.length){c.sort(this._sortListenersOfFixedPriorityAsc);for(var b=0,d=c.length;b<d&&!(0<=c[b]._getFixedPriority());)++b;a.gt0Index=b}}},_sortListenersOfFixedPriorityAsc:function(a,c){return a._getFixedPriority()-c._getFixedPriority()},_onUpdateListeners:function(a){if(a=this._listenersMap[a]){var c=a.getFixedPriorityListeners(),b=a.getSceneGraphPriorityListeners(),d,e;if(b)for(d=0;d<b.length;)e=b[d],e._isRegistered()?++d:cc.arrayRemoveObject(b,
e);if(c)for(d=0;d<c.length;)e=c[d],e._isRegistered()?++d:cc.arrayRemoveObject(c,e);b&&0===b.length&&a.clearSceneGraphListeners();c&&0===c.length&&a.clearFixedListeners()}},_updateListeners:function(a){var c=this._inDispatch;cc.assert(0<c,cc._LogInfos.EventManager__updateListeners);if(!(1<c)){a.getType()===cc.Event.TOUCH?(this._onUpdateListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._onUpdateListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID)):this._onUpdateListeners(cc.__getListenerID(a));
cc.assert(1===c,cc._LogInfos.EventManager__updateListeners_2);a=this._listenersMap;var c=this._priorityDirtyFlagMap,b;for(b in a)a[b].empty()&&(delete c[b],delete a[b]);b=this._toAddedListeners;if(0!==b.length){a=0;for(c=b.length;a<c;a++)this._forceAddEventListener(b[a]);this._toAddedListeners.length=0}}},_onTouchEventCallback:function(a,c){if(!a._isRegistered)return!1;var b=c.event,d=c.selTouch;b._setCurrentTarget(a._node);var e=!1,f,g=b.getEventCode(),h=cc.EventTouch.EventCode;if(g===h.BEGAN)a.onTouchBegan&&
(e=a.onTouchBegan(d,b))&&a._registered&&a._claimedTouches.push(d);else if(0<a._claimedTouches.length&&-1!==(f=a._claimedTouches.indexOf(d)))if(e=!0,g===h.MOVED&&a.onTouchMoved)a.onTouchMoved(d,b);else if(g===h.ENDED){if(a.onTouchEnded)a.onTouchEnded(d,b);a._registered&&a._claimedTouches.splice(f,1)}else if(g===h.CANCELLED){if(a.onTouchCancelled)a.onTouchCancelled(d,b);a._registered&&a._claimedTouches.splice(f,1)}return b.isStopped()?(cc.eventManager._updateListeners(b),!0):e&&a._registered&&a.swallowTouches?
(c.needsMutableSet&&c.touches.splice(d,1),!0):!1},_dispatchTouchEvent:function(a){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID);this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var c=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),b=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(!(null===c&&null===b)){var d=a.getTouches(),e=cc.copyArray(d),f={event:a,needsMutableSet:c&&b,touches:e,selTouch:null};if(c)for(var g=0;g<d.length;g++)if(f.selTouch=
d[g],this._dispatchEventToListeners(c,this._onTouchEventCallback,f),a.isStopped())return;if(b&&0<e.length&&(this._dispatchEventToListeners(b,this._onTouchesEventCallback,{event:a,touches:e}),a.isStopped()))return;this._updateListeners(a)}},_onTouchesEventCallback:function(a,c){if(!a._registered)return!1;var b=cc.EventTouch.EventCode,d=c.event,e=c.touches,f=d.getEventCode();d._setCurrentTarget(a._node);if(f===b.BEGAN&&a.onTouchesBegan)a.onTouchesBegan(e,d);else if(f===b.MOVED&&a.onTouchesMoved)a.onTouchesMoved(e,
d);else if(f===b.ENDED&&a.onTouchesEnded)a.onTouchesEnded(e,d);else if(f===b.CANCELLED&&a.onTouchesCancelled)a.onTouchesCancelled(e,d);return d.isStopped()?(cc.eventManager._updateListeners(d),!0):!1},_associateNodeAndEventListener:function(a,c){var b=this._nodeListenersMap[a.__instanceId];b||(b=[],this._nodeListenersMap[a.__instanceId]=b);b.push(c)},_dissociateNodeAndEventListener:function(a,c){var b=this._nodeListenersMap[a.__instanceId];b&&(cc.arrayRemoveObject(b,c),0===b.length&&delete this._nodeListenersMap[a.__instanceId])},
_dispatchEventToListeners:function(a,c,b){var d=!1,e=a.getFixedPriorityListeners(),f=a.getSceneGraphPriorityListeners(),g=0,h;if(e&&0!==e.length)for(;g<a.gt0Index;++g)if(h=e[g],h.isEnabled()&&!h._isPaused()&&h._isRegistered()&&c(h,b)){d=!0;break}if(f&&!d)for(a=0;a<f.length;a++)if(h=f[a],h.isEnabled()&&!h._isPaused()&&h._isRegistered()&&c(h,b)){d=!0;break}if(e&&!d)for(;g<e.length&&!(h=e[g],h.isEnabled()&&!h._isPaused()&&h._isRegistered()&&c(h,b));++g);},_setDirty:function(a,c){var b=this._priorityDirtyFlagMap;
b[a]=null==b[a]?c:c|b[a]},_visitTarget:function(a,c){var b=a.getChildren(),d=0,e=b.length,f=this._globalZOrderNodeMap,g=this._nodeListenersMap;if(0<e){for(var h;d<e;d++)if((h=b[d])&&0>h.getLocalZOrder())this._visitTarget(h,!1);else break;null!=g[a.__instanceId]&&(f[a.getGlobalZOrder()]||(f[a.getGlobalZOrder()]=[]),f[a.getGlobalZOrder()].push(a.__instanceId));for(;d<e;d++)(h=b[d])&&this._visitTarget(h,!1)}else null!=g[a.__instanceId]&&(f[a.getGlobalZOrder()]||(f[a.getGlobalZOrder()]=[]),f[a.getGlobalZOrder()].push(a.__instanceId));
if(c){var b=[],k;for(k in f)b.push(k);b.sort(this._sortNumberAsc);k=b.length;h=this._nodePriorityMap;for(d=0;d<k;d++){e=f[b[d]];for(g=0;g<e.length;g++)h[e[g]]=++this._nodePriorityIndex}this._globalZOrderNodeMap={}}},_sortNumberAsc:function(a,c){return a-c},addListener:function(a,c){cc.assert(a&&c,cc._LogInfos.eventManager_addListener_2);if(a instanceof cc.EventListener){if(a._isRegistered()){cc.log(cc._LogInfos.eventManager_addListener_4);return}}else cc.assert(!cc.isNumber(c),cc._LogInfos.eventManager_addListener_3),
a=cc.EventListener.create(a);if(a.checkAvailable()){if(cc.isNumber(c)){if(0===c){cc.log(cc._LogInfos.eventManager_addListener);return}a._setSceneGraphPriority(null);a._setFixedPriority(c);a._setRegistered(!0);a._setPaused(!1)}else a._setSceneGraphPriority(c),a._setFixedPriority(0),a._setRegistered(!0);this._addListener(a);return a}},addCustomListener:function(a,c){var b=new cc._EventListenerCustom(a,c);this.addListener(b,1);return b},removeListener:function(a){if(null!=a){var c,b=this._listenersMap,
d;for(d in b){var e=b[d],f=e.getFixedPriorityListeners();c=e.getSceneGraphPriorityListeners();(c=this._removeListenerInVector(c,a))?this._setDirty(a._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(c=this._removeListenerInVector(f,a))&&this._setDirty(a._getListenerID(),this.DIRTY_FIXED_PRIORITY);e.empty()&&(delete this._priorityDirtyFlagMap[a._getListenerID()],delete b[d]);if(c)break}if(!c){b=this._toAddedListeners;d=0;for(e=b.length;d<e;d++)if(f=b[d],f===a){cc.arrayRemoveObject(b,f);f._setRegistered(!1);
break}}}},_removeListenerInVector:function(a,c){if(null==a)return!1;for(var b=0,d=a.length;b<d;b++){var e=a[b];if(e===c)return e._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch&&cc.arrayRemoveObject(a,e),!0}return!1},removeListeners:function(a,c){if(a instanceof cc.Node){delete this._nodePriorityMap[a.__instanceId];cc.arrayRemoveObject(this._dirtyNodes,a);var b=this._nodeListenersMap[a.__instanceId];
if(b){for(var d=cc.copyArray(b),b=0;b<d.length;b++)this.removeListener(d[b]);d.length=0}d=this._toAddedListeners;for(b=0;b<d.length;){var e=d[b];e._getSceneGraphPriority()===a?(e._setSceneGraphPriority(null),e._setRegistered(!1),d.splice(b,1)):++b}if(!0===c){d=a.getChildren();b=0;for(e=d.length;b<e;b++)this.removeListeners(d[b],!0)}}else a===cc.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):a===cc.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):
a===cc.EventListener.MOUSE?this._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):a===cc.EventListener.ACCELERATION?this._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):a===cc.EventListener.KEYBOARD?this._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.log(cc._LogInfos.eventManager_removeListeners)},removeCustomListeners:function(a){this._removeListenersForListenerID(a)},removeAllListeners:function(){var a=this._listenersMap,c=this._internalCustomListenerIDs,
b;for(b in a)-1===c.indexOf(b)&&this._removeListenersForListenerID(b)},setPriority:function(a,c){if(null!=a){var b=this._listenersMap,d;for(d in b){var e=b[d].getFixedPriorityListeners();if(e&&-1!==e.indexOf(a)){null!=a._getSceneGraphPriority()&&cc.log(cc._LogInfos.eventManager_setPriority);a._getFixedPriority()!==c&&(a._setFixedPriority(c),this._setDirty(a._getListenerID(),this.DIRTY_FIXED_PRIORITY));break}}}},setEnabled:function(a){this._isEnabled=a},isEnabled:function(){return this._isEnabled},
dispatchEvent:function(a){if(this._isEnabled){this._updateDirtyFlagForSceneGraph();this._inDispatch++;if(!a||!a.getType)throw"event is undefined";if(a.getType()===cc.Event.TOUCH)this._dispatchTouchEvent(a);else{var c=cc.__getListenerID(a);this._sortEventListeners(c);c=this._listenersMap[c];null!=c&&this._dispatchEventToListeners(c,this._onListenerCallback,a);this._updateListeners(a)}this._inDispatch--}},_onListenerCallback:function(a,c){c._setCurrentTarget(a._getSceneGraphPriority());a._onEvent(c);
return c.isStopped()},dispatchCustomEvent:function(a,c){var b=new cc.EventCustom(a);b.setUserData(c);this.dispatchEvent(b)}};cc.EventHelper=function(){};
cc.EventHelper.prototype={constructor:cc.EventHelper,apply:function(a){a.addEventListener=cc.EventHelper.prototype.addEventListener;a.hasEventListener=cc.EventHelper.prototype.hasEventListener;a.removeEventListener=cc.EventHelper.prototype.removeEventListener;a.dispatchEvent=cc.EventHelper.prototype.dispatchEvent},addEventListener:function(a,c,b){if("load"===a&&this._textureLoaded)setTimeout(function(){c.call(b)},0);else{void 0===this._listeners&&(this._listeners={});var d=this._listeners;void 0===
d[a]&&(d[a]=[]);this.hasEventListener(a,c,b)||d[a].push({callback:c,eventTarget:b})}},hasEventListener:function(a,c,b){if(void 0===this._listeners)return!1;var d=this._listeners;if(void 0!==d[a]){a=0;for(var e=d.length;a<e;a++){var f=d[a];if(f.callback===c&&f.eventTarget===b)return!0}}return!1},removeEventListener:function(a,c){if(void 0!==this._listeners){var b=this._listeners[a];if(void 0!==b)for(var d=0;d<b.length;)b[d].eventTarget===c?b.splice(d,1):d++}},dispatchEvent:function(a,c){if(void 0!==
this._listeners){null==c&&(c=!0);var b=this._listeners[a];if(void 0!==b){for(var d=[],e=b.length,f=0;f<e;f++)d[f]=b[f];for(f=0;f<e;f++)d[f].callback.call(d[f].eventTarget,this);c&&(b.length=0)}}}};cc._tmp.PrototypeCCNode=function(){var a=cc.Node.prototype;cc.defineGetterSetter(a,"x",a.getPositionX,a.setPositionX);cc.defineGetterSetter(a,"y",a.getPositionY,a.setPositionY);cc.defineGetterSetter(a,"width",a._getWidth,a._setWidth);cc.defineGetterSetter(a,"height",a._getHeight,a._setHeight);cc.defineGetterSetter(a,"anchorX",a._getAnchorX,a._setAnchorX);cc.defineGetterSetter(a,"anchorY",a._getAnchorY,a._setAnchorY);cc.defineGetterSetter(a,"skewX",a.getSkewX,a.setSkewX);cc.defineGetterSetter(a,"skewY",
a.getSkewY,a.setSkewY);cc.defineGetterSetter(a,"zIndex",a.getLocalZOrder,a.setLocalZOrder);cc.defineGetterSetter(a,"vertexZ",a.getVertexZ,a.setVertexZ);cc.defineGetterSetter(a,"rotation",a.getRotation,a.setRotation);cc.defineGetterSetter(a,"rotationX",a.getRotationX,a.setRotationX);cc.defineGetterSetter(a,"rotationY",a.getRotationY,a.setRotationY);cc.defineGetterSetter(a,"scale",a.getScale,a.setScale);cc.defineGetterSetter(a,"scaleX",a.getScaleX,a.setScaleX);cc.defineGetterSetter(a,"scaleY",a.getScaleY,
a.setScaleY);cc.defineGetterSetter(a,"children",a.getChildren);cc.defineGetterSetter(a,"childrenCount",a.getChildrenCount);cc.defineGetterSetter(a,"parent",a.getParent,a.setParent);cc.defineGetterSetter(a,"visible",a.isVisible,a.setVisible);cc.defineGetterSetter(a,"running",a.isRunning);cc.defineGetterSetter(a,"ignoreAnchor",a.isIgnoreAnchorPointForPosition,a.ignoreAnchorPointForPosition);cc.defineGetterSetter(a,"actionManager",a.getActionManager,a.setActionManager);cc.defineGetterSetter(a,"scheduler",
a.getScheduler,a.setScheduler);cc.defineGetterSetter(a,"shaderProgram",a.getShaderProgram,a.setShaderProgram);cc.defineGetterSetter(a,"opacity",a.getOpacity,a.setOpacity);cc.defineGetterSetter(a,"opacityModifyRGB",a.isOpacityModifyRGB);cc.defineGetterSetter(a,"cascadeOpacity",a.isCascadeOpacityEnabled,a.setCascadeOpacityEnabled);cc.defineGetterSetter(a,"color",a.getColor,a.setColor);cc.defineGetterSetter(a,"cascadeColor",a.isCascadeColorEnabled,a.setCascadeColorEnabled)};cc.NODE_TAG_INVALID=-1;cc.s_globalOrderOfArrival=1;
cc.Node=cc.Class.extend({_localZOrder:0,_globalZOrder:0,_vertexZ:0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:null,_normalizedPosition:null,_usingNormalizedPosition:!1,_normalizedPositionDirty:!1,_skewX:0,_skewY:0,_children:null,_visible:!0,_anchorPoint:null,_contentSize:null,_running:!1,_parent:null,_ignoreAnchorPointForPosition:!1,tag:cc.NODE_TAG_INVALID,userData:null,userObject:null,_reorderChildDirty:!1,_shaderProgram:null,arrivalOrder:0,_actionManager:null,_scheduler:null,_eventDispatcher:null,
_additionalTransformDirty:!1,_additionalTransform:null,_componentContainer:null,_isTransitionFinished:!1,_className:"Node",_showNode:!1,_name:"",_realOpacity:255,_realColor:null,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,_renderCmd:null,_camera:null,ctor:function(){this._initNode();this._initRendererCmd()},_initNode:function(){this._anchorPoint=cc.p(0,0);this._contentSize=cc.size(0,0);this._position=cc.p(0,0);this._normalizedPosition=cc.p(0,0);this._children=[];var a=cc.director;this._actionManager=
a.getActionManager();this._scheduler=a.getScheduler();this._additionalTransform=cc.affineTransformMakeIdentity();cc.ComponentContainer&&(this._componentContainer=new cc.ComponentContainer(this));this._realOpacity=255;this._realColor=cc.color(255,255,255,255);this._cascadeOpacityEnabled=this._cascadeColorEnabled=!1},init:function(){return!0},_arrayMakeObjectsPerformSelector:function(a,c){if(a&&0!==a.length){var b,d=a.length,e;b=cc.Node._stateCallbackType;switch(c){case b.onEnter:for(b=0;b<d;b++)if(e=
a[b])e.onEnter();break;case b.onExit:for(b=0;b<d;b++)if(e=a[b])e.onExit();break;case b.onEnterTransitionDidFinish:for(b=0;b<d;b++)if(e=a[b])e.onEnterTransitionDidFinish();break;case b.cleanup:for(b=0;b<d;b++)(e=a[b])&&e.cleanup();break;case b.updateTransform:for(b=0;b<d;b++)(e=a[b])&&e.updateTransform();break;case b.onExitTransitionDidStart:for(b=0;b<d;b++)if(e=a[b])e.onExitTransitionDidStart();break;case b.sortAllChildren:for(b=0;b<d;b++)(e=a[b])&&e.sortAllChildren();break;default:cc.assert(0,cc._LogInfos.Node__arrayMakeObjectsPerformSelector)}}},
attr:function(a){for(var c in a)this[c]=a[c]},getSkewX:function(){return this._skewX},setSkewX:function(a){this._skewX=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(a){this._skewY=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(a){this._localZOrder=a;this._parent&&this._parent.reorderChild(this,a);cc.eventManager._setDirtyForNode(this)},_setLocalZOrder:function(a){this._localZOrder=
a},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){cc.log(cc._LogInfos.Node_getZOrder);return this.getLocalZOrder()},setZOrder:function(a){cc.log(cc._LogInfos.Node_setZOrder);this.setLocalZOrder(a)},setGlobalZOrder:function(a){this._globalZOrder!==a&&(this._globalZOrder=a,cc.eventManager._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(a){this._vertexZ=a},getRotation:function(){this._rotationX!==
this._rotationY&&cc.log(cc._LogInfos.Node_getRotation);return this._rotationX},setRotation:function(a){this._rotationX=this._rotationY=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(a){this._rotationX=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(a){this._rotationY=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},
getScale:function(){this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale);return this._scaleX},setScale:function(a,c){this._scaleX=a;this._scaleY=c||0===c?c:a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(a){this._scaleX=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(a){this._scaleY=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},
setPosition:function(a,c){var b=this._position;if(void 0===c){if(b.x===a.x&&b.y===a.y)return;b.x=a.x;b.y=a.y}else{if(b.x===a&&b.y===c)return;b.x=a;b.y=c}this._usingNormalizedPosition=!1;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setNormalizedPosition:function(a,c){var b=this._normalizedPosition;void 0===c?(b.x=a.x,b.y=a.y):(b.x=a,b.y=c);this._normalizedPositionDirty=this._usingNormalizedPosition=!0;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPosition:function(){return cc.p(this._position)},
getNormalizedPosition:function(){return cc.p(this._normalizedPosition)},getPositionX:function(){return this._position.x},setPositionX:function(a){this._position.x=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(a){this._position.y=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},
setVisible:function(a){this._visible!==a&&(this._visible=a,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),cc.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(a,c){var b=this._anchorPoint;if(void 0===c){if(a.x===b.x&&a.y===b.y)return;b.x=a.x;b.y=a.y}else{if(a===b.x&&c===b.y)return;b.x=a;b.y=c}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(a){this._anchorPoint.x!==
a&&(this._anchorPoint.x=a,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(a){this._anchorPoint.y!==a&&(this._anchorPoint.y=a,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(a){this._contentSize.width=a;this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},
_setHeight:function(a){this._contentSize.height=a;this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return cc.size(this._contentSize)},setContentSize:function(a,c){var b=this._contentSize;if(void 0===c){if(a.width===b.width&&a.height===b.height)return;b.width=a.width;b.height=a.height}else{if(a===b.width&&c===b.height)return;b.width=a;b.height=c}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(a){this._parent=
a},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(a){a!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=a,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},getTag:function(){return this.tag},setTag:function(a){this.tag=a},setName:function(a){this._name=a},getName:function(){return this._name},getUserData:function(){return this.userData},setUserData:function(a){this.userData=a},getUserObject:function(){return this.userObject},
setUserObject:function(a){this.userObject!==a&&(this.userObject=a)},getOrderOfArrival:function(){return this.arrivalOrder},setOrderOfArrival:function(a){this.arrivalOrder=a},getActionManager:function(){this._actionManager||(this._actionManager=cc.director.getActionManager());return this._actionManager},setActionManager:function(a){this._actionManager!==a&&(this.stopAllActions(),this._actionManager=a)},getScheduler:function(){this._scheduler||(this._scheduler=cc.director.getScheduler());return this._scheduler},
setScheduler:function(a){this._scheduler!==a&&(this.unscheduleAllCallbacks(),this._scheduler=a)},boundingBox:function(){cc.log(cc._LogInfos.Node_boundingBox);return this.getBoundingBox()},getBoundingBox:function(){var a=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc._rectApplyAffineTransformIn(a,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions();this.unscheduleAllCallbacks();cc.eventManager.removeListeners(this);this._arrayMakeObjectsPerformSelector(this._children,
cc.Node._stateCallbackType.cleanup)},getChildByTag:function(a){var c=this._children;if(null!==c)for(var b=0;b<c.length;b++){var d=c[b];if(d&&d.tag===a)return d}return null},getChildByName:function(a){if(!a)return cc.log("Invalid name"),null;for(var c=this._children,b=0,d=c.length;b<d;b++)if(c[b]._name===a)return c[b];return null},addChild:function(a,c,b){c=void 0===c?a._localZOrder:c;var d,e=!1;cc.isUndefined(b)?(b=void 0,d=a._name):cc.isString(b)?(d=b,b=void 0):cc.isNumber(b)&&(e=!0,d="");cc.assert(a,
cc._LogInfos.Node_addChild_3);cc.assert(null===a._parent,"child already added. It can't be added again");this._addChildHelper(a,c,b,d,e)},_addChildHelper:function(a,c,b,d,e){this._children||(this._children=[]);this._insertChild(a,c);e?a.setTag(b):a.setName(d);a.setParent(this);a.setOrderOfArrival(cc.s_globalOrderOfArrival++);if(this._running&&(a.onEnter(),this._isTransitionFinished))a.onEnterTransitionDidFinish();this._cascadeColorEnabled&&a._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty);
this._cascadeOpacityEnabled&&a._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},removeFromParent:function(a){this._parent&&(void 0===a&&(a=!0),this._parent.removeChild(this,a))},removeFromParentAndCleanup:function(a){cc.log(cc._LogInfos.Node_removeFromParentAndCleanup);this.removeFromParent(a)},removeChild:function(a,c){0!==this._children.length&&(void 0===c&&(c=!0),-1<this._children.indexOf(a)&&this._detachChild(a,c),cc.renderer.childrenOrderDirty=!0)},removeChildByTag:function(a,c){a===
cc.NODE_TAG_INVALID&&cc.log(cc._LogInfos.Node_removeChildByTag);var b=this.getChildByTag(a);b?this.removeChild(b,c):cc.log(cc._LogInfos.Node_removeChildByTag_2,a)},removeAllChildrenWithCleanup:function(a){this.removeAllChildren(a)},removeAllChildren:function(a){var c=this._children;if(null!==c){void 0===a&&(a=!0);for(var b=0;b<c.length;b++){var d=c[b];d&&(this._running&&(d.onExitTransitionDidStart(),d.onExit()),a&&d.cleanup(),d.parent=null,d._renderCmd.detachFromParent())}this._children.length=0;
cc.renderer.childrenOrderDirty=!0}},_detachChild:function(a,c){this._running&&(a.onExitTransitionDidStart(),a.onExit());c&&a.cleanup();a.parent=null;a._renderCmd.detachFromParent();cc.arrayRemoveObject(this._children,a)},_insertChild:function(a,c){cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0;this._children.push(a);a._setLocalZOrder(c)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},reorderChild:function(a,c){cc.assert(a,cc._LogInfos.Node_reorderChild);
cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0;a.arrivalOrder=cc.s_globalOrderOfArrival;cc.s_globalOrderOfArrival++;a._setLocalZOrder(c)},sortAllChildren:function(){if(this._reorderChildDirty){var a=this._children,c=a.length,b,d,e;for(b=1;b<c;b++){e=a[b];for(d=b-1;0<=d;){if(e._localZOrder<a[d]._localZOrder)a[d+1]=a[d];else if(e._localZOrder===a[d]._localZOrder&&e.arrivalOrder<a[d].arrivalOrder)a[d+1]=a[d];else break;d--}a[d+1]=e}this._reorderChildDirty=!1}},draw:function(a){},transformAncestors:function(){null!==
this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1;this._running=!0;this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onEnter);this.resume()},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0;this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,
cc.Node._stateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=!1;this.pause();this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onExit);this.removeAllComponents()},runAction:function(a){cc.assert(a,cc._LogInfos.Node_runAction);this.actionManager.addAction(a,this,!this._running);return a},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(a){this.actionManager.removeAction(a)},
stopActionByTag:function(a){a===cc.ACTION_TAG_INVALID?cc.log(cc._LogInfos.Node_stopActionByTag):this.actionManager.removeActionByTag(a,this)},getActionByTag:function(a){return a===cc.ACTION_TAG_INVALID?(cc.log(cc._LogInfos.Node_getActionByTag),null):this.actionManager.getActionByTag(a,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(a){this.scheduler.scheduleUpdate(this,
a,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(a,c,b,d,e){var f=arguments.length;"function"===typeof a?1===f?(c=0,b=cc.REPEAT_FOREVER,d=0,e=this.__instanceId):2===f?"number"===typeof c?(b=cc.REPEAT_FOREVER,d=0,e=this.__instanceId):(e=c,c=0,b=cc.REPEAT_FOREVER,d=0):3===f?("string"===typeof b?(e=b,b=cc.REPEAT_FOREVER):e=this.__instanceId,d=0):4===f&&(e=this.__instanceId):1===f?(c=0,b=cc.REPEAT_FOREVER,d=0):2===f&&(b=cc.REPEAT_FOREVER,d=0);cc.assert(a,
cc._LogInfos.Node_schedule);cc.assert(0<=c,cc._LogInfos.Node_schedule_2);b=null==b?cc.REPEAT_FOREVER:b;this.scheduler.schedule(a,this,c||0,b,d||0,!this._running,e)},scheduleOnce:function(a,c,b){void 0===b&&(b=this.__instanceId);this.schedule(a,0,0,c,b)},unschedule:function(a){a&&this.scheduler.unschedule(a,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_resumeSchedulerAndActions);this.resume()},resume:function(){this.scheduler.resumeTarget(this);
this.actionManager&&this.actionManager.resumeTarget(this);cc.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_pauseSchedulerAndActions);this.pause()},pause:function(){this.scheduler.pauseTarget(this);this.actionManager&&this.actionManager.pauseTarget(this);cc.eventManager.pauseTarget(this)},setAdditionalTransform:function(a){if(void 0===a)return this._additionalTransformDirty=!1;this._additionalTransform=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);
this._additionalTransformDirty=!0},getParentToNodeTransform:function(){this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var a=this.getNodeToParentTransform(),c=this._parent;null!==c;c=c.parent)a=cc.affineTransformConcat(a,c.getNodeToParentTransform());return a},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return cc.affineTransformInvert(this.getNodeToWorldTransform())},
worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(a){return cc.pointApplyAffineTransform(a,this.getWorldToNodeTransform())},convertToWorldSpace:function(a){a=a||cc.p(0,0);return cc.pointApplyAffineTransform(a,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(a){return cc.pSub(this.convertToNodeSpace(a),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(a){a=a||cc.p(0,0);a=cc.pAdd(a,this._renderCmd.getAnchorPointInPoints());
return this.convertToWorldSpace(a)},_convertToWindowSpace:function(a){a=this.convertToWorldSpace(a);return cc.director.convertToUI(a)},convertTouchToNodeSpace:function(a){a=a.getLocation();return this.convertToNodeSpace(a)},convertTouchToNodeSpaceAR:function(a){a=cc.director.convertToGL(a.getLocation());return this.convertToNodeSpaceAR(a)},update:function(a){this._componentContainer&&!this._componentContainer.isEmpty()&&this._componentContainer.visit(a)},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,
cc.Node._stateCallbackType.updateTransform)},retain:function(){},release:function(){},getComponent:function(a){return this._componentContainer?this._componentContainer.getComponent(a):null},addComponent:function(a){this._componentContainer&&this._componentContainer.add(a)},removeComponent:function(a){return this._componentContainer?this._componentContainer.remove(a):!1},removeAllComponents:function(){this._componentContainer&&this._componentContainer.removeAll()},grid:null,visit:function(a){this._renderCmd.visit(a)},
transform:function(a,c){this._renderCmd.transform(a,c)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(){return this._renderCmd.getNodeToParentTransform()},getCamera:function(){this._camera||(this._camera=new cc.Camera);return this._camera},getGrid:function(){return this.grid},setGrid:function(a){this.grid=a},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(a){this._renderCmd.setShaderProgram(a)},
getGLServerState:function(){return 0},setGLServerState:function(a){},getBoundingBoxToWorld:function(){var a=cc.rect(0,0,this._contentSize.width,this._contentSize.height),c=this.getNodeToWorldTransform(),a=cc.rectApplyAffineTransform(a,c);if(!this._children)return a;for(var b=this._children,d=0;d<b.length;d++){var e=b[d];e&&e._visible&&(e=e._getBoundingBoxToCurrentNode(c))&&(a=cc.rectUnion(a,e))}return a},_getBoundingBoxToCurrentNode:function(a){var c=cc.rect(0,0,this._contentSize.width,this._contentSize.height);
a=void 0===a?this.getNodeToParentTransform():cc.affineTransformConcat(this.getNodeToParentTransform(),a);c=cc.rectApplyAffineTransform(c,a);if(!this._children)return c;for(var b=this._children,d=0;d<b.length;d++){var e=b[d];e&&e._visible&&(e=e._getBoundingBoxToCurrentNode(a))&&(c=cc.rectUnion(c,e))}return c},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(a){this._realOpacity=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},
updateDisplayedOpacity:function(a){this._renderCmd._updateDisplayOpacity(a)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(a){this._cascadeOpacityEnabled!==a&&(this._cascadeOpacityEnabled=a,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var a=this._realColor;return cc.color(a.r,a.g,a.b,a.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(a){var c=this._realColor;c.r=a.r;c.g=
a.g;c.b=a.b;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(a){this._renderCmd._updateDisplayColor(a)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(a){this._cascadeColorEnabled!==a&&(this._cascadeColorEnabled=a,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return!1},_initRendererCmd:function(){this._renderCmd=cc.renderer.getRenderCmd(this)},
_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.Node.CanvasRenderCmd(this):new cc.Node.WebGLRenderCmd(this)},enumerateChildren:function(a,c){cc.assert(a&&0!=a.length,"Invalid name");cc.assert(null!=c,"Invalid callback function");var b=a.length,d=0,e=b,f=!1;2<b&&("/"===a[0]&&"/"===a[1])&&(f=!0,d=2,e-=2);var g=!1;3<b&&("/"===a[b-3]&&"."===a[b-2]&&"."===a[b-1])&&(g=!0,e-=3);b=a.substr(d,e);g&&(b="[[:alnum:]]+/"+b);f?this.doEnumerateRecursive(this,b,c):this.doEnumerate(b,
c)},doEnumerateRecursive:function(a,c,b){if(!a.doEnumerate(c,b))for(var d=a.getChildren(),e=d.length,f=0;f<e&&!(a=d[f],this.doEnumerateRecursive(a,c,b));f++);},doEnumerate:function(a,c){var b=a.indexOf("/"),d=a,e=!1;-1!==b&&(d=a.substr(0,b),e=!0);for(var b=!1,f,g=this._children,h=g.length,k=0;k<h;k++)if(f=g[k],-1!==f._name.indexOf(d))if(e){if(b=f.doEnumerate(a,c))break}else if(c(f)){b=!0;break}return b}});cc.Node.create=function(){return new cc.Node};
cc.Node._stateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7};cc.assert(cc.isFunction(cc._tmp.PrototypeCCNode),cc._LogInfos.MissingFile,"BaseNodesPropertyDefine.js");cc._tmp.PrototypeCCNode();delete cc._tmp.PrototypeCCNode;cc.CustomRenderCmd=function(a,c){this._needDraw=!0;this._target=a;this._callback=c;this.rendering=function(a,c,e){this._callback&&this._callback.call(this._target,a,c,e)}};cc.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,all:255};
cc.Node.RenderCmd=function(a){this._dirtyFlag=1;this._node=a;this._needDraw=!1;this._anchorPointInPoints=new cc.Point(0,0);this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0};this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0};this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0};this._displayedOpacity=255;this._displayedColor=cc.color(255,255,255,255);this._cascadeOpacityEnabledDirty=this._cascadeColorEnabledDirty=!1;this._curLevel=-1};
cc.Node.RenderCmd.prototype={constructor:cc.Node.RenderCmd,getAnchorPointInPoints:function(){return cc.p(this._anchorPointInPoints)},getDisplayedColor:function(){var a=this._displayedColor;return cc.color(a.r,a.g,a.b,a.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0;this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0;this.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},
getParentToNodeTransform:function(){this._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&(this._inverse=cc.affineTransformInvert(this.getNodeToParentTransform()));return this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var a=this._anchorPointInPoints,c=this._node._contentSize,b=this._node._anchorPoint;a.x=c.width*b.x;a.y=c.height*b.y;this.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setDirtyFlag:function(a){0===this._dirtyFlag&&0!==a&&cc.renderer.pushDirtyNode(this);
this._dirtyFlag|=a},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},_updateDisplayColor:function(a){var c=this._node,b=this._displayedColor,d=c._realColor,e;if(this._cascadeColorEnabledDirty&&!c._cascadeColorEnabled){b.r=d.r;b.g=d.g;b.b=d.b;b=new cc.Color(255,255,255,255);a=c._children;c=0;for(d=a.length;c<d;c++)(e=a[c])&&e._renderCmd&&e._renderCmd._updateDisplayColor(b);this._cascadeColorEnabledDirty=!1}else if(void 0===
a&&(a=(a=c._parent)&&a._cascadeColorEnabled?a.getDisplayedColor():cc.color.WHITE),b.r=0|d.r*a.r/255,b.g=0|d.g*a.g/255,b.b=0|d.b*a.b/255,c._cascadeColorEnabled){a=c._children;c=0;for(d=a.length;c<d;c++)if((e=a[c])&&e._renderCmd)e._renderCmd._updateDisplayColor(b),e._renderCmd._updateColor()}this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.colorDirty},_updateDisplayOpacity:function(a){var c=this._node,b,d;if(this._cascadeOpacityEnabledDirty&&!c._cascadeOpacityEnabled){this._displayedOpacity=c._realOpacity;
b=c._children;a=0;for(c=b.length;a<c;a++)(d=b[a])&&d._renderCmd&&d._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else if(void 0===a&&(b=c._parent,a=255,b&&b._cascadeOpacityEnabled&&(a=b.getDisplayedOpacity())),this._displayedOpacity=c._realOpacity*a/255,c._cascadeOpacityEnabled){b=c._children;a=0;for(c=b.length;a<c;a++)if((d=b[a])&&d._renderCmd)d._renderCmd._updateDisplayOpacity(this._displayedOpacity),d._renderCmd._updateColor()}this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.opacityDirty},
_syncDisplayColor:function(a){var c=this._node,b=this._displayedColor,d=c._realColor;void 0===a&&(a=(a=c._parent)&&a._cascadeColorEnabled?a.getDisplayedColor():cc.color.WHITE);b.r=0|d.r*a.r/255;b.g=0|d.g*a.g/255;b.b=0|d.b*a.b/255},_syncDisplayOpacity:function(a){var c=this._node;if(void 0===a){var b=c._parent;a=255;b&&b._cascadeOpacityEnabled&&(a=b.getDisplayedOpacity())}this._displayedOpacity=c._realOpacity*a/255},_updateColor:function(){},updateStatus:function(){var a=cc.Node._dirtyFlags,c=this._dirtyFlag,
b=c&a.colorDirty,d=c&a.opacityDirty;b&&this._updateDisplayColor();d&&this._updateDisplayOpacity();(b||d)&&this._updateColor();c&a.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty)}};
(function(){cc.Node.CanvasRenderCmd=function(a){cc.Node.RenderCmd.call(this,a);this._cachedParent=null;this._cacheDirty=!1};var a=cc.Node.CanvasRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);a.constructor=cc.Node.CanvasRenderCmd;a.transform=function(a,b){var d=this.getNodeToParentTransform(),e=this._worldTransform;this._cacheDirty=!0;if(a){var f=a._worldTransform;e.a=d.a*f.a+d.b*f.c;e.b=d.a*f.b+d.b*f.d;e.c=d.c*f.a+d.d*f.c;e.d=d.c*f.b+d.d*f.d;e.tx=f.a*d.tx+f.c*d.ty+f.tx;e.ty=f.d*d.ty+
f.ty+f.b*d.tx}else e.a=d.a,e.b=d.b,e.c=d.c,e.d=d.d,e.tx=d.tx,e.ty=d.ty;if(b&&(d=this._node._children)&&0!==d.length){e=0;for(f=d.length;e<f;e++)d[e]._renderCmd.transform(this,b)}};a.getNodeToParentTransform=function(){var a=this._node,b=!1;a._usingNormalizedPosition&&a._parent&&(b=a._parent._contentSize,a._position.x=a._normalizedPosition.x*b.width,a._position.y=a._normalizedPosition.y*b.height,a._normalizedPositionDirty=!1,b=!0);if(b||this._dirtyFlag&cc.Node._dirtyFlags.transformDirty){b=this._transform;
b.tx=a._position.x;b.ty=a._position.y;var d=1,e=0,f=0,g=1;a._rotationX&&(g=0.017453292519943295*a._rotationX,f=Math.sin(g),g=Math.cos(g));a._rotationY&&(e=0.017453292519943295*a._rotationY,d=Math.cos(e),e=-Math.sin(e));b.a=d;b.b=e;b.c=f;b.d=g;var h=a._scaleX,k=a._scaleY,l=this._anchorPointInPoints.x,n=this._anchorPointInPoints.y,m=1E-6>h&&-1E-6<h?1E-6:h,p=1E-6>k&&-1E-6<k?1E-6:k;if(1!==h||1!==k)d=b.a*=m,e=b.b*=m,f=b.c*=p,g=b.d*=p;if(a._skewX||a._skewY)h=Math.tan(-a._skewX*Math.PI/180),k=Math.tan(-a._skewY*
Math.PI/180),Infinity===h&&(h=99999999),Infinity===k&&(k=99999999),m=n*h,p=l*k,b.a=d-f*k,b.b=e-g*k,b.c=f-d*h,b.d=g-e*h,b.tx+=d*m+f*p,b.ty+=e*m+g*p;b.tx-=d*l+f*n;b.ty-=e*l+g*n;a._ignoreAnchorPointForPosition&&(b.tx+=l,b.ty+=n);a._additionalTransformDirty&&(this._transform=cc.affineTransformConcat(b,a._additionalTransform))}return this._transform};a.visit=function(a){var b=this._node;if(b._visible){if(a=a||this.getParentRenderCmd())this._curLevel=a._curLevel+1;var d=b._children,e;this._syncStatus(a);
a=d.length;if(0<a){b.sortAllChildren();for(b=0;b<a;b++)if(e=d[b],0>e._localZOrder)e._renderCmd.visit(this);else break;for(cc.renderer.pushRenderCommand(this);b<a;b++)d[b]._renderCmd.visit(this)}else cc.renderer.pushRenderCommand(this);this._dirtyFlag=0}};a._syncStatus=function(a){var b=cc.Node._dirtyFlags,d=this._dirtyFlag,e=a?a._node:null;e&&(e._cascadeColorEnabled&&a._dirtyFlag&b.colorDirty)&&(d|=b.colorDirty);e&&(e._cascadeOpacityEnabled&&a._dirtyFlag&b.opacityDirty)&&(d|=b.opacityDirty);a&&a._dirtyFlag&
b.transformDirty&&(d|=b.transformDirty);var e=d&b.colorDirty,f=d&b.opacityDirty,b=d&b.transformDirty;this._dirtyFlag=d;e&&this._syncDisplayColor();f&&this._syncDisplayOpacity();e&&this._updateColor();b&&this.transform(a)};a.setDirtyFlag=function(a){cc.Node.RenderCmd.prototype.setDirtyFlag.call(this,a);this._setCacheDirty();this._cachedParent&&this._cachedParent.setDirtyFlag(a)};a._setCacheDirty=function(){if(!1===this._cacheDirty){this._cacheDirty=!0;var a=this._cachedParent;a&&a!==this&&a._setNodeDirtyForCache&&
a._setNodeDirtyForCache()}};a._setCachedParent=function(a){if(this._cachedParent!==a){this._cachedParent=a;for(var b=this._node._children,d=0,e=b.length;d<e;d++)b[d]._renderCmd._setCachedParent(a)}};a.detachFromParent=function(){this._cachedParent=null;for(var a=this._node._children,b,d=0,e=a.length;d<e;d++)(b=a[d])&&b._renderCmd&&b._renderCmd.detachFromParent()};a.setShaderProgram=function(a){};a.getShaderProgram=function(){return null};cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(a){return a?
a.src===cc.SRC_ALPHA&&a.dst===cc.ONE||a.src===cc.ONE&&a.dst===cc.ONE?"lighter":a.src===cc.ZERO&&a.dst===cc.SRC_ALPHA?"destination-in":a.src===cc.ZERO&&a.dst===cc.ONE_MINUS_SRC_ALPHA?"destination-out":"source-over":"source-over"}})();cc._tmp.PrototypeTexture2D=function(){var a=cc.Texture2D;a.PVRImagesHavePremultipliedAlpha=function(a){cc.PVRHaveAlphaPremultiplied_=a};a.PIXEL_FORMAT_RGBA8888=2;a.PIXEL_FORMAT_RGB888=3;a.PIXEL_FORMAT_RGB565=4;a.PIXEL_FORMAT_A8=5;a.PIXEL_FORMAT_I8=6;a.PIXEL_FORMAT_AI88=7;a.PIXEL_FORMAT_RGBA4444=8;a.PIXEL_FORMAT_RGB5A1=7;a.PIXEL_FORMAT_PVRTC4=9;a.PIXEL_FORMAT_PVRTC2=10;a.PIXEL_FORMAT_DEFAULT=a.PIXEL_FORMAT_RGBA8888;var c=cc.Texture2D._M={};c[a.PIXEL_FORMAT_RGBA8888]="RGBA8888";c[a.PIXEL_FORMAT_RGB888]=
"RGB888";c[a.PIXEL_FORMAT_RGB565]="RGB565";c[a.PIXEL_FORMAT_A8]="A8";c[a.PIXEL_FORMAT_I8]="I8";c[a.PIXEL_FORMAT_AI88]="AI88";c[a.PIXEL_FORMAT_RGBA4444]="RGBA4444";c[a.PIXEL_FORMAT_RGB5A1]="RGB5A1";c[a.PIXEL_FORMAT_PVRTC4]="PVRTC4";c[a.PIXEL_FORMAT_PVRTC2]="PVRTC2";c=cc.Texture2D._B={};c[a.PIXEL_FORMAT_RGBA8888]=32;c[a.PIXEL_FORMAT_RGB888]=24;c[a.PIXEL_FORMAT_RGB565]=16;c[a.PIXEL_FORMAT_A8]=8;c[a.PIXEL_FORMAT_I8]=8;c[a.PIXEL_FORMAT_AI88]=16;c[a.PIXEL_FORMAT_RGBA4444]=16;c[a.PIXEL_FORMAT_RGB5A1]=16;
c[a.PIXEL_FORMAT_PVRTC4]=4;c[a.PIXEL_FORMAT_PVRTC2]=3;c=cc.Texture2D.prototype;cc.defineGetterSetter(c,"name",c.getName);cc.defineGetterSetter(c,"pixelFormat",c.getPixelFormat);cc.defineGetterSetter(c,"pixelsWidth",c.getPixelsWide);cc.defineGetterSetter(c,"pixelsHeight",c.getPixelsHigh);cc.defineGetterSetter(c,"width",c._getWidth);cc.defineGetterSetter(c,"height",c._getHeight);a.defaultPixelFormat=a.PIXEL_FORMAT_DEFAULT};
cc._tmp.PrototypeTextureAtlas=function(){var a=cc.TextureAtlas.prototype;cc.defineGetterSetter(a,"totalQuads",a.getTotalQuads);cc.defineGetterSetter(a,"capacity",a.getCapacity);cc.defineGetterSetter(a,"quads",a.getQuads,a.setQuads)};cc.ALIGN_CENTER=51;cc.ALIGN_TOP=19;cc.ALIGN_TOP_RIGHT=18;cc.ALIGN_RIGHT=50;cc.ALIGN_BOTTOM_RIGHT=34;cc.ALIGN_BOTTOM=35;cc.ALIGN_BOTTOM_LEFT=33;cc.ALIGN_LEFT=49;cc.ALIGN_TOP_LEFT=17;cc.PVRHaveAlphaPremultiplied_=!1;
cc._renderType===cc._RENDER_TYPE_CANVAS?(cc.Texture2D=cc.Class.extend({_contentSize:null,_textureLoaded:!1,_htmlElementObj:null,url:null,_pattern:null,ctor:function(){this._contentSize=cc.size(0,0);this._textureLoaded=!1;this._htmlElementObj=null;this._pattern=""},getPixelsWide:function(){return this._contentSize.width},getPixelsHigh:function(){return this._contentSize.height},getContentSize:function(){var a=cc.contentScaleFactor();return cc.size(this._contentSize.width/a,this._contentSize.height/
a)},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(a){a&&(this._htmlElementObj=a,this._contentSize.width=a.width,this._contentSize.height=a.height,this._textureLoaded=!0)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(){if(!this._textureLoaded){if(!this._htmlElementObj){var a=
cc.loader.getRes(this.url);if(!a)return;this.initWithElement(a)}a=this._htmlElementObj;this._contentSize.width=a.width;this._contentSize.height=a.height;this.dispatchEvent("load")}},description:function(){return"\x3ccc.Texture2D | width \x3d "+this._contentSize.width+" height "+this._contentSize.height+"\x3e"},initWithData:function(a,c,b,d,e){return!1},initWithImage:function(a){return!1},initWithString:function(a,c,b,d,e,f){return!1},releaseTexture:function(){cc.loader.release(this.url)},getName:function(){return null},
getMaxS:function(){return 1},setMaxS:function(a){},getMaxT:function(){return 1},setMaxT:function(a){},getPixelFormat:function(){return null},getShaderProgram:function(){return null},setShaderProgram:function(a){},hasPremultipliedAlpha:function(){return!1},hasMipmaps:function(){return!1},releaseData:function(a){},keepData:function(a,c){return a},drawAtPoint:function(a){},drawInRect:function(a){},initWithETCFile:function(a){cc.log(cc._LogInfos.Texture2D_initWithETCFile);return!1},initWithPVRFile:function(a){cc.log(cc._LogInfos.Texture2D_initWithPVRFile);
return!1},initWithPVRTCData:function(a,c,b,d,e,f){cc.log(cc._LogInfos.Texture2D_initWithPVRTCData);return!1},setTexParameters:function(a,c,b,d){void 0!==c&&(a={minFilter:a,magFilter:c,wrapS:b,wrapT:d});this._pattern=a.wrapS===cc.REPEAT&&a.wrapT===cc.REPEAT?"repeat":a.wrapS===cc.REPEAT?"repeat-x":a.wrapT===cc.REPEAT?"repeat-y":""},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(a){return-1},
addLoadedEventListener:function(a,c){this.addEventListener("load",a,c)},removeLoadedEventListener:function(a){this.removeEventListener("load",a)},_grayElementObj:null,_backupElement:null,_isGray:!1,_switchToGray:function(a){this._textureLoaded&&this._isGray!==a&&((this._isGray=a)?(this._backupElement=this._htmlElementObj,this._grayElementObj||(this._grayElementObj=cc.Texture2D._generateGrayTexture(this._htmlElementObj)),this._htmlElementObj=this._grayElementObj):null!==this._backupElement&&(this._htmlElementObj=
this._backupElement))}}),cc.Texture2D._generateGrayTexture=function(a,c,b){if(null===a)return null;b=b||cc.newElement("canvas");c=c||cc.rect(0,0,a.width,a.height);b.width=c.width;b.height=c.height;var d=b.getContext("2d");d.drawImage(a,c.x,c.y,c.width,c.height,0,0,c.width,c.height);a=d.getImageData(0,0,c.width,c.height);c=a.data;for(var e=0,f=c.length;e<f;e+=4)c[e]=c[e+1]=c[e+2]=0.34*c[e]+0.5*c[e+1]+0.16*c[e+2];d.putImageData(a,0,0);return b}):(cc.assert(cc.isFunction(cc._tmp.WebGLTexture2D),cc._LogInfos.MissingFile,
"TexturesWebGL.js"),cc._tmp.WebGLTexture2D(),delete cc._tmp.WebGLTexture2D);cc.EventHelper.prototype.apply(cc.Texture2D.prototype);cc.assert(cc.isFunction(cc._tmp.PrototypeTexture2D),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js");cc._tmp.PrototypeTexture2D();delete cc._tmp.PrototypeTexture2D;cc.textureCache={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1E3*Math.random(),_loadedTexturesBefore:{},_initializingRenderer:function(){var a,c=this._loadedTexturesBefore,b=this._textures;for(a in c){var d=c[a];d.handleLoadedTexture();b[a]=d}this._loadedTexturesBefore={}},addPVRTCImage:function(a){cc.log(cc._LogInfos.textureCache_addPVRTCImage)},addETCImage:function(a){cc.log(cc._LogInfos.textureCache_addETCImage)},description:function(){return"\x3cTextureCache | Number of textures \x3d "+
this._textures.length+"\x3e"},textureForKey:function(a){cc.log(cc._LogInfos.textureCache_textureForKey);return this.getTextureForKey(a)},getTextureForKey:function(a){return this._textures[a]||this._textures[cc.loader._aliases[a]]},getKeyByTexture:function(a){for(var c in this._textures)if(this._textures[c]===a)return c;return null},_generalTextureKey:function(){this._textureKeySeq++;return"_textureKey_"+this._textureKeySeq},getTextureColors:function(a){var c=this.getKeyByTexture(a);c||(c=a instanceof
HTMLImageElement?a.src:this._generalTextureKey());this._textureColorsCache[c]||(this._textureColorsCache[c]=cc.Sprite.CanvasRenderCmd._generateTextureCacheForColor(a));return this._textureColorsCache[c]},addPVRImage:function(a){cc.log(cc._LogInfos.textureCache_addPVRImage)},removeAllTextures:function(){var a=this._textures,c;for(c in a)a[c]&&a[c].releaseTexture();this._textures={}},removeTexture:function(a){if(a){var c=this._textures,b;for(b in c)c[b]===a&&(c[b].releaseTexture(),delete c[b])}},removeTextureForKey:function(a){null!=
a&&this._textures[a]&&delete this._textures[a]},cacheImage:function(a,c){if(c instanceof cc.Texture2D)this._textures[a]=c;else{var b=new cc.Texture2D;b.initWithElement(c);b.handleLoadedTexture();this._textures[a]=b}},addUIImage:function(a,c){cc.assert(a,cc._LogInfos.textureCache_addUIImage_2);if(c&&this._textures[c])return this._textures[c];var b=new cc.Texture2D;b.initWithImage(a);null!=c?this._textures[c]=b:cc.log(cc._LogInfos.textureCache_addUIImage);return b},dumpCachedTextureInfo:function(){var a=
0,c=0,b=this._textures,d;for(d in b){var e=b[d];a++;e.getHtmlElementObj()instanceof HTMLImageElement?cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo,d,e.getHtmlElementObj().src,e.pixelsWidth,e.pixelsHeight):cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,d,e.pixelsWidth,e.pixelsHeight);c+=4*e.pixelsWidth*e.pixelsHeight}b=this._textureColorsCache;for(d in b){var e=b[d],f;for(f in e){var g=e[f];a++;cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,d,g.width,g.height);c+=4*g.width*
g.height}}cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_3,a,c/1024,(c/1048576).toFixed(2))},_clear:function(){this._textures={};this._textureColorsCache={};this._textureKeySeq=0|1E3*Math.random();this._loadedTexturesBefore={}}};
if(cc._renderType===cc._RENDER_TYPE_CANVAS){var _p=cc.textureCache;_p.handleLoadedTexture=function(a){var c=this._textures,b=c[a];b||(b=c[a]=new cc.Texture2D,b.url=a);b.handleLoadedTexture()};_p.addImage=function(a,c,b){cc.assert(a,cc._LogInfos.Texture2D_addImage);var d=this._textures,e=d[a]||d[cc.loader._aliases[a]];if(e)return c&&c.call(b,e),e;e=d[a]=new cc.Texture2D;e.url=a;(cc.loader._checkIsImageURL(a)?cc.loader.load:cc.loader.loadImg).call(cc.loader,a,function(e,g){if(e)return c&&c.call(b,e);
cc.textureCache.handleLoadedTexture(a);var h=d[a];c&&c.call(b,h)});return e};_p.addImageAsync=_p.addImage;_p=null}else cc.assert(cc.isFunction(cc._tmp.WebGLTextureCache),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureCache(),delete cc._tmp.WebGLTextureCache;cc.rendererCanvas={childrenOrderDirty:!0,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,getRenderCmd:function(a){return a._createRenderCmd()},rendering:function(a){var c=this._renderCmds,b,d=cc.view.getScaleX(),e=cc.view.getScaleY(),f=a||cc._renderContext;f.computeRealOffsetY();a=0;for(b=c.length;a<b;a++)c[a].rendering(f,d,e)},_renderingToCacheCanvas:function(a,c,b,d){a||cc.log("The context of RenderTexture is invalid.");b=cc.isUndefined(b)?
1:b;d=cc.isUndefined(d)?1:d;c=c||this._currentID;var e=this._cacheToCanvasCmds[c],f,g;a.computeRealOffsetY();f=0;for(g=e.length;f<g;f++)e[f].rendering(a,b,d);e.length=0;a=this._cacheInstanceIds;delete this._cacheToCanvasCmds[c];cc.arrayRemoveObject(a,c);0===a.length?this._isCacheToCanvasOn=!1:this._currentID=a[a.length-1]},_turnToCacheMode:function(a){this._isCacheToCanvasOn=!0;a=a||0;this._cacheToCanvasCmds[a]=[];-1===this._cacheInstanceIds.indexOf(a)&&this._cacheInstanceIds.push(a);this._currentID=
a},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},resetFlag:function(){this.childrenOrderDirty=!1;this._transformNodePool.length=0},transform:function(){var a=this._transformNodePool;a.sort(this._sortNodeByLevelAsc);for(var c=0,b=a.length;c<b;c++)0!==a[c]._dirtyFlag&&a[c].updateStatus();a.length=0},transformDirty:function(){return 0<this._transformNodePool.length},_sortNodeByLevelAsc:function(a,c){return a._curLevel-c._curLevel},pushDirtyNode:function(a){this._transformNodePool.push(a)},
clearRenderCommands:function(){this._renderCmds.length=0},pushRenderCommand:function(a){if(a._needDraw)if(this._isCacheToCanvasOn){var c=this._cacheToCanvasCmds[this._currentID];-1===c.indexOf(a)&&c.push(a)}else-1===this._renderCmds.indexOf(a)&&this._renderCmds.push(a)}};cc._renderType===cc._RENDER_TYPE_CANVAS&&(cc.renderer=cc.rendererCanvas);
(function(){cc.CanvasContextWrapper=function(a){this._context=a;this._saveCount=0;this._currentAlpha=a.globalAlpha;this._currentCompositeOperation=a.globalCompositeOperation;this._currentFillStyle=a.fillStyle;this._currentStrokeStyle=a.strokeStyle;this._offsetY=this._offsetX=0;this._realOffsetY=this.height;this._armatureMode=0};var a=cc.CanvasContextWrapper.prototype;a.resetCache=function(){var a=this._context;this._currentAlpha=a.globalAlpha;this._currentCompositeOperation=a.globalCompositeOperation;
this._currentFillStyle=a.fillStyle;this._currentStrokeStyle=a.strokeStyle;this._realOffsetY=this._context.canvas.height+this._offsetY};a.setOffset=function(a,b){this._offsetX=a;this._offsetY=b;this._realOffsetY=this._context.canvas.height+this._offsetY};a.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY};a.setViewScale=function(a,b){this._scaleX=a;this._scaleY=b};a.getContext=function(){return this._context};a.save=function(){this._context.save();this._saveCount++};
a.restore=function(){this._context.restore();this._saveCount--};a.setGlobalAlpha=function(a){0<this._saveCount?this._context.globalAlpha=a:this._currentAlpha!==a&&(this._currentAlpha=a,this._context.globalAlpha=a)};a.setCompositeOperation=function(a){0<this._saveCount?this._context.globalCompositeOperation=a:this._currentCompositeOperation!==a&&(this._currentCompositeOperation=a,this._context.globalCompositeOperation=a)};a.setFillStyle=function(a){0<this._saveCount?this._context.fillStyle=a:this._currentFillStyle!==
a&&(this._currentFillStyle=a,this._context.fillStyle=a)};a.setStrokeStyle=function(a){0<this._saveCount?this._context.strokeStyle=a:this._currentStrokeStyle!==a&&(this._currentStrokeStyle=a,this._context.strokeStyle=a)};a.setTransform=function(a,b,d){0<this._armatureMode?(this.restore(),this.save(),this._context.transform(a.a,-a.b,-a.c,a.d,a.tx*b,-(a.ty*d))):this._context.setTransform(a.a,-a.b,-a.c,a.d,this._offsetX+a.tx*b,this._realOffsetY-a.ty*d)};a._switchToArmatureMode=function(a,b,d,e){a?(this._armatureMode++,
this._context.setTransform(b.a,b.c,b.b,b.d,this._offsetX+b.tx*d,this._realOffsetY-b.ty*e),this.save()):(this._armatureMode--,this.restore())}})();cc.rendererWebGL={childrenOrderDirty:!0,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,getRenderCmd:function(a){return a._createRenderCmd()},rendering:function(a){var c=this._renderCmds,b,d=a||cc._renderContext;a=0;for(b=c.length;a<b;a++)c[a].rendering(d)},_turnToCacheMode:function(a){this._isCacheToBufferOn=!0;a=a||0;this._cacheToBufferCmds[a]=[];this._cacheInstanceIds.push(a);this._currentID=a},_turnToNormalMode:function(){this._isCacheToBufferOn=
!1},_renderingToBuffer:function(a){a=a||this._currentID;var c=this._cacheToBufferCmds[a],b,d,e=cc._renderContext,f=this._cacheInstanceIds;b=0;for(d=c.length;b<d;b++)c[b].rendering(e);c.length=0;delete this._cacheToBufferCmds[a];cc.arrayRemoveObject(f,a);0===f.length?this._isCacheToBufferOn=!1:this._currentID=f[f.length-1]},resetFlag:function(){this.childrenOrderDirty=!1;this._transformNodePool.length=0},transform:function(){var a=this._transformNodePool;a.sort(this._sortNodeByLevelAsc);for(var c=
0,b=a.length;c<b;c++)a[c].updateStatus();a.length=0},transformDirty:function(){return 0<this._transformNodePool.length},_sortNodeByLevelAsc:function(a,c){return a._curLevel-c._curLevel},pushDirtyNode:function(a){this._transformNodePool.push(a)},clearRenderCommands:function(){this._renderCmds.length=0},pushRenderCommand:function(a){if(a._needDraw)if(this._isCacheToBufferOn){var c=this._cacheToBufferCmds[this._currentID];-1===c.indexOf(a)&&c.push(a)}else-1===this._renderCmds.indexOf(a)&&this._renderCmds.push(a)}};
cc._renderType===cc._RENDER_TYPE_WEBGL&&(cc.renderer=cc.rendererWebGL);cc.Scene=cc.Node.extend({_className:"Scene",ctor:function(){cc.Node.prototype.ctor.call(this);this._ignoreAnchorPointForPosition=!0;this.setAnchorPoint(0.5,0.5);this.setContentSize(cc.director.getWinSize())}});cc.Scene.create=function(){return new cc.Scene};cc.LoaderScene=cc.Scene.extend({_interval:null,_label:null,_className:"LoaderScene",cb:null,target:null,init:function(){var a=this,c=200,b=a._bgLayer=new cc.LayerColor(cc.color(32,32,32,255));a.addChild(b,0);var d=24,e=-c/2+100;cc._loaderImage&&(cc.loader.loadImg(cc._loaderImage,{isCrossOrigin:!1},function(b,d){c=d.height;a._initStage(d,cc.visibleRect.center)}),d=14,e=-c/2-10);d=a._label=new cc.LabelTTF("Loading... 0%","Arial",d);d.setPosition(cc.pAdd(cc.visibleRect.center,cc.p(0,e)));d.setColor(cc.color(180,
180,180));b.addChild(this._label,10);return!0},_initStage:function(a,c){var b=this._texture2d=new cc.Texture2D;b.initWithElement(a);b.handleLoadedTexture();b=this._logo=new cc.Sprite(b);b.setScale(cc.contentScaleFactor());b.x=c.x;b.y=c.y;this._bgLayer.addChild(b,10)},onEnter:function(){cc.Node.prototype.onEnter.call(this);this.schedule(this._startLoading,0.3)},onExit:function(){cc.Node.prototype.onExit.call(this);this._label.setString("Loading... 0%")},initWithResources:function(a,c,b){cc.isString(a)&&
(a=[a]);this.resources=a||[];this.cb=c;this.target=b},_startLoading:function(){var a=this;a.unschedule(a._startLoading);cc.loader.load(a.resources,function(c,b,d){c=Math.min(100*(d/b)|0,100);a._label.setString("Loading... "+c+"%")},function(){a.cb&&a.cb.call(a.target)})}});cc.LoaderScene.preload=function(a,c,b){var d=cc;d.loaderScene||(d.loaderScene=new cc.LoaderScene,d.loaderScene.init());d.loaderScene.initWithResources(a,c,b);cc.director.runScene(d.loaderScene);return d.loaderScene};cc.Layer=cc.Node.extend({_className:"Layer",ctor:function(){var a=cc.Node.prototype;a.ctor.call(this);this._ignoreAnchorPointForPosition=!0;a.setAnchorPoint.call(this,0.5,0.5);a.setContentSize.call(this,cc.winSize)},init:function(){this._ignoreAnchorPointForPosition=!0;this.setAnchorPoint(0.5,0.5);this.setContentSize(cc.winSize);this._cascadeOpacityEnabled=this._cascadeColorEnabled=!1;return!0},bake:function(){this._renderCmd.bake()},unbake:function(){this._renderCmd.unbake()},isBaked:function(){return this._isBaked},
addChild:function(a,c,b){cc.Node.prototype.addChild.call(this,a,c,b);this._renderCmd._bakeForAddChild(a)},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.Layer.CanvasRenderCmd(this):new cc.Layer.WebGLRenderCmd(this)}});cc.Layer.create=function(){return new cc.Layer};
cc.LayerColor=cc.Layer.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(a,c){this.width=a;this.height=c},changeWidth:function(a){this.width=a},changeHeight:function(a){this.height=a},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return!1},ctor:function(a,c,b){cc.Layer.prototype.ctor.call(this);this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);cc.LayerColor.prototype.init.call(this,a,c,b)},init:function(a,
c,b){cc._renderType!==cc._RENDER_TYPE_CANVAS&&(this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_COLOR));var d=cc.director.getWinSize();a=a||cc.color(0,0,0,255);c=void 0===c?d.width:c;b=void 0===b?d.height:b;d=this._realColor;d.r=a.r;d.g=a.g;d.b=a.b;this._realOpacity=a.a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty);cc.LayerColor.prototype.setContentSize.call(this,c,b);return!0},setBlendFunc:function(a,c){var b=this._blendFunc;void 0===
c?(b.src=a.src,b.dst=a.dst):(b.src=a,b.dst=c);this._renderCmd.updateBlendFunc(b)},_setWidth:function(a){cc.Node.prototype._setWidth.call(this,a);this._renderCmd._updateSquareVerticesWidth(a)},_setHeight:function(a){cc.Node.prototype._setHeight.call(this,a);this._renderCmd._updateSquareVerticesHeight(a)},setContentSize:function(a,c){cc.Layer.prototype.setContentSize.call(this,a,c);this._renderCmd._updateSquareVertices(a,c)},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?
new cc.LayerColor.CanvasRenderCmd(this):new cc.LayerColor.WebGLRenderCmd(this)}});cc.LayerColor.create=function(a,c,b){return new cc.LayerColor(a,c,b)};(function(){var a=cc.LayerColor.prototype;cc.defineGetterSetter(a,"width",a._getWidth,a._setWidth);cc.defineGetterSetter(a,"height",a._getHeight,a._setHeight)})();
cc.LayerGradient=cc.LayerColor.extend({_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:!1,_className:"LayerGradient",_colorStops:[],ctor:function(a,c,b,d){cc.LayerColor.prototype.ctor.call(this);this._endColor=cc.color(0,0,0,255);this._alongVector=cc.p(0,-1);this._endOpacity=this._startOpacity=255;d&&d instanceof Array?(this._colorStops=d,d.splice(0,0,{p:0,color:a||cc.color.BLACK}),d.push({p:1,color:c||cc.color.BLACK})):this._colorStops=[{p:0,color:a||cc.color.BLACK},
{p:1,color:c||cc.color.BLACK}];cc.LayerGradient.prototype.init.call(this,a,c,b,d)},init:function(a,c,b,d){a=a||cc.color(0,0,0,255);c=c||cc.color(0,0,0,255);b=b||cc.p(0,-1);d=this._endColor;this._startOpacity=a.a;d.r=c.r;d.g=c.g;d.b=c.b;this._endOpacity=c.a;this._alongVector=b;this._compressedInterpolation=!0;cc.LayerColor.prototype.init.call(this,cc.color(a.r,a.g,a.b,255));this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty);
return!0},setContentSize:function(a,c){cc.LayerColor.prototype.setContentSize.call(this,a,c);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setWidth:function(a){cc.LayerColor.prototype._setWidth.call(this,a);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setHeight:function(a){cc.LayerColor.prototype._setHeight.call(this,a);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getStartColor:function(){return cc.color(this._realColor)},setStartColor:function(a){this.color=
a;var c=this._colorStops;c&&0<c.length&&(c=c[0].color,c.r=a.r,c.g=a.g,c.b=a.b)},setEndColor:function(a){var c=this._endColor;c.r=a.r;c.g=a.g;c.b=a.b;if((c=this._colorStops)&&0<c.length)c=c[c.length-1].color,c.r=a.r,c.g=a.g,c.b=a.b;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},getEndColor:function(){return cc.color(this._endColor)},setStartOpacity:function(a){this._startOpacity=a;var c=this._colorStops;c&&0<c.length&&(c[0].color.a=a);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},
getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(a){this._endOpacity=a;var c=this._colorStops;c&&0<c.length&&(c[c.length-1].color.a=a);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getEndOpacity:function(){return this._endOpacity},setVector:function(a){this._alongVector.x=a.x;this._alongVector.y=a.y;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getVector:function(){return cc.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},
setCompressedInterpolation:function(a){this._compressedInterpolation=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getColorStops:function(){return this._colorStops},setColorStops:function(a){this._colorStops=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty)},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.LayerGradient.CanvasRenderCmd(this):new cc.LayerGradient.WebGLRenderCmd(this)}});
cc.LayerGradient.create=function(a,c,b,d){return new cc.LayerGradient(a,c,b,d)};
(function(){var a=cc.LayerGradient.prototype;cc.defineGetterSetter(a,"startColor",a.getStartColor,a.setStartColor);cc.defineGetterSetter(a,"endColor",a.getEndColor,a.setEndColor);cc.defineGetterSetter(a,"startOpacity",a.getStartOpacity,a.setStartOpacity);cc.defineGetterSetter(a,"endOpacity",a.getEndOpacity,a.setEndOpacity);cc.defineGetterSetter(a,"vector",a.getVector,a.setVector);cc.defineGetterSetter(a,"colorStops",a.getColorStops,a.setColorStops)})();
cc.LayerMultiplex=cc.Layer.extend({_enabledLayer:0,_layers:null,_className:"LayerMultiplex",ctor:function(a){cc.Layer.prototype.ctor.call(this);a instanceof Array?cc.LayerMultiplex.prototype.initWithLayers.call(this,a):cc.LayerMultiplex.prototype.initWithLayers.call(this,Array.prototype.slice.call(arguments))},initWithLayers:function(a){0<a.length&&null==a[a.length-1]&&cc.log(cc._LogInfos.LayerMultiplex_initWithLayers);this._layers=a;this._enabledLayer=0;this.addChild(this._layers[this._enabledLayer]);
return!0},switchTo:function(a){a>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchTo):(this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=a,this.addChild(this._layers[a]))},switchToAndReleaseMe:function(a){a>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchToAndReleaseMe):(this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=a,this.addChild(this._layers[a]))},addLayer:function(a){a?this._layers.push(a):
cc.log(cc._LogInfos.LayerMultiplex_addLayer)}});cc.LayerMultiplex.create=function(){return new cc.LayerMultiplex(Array.prototype.slice.call(arguments))};(function(){cc.Layer.CanvasRenderCmd=function(a){cc.Node.CanvasRenderCmd.call(this,a);this._isBaked=!1;this._bakeSprite=null};var a=cc.Layer.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);a.constructor=cc.Layer.CanvasRenderCmd;a.bake=function(){if(!this._isBaked){this._needDraw=!0;this._isBaked=this._cacheDirty=cc.renderer.childrenOrderDirty=!0;for(var a=this._node._children,b=0,d=a.length;b<d;b++)a[b]._renderCmd._setCachedParent(this);this._bakeSprite||(this._bakeSprite=
new cc.BakeSprite,this._bakeSprite.setAnchorPoint(0,0))}};a.unbake=function(){if(this._isBaked){cc.renderer.childrenOrderDirty=!0;this._isBaked=this._needDraw=!1;this._cacheDirty=!0;for(var a=this._node._children,b=0,d=a.length;b<d;b++)a[b]._renderCmd._setCachedParent(null)}};a.isBaked=function(){return this._isBaked};a.rendering=function(){if(this._cacheDirty){var a=this._node,b=a._children,d=this._bakeSprite;this.transform(this.getParentRenderCmd(),!0);var e=this._getBoundingBoxForBake();e.width=
0|e.width+0.5;e.height=0|e.height+0.5;var f=d.getCacheContext(),g=f.getContext();d.resetCanvasSize(e.width,e.height);f.setOffset(0-e.x,g.canvas.height-e.height+e.y);d.setPosition(e.x,e.y);a.sortAllChildren();cc.renderer._turnToCacheMode(this.__instanceId);a=0;for(e=b.length;a<e;a++)b[a].visit(this);cc.renderer._renderingToCacheCanvas(f,this.__instanceId);d.transform();this._cacheDirty=!1}};a.visit=function(a){if(this._isBaked){var b=this._node,d=b._children.length;b._visible&&0!==d&&(this._syncStatus(a),
cc.renderer.pushRenderCommand(this),this._bakeSprite.visit(this),this._dirtyFlag=0)}else cc.Node.CanvasRenderCmd.prototype.visit.call(this,a)};a._bakeForAddChild=function(a){a._parent===this._node&&this._isBaked&&a._renderCmd._setCachedParent(this)};a._getBoundingBoxForBake=function(){var a=null,b=this._node;if(!b._children||0===b._children.length)return cc.rect(0,0,10,10);for(var d=b.getNodeToWorldTransform(),b=b._children,e=0,f=b.length;e<f;e++){var g=b[e];g&&g._visible&&(a?(g=g._getBoundingBoxToCurrentNode(d))&&
(a=cc.rectUnion(a,g)):a=g._getBoundingBoxToCurrentNode(d))}return a}})();
(function(){cc.LayerColor.CanvasRenderCmd=function(a){cc.Layer.CanvasRenderCmd.call(this,a);this._needDraw=!0;this._blendFuncStr="source-over";this._bakeRenderCmd=new cc.CustomRenderCmd(this,this._bakeRendering)};var a=cc.LayerColor.CanvasRenderCmd.prototype=Object.create(cc.Layer.CanvasRenderCmd.prototype);a.constructor=cc.LayerColor.CanvasRenderCmd;a.unbake=function(){cc.Layer.CanvasRenderCmd.prototype.unbake.call(this);this._needDraw=!0};a.rendering=function(a,b,d){a=a||cc._renderContext;var e=
a.getContext(),f=this._node,g=this._displayedColor,h=this._displayedOpacity/255,k=f._contentSize.width,f=f._contentSize.height;0!==h&&(a.setCompositeOperation(this._blendFuncStr),a.setGlobalAlpha(h),a.setFillStyle("rgba("+(0|g.r)+","+(0|g.g)+","+(0|g.b)+", 1)"),a.setTransform(this._worldTransform,b,d),e.fillRect(0,0,k*b,-f*d),cc.g_NumberOfDraws++)};a.updateBlendFunc=function(a){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(a)};a._updateSquareVertices=a._updateSquareVerticesWidth=
a._updateSquareVerticesHeight=function(){};a._bakeRendering=function(){if(this._cacheDirty){var a=this._node,b=this._bakeSprite,d=a._children,e=d.length;this.transform(this.getParentRenderCmd(),!0);var f=this._getBoundingBoxForBake();f.width=0|f.width+0.5;f.height=0|f.height+0.5;var g=b.getCacheContext(),h=g.getContext();b.resetCanvasSize(f.width,f.height);g.setOffset(0-f.x,h.canvas.height-f.height+f.y);b.setPosition(f.x,f.y);cc.renderer._turnToCacheMode(this.__instanceId);if(0<e){a.sortAllChildren();
for(a=0;a<e;a++)if(f=d[a],0>f._localZOrder)f._renderCmd.visit(this);else break;for(cc.renderer.pushRenderCommand(this);a<e;a++)d[a]._renderCmd.visit(this)}else cc.renderer.pushRenderCommand(this);cc.renderer._renderingToCacheCanvas(g,this.__instanceId);b.transform();this._cacheDirty=!1}};a.visit=function(a){this._isBaked?this._node._visible&&(this._syncStatus(a),cc.renderer.pushRenderCommand(this._bakeRenderCmd),this._bakeSprite._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._bakeSprite.visit(this),
this._dirtyFlag=0):cc.Node.CanvasRenderCmd.prototype.visit.call(this)};a._getBoundingBoxForBake=function(){var a=this._node,b=cc.rect(0,0,a._contentSize.width,a._contentSize.height),d=a.getNodeToWorldTransform(),b=cc.rectApplyAffineTransform(b,a.getNodeToWorldTransform());if(!a._children||0===a._children.length)return b;for(var a=a._children,e=0;e<a.length;e++){var f=a[e];f&&f._visible&&(f=f._getBoundingBoxToCurrentNode(d),b=cc.rectUnion(b,f))}return b}})();
(function(){cc.LayerGradient.RenderCmd={updateStatus:function(){var a=cc.Node._dirtyFlags,c=this._dirtyFlag,b=c&a.colorDirty,d=c&a.opacityDirty;b&&this._updateDisplayColor();d&&this._updateDisplayOpacity();c&a.transformDirty&&this.transform(null,!0);(b||d||c&a.gradientDirty)&&this._updateColor();this._dirtyFlag=0}}})();
(function(){cc.LayerGradient.CanvasRenderCmd=function(a){cc.LayerColor.CanvasRenderCmd.call(this,a);this._needDraw=!0;this._startPoint=cc.p(0,0);this._endPoint=cc.p(0,0);this._endStopStr=this._startStopStr=null};var a=cc.LayerGradient.CanvasRenderCmd.prototype=Object.create(cc.LayerColor.CanvasRenderCmd.prototype);cc.inject(cc.LayerGradient.RenderCmd,a);a.constructor=cc.LayerGradient.CanvasRenderCmd;a.rendering=function(a,b,d){a=a||cc._renderContext;var e=a.getContext(),f=this._node,g=this._displayedOpacity/
255;if(0!==g){var h=f._contentSize.width,k=f._contentSize.height;a.setCompositeOperation(this._blendFuncStr);a.setGlobalAlpha(g);g=e.createLinearGradient(this._startPoint.x*b,this._startPoint.y*d,this._endPoint.x*b,this._endPoint.y*d);if(f._colorStops)for(var l=0;l<f._colorStops.length;l++)g.addColorStop(f._colorStops[l].p,this._colorStopsStr[l]);else g.addColorStop(0,this._startStopStr),g.addColorStop(1,this._endStopStr);a.setFillStyle(g);a.setTransform(this._worldTransform,b,d);e.fillRect(0,0,h*
b,-k*d);cc.g_NumberOfDraws++}};a._syncStatus=function(a){var b=cc.Node._dirtyFlags,d=this._dirtyFlag,e=a?a._node:null;e&&(e._cascadeColorEnabled&&a._dirtyFlag&b.colorDirty)&&(d|=b.colorDirty);e&&(e._cascadeOpacityEnabled&&a._dirtyFlag&b.opacityDirty)&&(d|=b.opacityDirty);a&&a._dirtyFlag&b.transformDirty&&(d|=b.transformDirty);var e=d&b.colorDirty,f=d&b.opacityDirty;this._dirtyFlag=d;e&&this._syncDisplayColor();f&&this._syncDisplayOpacity();d&b.transformDirty&&this.transform(a);(e||f||d&b.gradientDirty)&&
this._updateColor()};a._updateColor=function(){var a=this._node,b=a._contentSize,d=0.5*b.width,b=0.5*b.height;this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.gradientDirty;var e=cc.pAngleSigned(cc.p(0,-1),a._alongVector),e=cc.pRotateByAngle(cc.p(0,-1),cc.p(0,0),e),f=Math.min(Math.abs(1/e.x),Math.abs(1/e.y));this._startPoint.x=d*-e.x*f+d;this._startPoint.y=b*e.y*f-b;this._endPoint.x=d*e.x*f+d;this._endPoint.y=b*-e.y*f-b;d=this._displayedColor;b=a._endColor;e=a._startOpacity/255;f=a._endOpacity/
255;this._startStopStr="rgba("+Math.round(d.r)+","+Math.round(d.g)+","+Math.round(d.b)+","+e.toFixed(4)+")";this._endStopStr="rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+f.toFixed(4)+")";if(a._colorStops){this._endOpacity=this._startOpacity=0;this._colorStopsStr=[];for(d=0;d<a._colorStops.length;d++)b=a._colorStops[d].color,e=null==b.a?1:b.a/255,this._colorStopsStr.push("rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+e.toFixed(4)+")")}}})();cc._tmp.PrototypeSprite=function(){var a=cc.Sprite.prototype;cc.defineGetterSetter(a,"opacityModifyRGB",a.isOpacityModifyRGB,a.setOpacityModifyRGB);cc.defineGetterSetter(a,"opacity",a.getOpacity,a.setOpacity);cc.defineGetterSetter(a,"color",a.getColor,a.setColor);cc.defineGetterSetter(a,"flippedX",a.isFlippedX,a.setFlippedX);cc.defineGetterSetter(a,"flippedY",a.isFlippedY,a.setFlippedY);cc.defineGetterSetter(a,"offsetX",a._getOffsetX);cc.defineGetterSetter(a,"offsetY",a._getOffsetY);cc.defineGetterSetter(a,
"texture",a.getTexture,a.setTexture);cc.defineGetterSetter(a,"textureRectRotated",a.isTextureRectRotated);cc.defineGetterSetter(a,"batchNode",a.getBatchNode,a.setBatchNode);cc.defineGetterSetter(a,"quad",a.getQuad)};cc.Sprite=cc.Node.extend({dirty:!1,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(a,c,b){cc.Node.prototype.ctor.call(this);this._shouldBeHidden=!1;this._offsetPosition=cc.p(0,0);this._unflippedOffsetPositionFromCenter=
cc.p(0,0);this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};this._rect=cc.rect(0,0,0,0);this._softInit(a,c,b)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(a,c){this.addEventListener("load",a,c)},isDirty:function(){return this.dirty},setDirty:function(a){this.dirty=a},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(a){this.atlasIndex=a},getTextureRect:function(){return cc.rect(this._rect)},
getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(a){this.textureAtlas=a},getOffsetPosition:function(){return cc.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(a){cc.assert(a,cc._LogInfos.Sprite_initWithSpriteFrame);a.textureLoaded()||(this._textureLoaded=!1,a.addEventListener("load",this._renderCmd._spriteFrameLoadedCallback,
this));var c=cc._renderType===cc._RENDER_TYPE_CANVAS?!1:a._rotated,c=this.initWithTexture(a.getTexture(),a.getRect(),c);this.setSpriteFrame(a);return c},initWithSpriteFrameName:function(a){cc.assert(a,cc._LogInfos.Sprite_initWithSpriteFrameName);var c=cc.spriteFrameCache.getSpriteFrame(a);cc.assert(c,a+cc._LogInfos.Sprite_initWithSpriteFrameName1);return this.initWithSpriteFrame(c)},useBatchNode:function(a){this.textureAtlas=a.getTextureAtlas();this._batchNode=a},setVertexRect:function(a){var c=this._rect;
c.x=a.x;c.y=a.y;c.width=a.width;c.height=a.height},sortAllChildren:function(){if(this._reorderChildDirty){var a=this._children,c=a.length,b,d,e;for(b=1;b<c;b++){e=a[b];for(d=b-1;0<=d;){if(e._localZOrder<a[d]._localZOrder)a[d+1]=a[d];else if(e._localZOrder===a[d]._localZOrder&&e.arrivalOrder<a[d].arrivalOrder)a[d+1]=a[d];else break;d--}a[d+1]=e}this._batchNode&&this._arrayMakeObjectsPerformSelector(a,cc.Node._stateCallbackType.sortAllChildren);this._reorderChildDirty=!1}},reorderChild:function(a,c){cc.assert(a,
cc._LogInfos.Sprite_reorderChild_2);-1===this._children.indexOf(a)?cc.log(cc._LogInfos.Sprite_reorderChild):c!==a.zIndex&&(this._batchNode&&!this._reorderChildDirty&&(this._setReorderChildDirtyRecursively(),this._batchNode.reorderBatch(!0)),cc.Node.prototype.reorderChild.call(this,a,c))},removeChild:function(a,c){this._batchNode&&this._batchNode.removeSpriteFromAtlas(a);cc.Node.prototype.removeChild.call(this,a,c)},setVisible:function(a){cc.Node.prototype.setVisible.call(this,a);this._renderCmd.setDirtyRecursively(!0)},
removeAllChildren:function(a){var c=this._children,b=this._batchNode;if(b&&null!=c)for(var d=0,e=c.length;d<e;d++)b.removeSpriteFromAtlas(c[d]);cc.Node.prototype.removeAllChildren.call(this,a);this._hasChildren=!1},ignoreAnchorPointForPosition:function(a){this._batchNode?cc.log(cc._LogInfos.Sprite_ignoreAnchorPointForPosition):cc.Node.prototype.ignoreAnchorPointForPosition.call(this,a)},setFlippedX:function(a){this._flippedX!==a&&(this._flippedX=a,this.setTextureRect(this._rect,this._rectRotated,
this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(a){this._flippedY!==a&&(this._flippedY=a,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(a){this._opacityModifyRGB!==a&&(this._opacityModifyRGB=a,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(a,
c){cc.assert(a,cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_3);var b=cc.animationCache.getAnimation(a);b?(b=b.getFrames()[c])?this.setSpriteFrame(b.getSpriteFrame()):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_2):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName)},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=!0;for(var a=this._parent;a&&a!==this._batchNode;)a._setReorderChildDirtyRecursively(),
a=a.parent}},getTexture:function(){return this._texture},_softInit:function(a,c,b){if(void 0===a)cc.Sprite.prototype.init.call(this);else if(cc.isString(a))"#"===a[0]?(c=a.substr(1,a.length-1),(c=cc.spriteFrameCache.getSpriteFrame(c))?this.initWithSpriteFrame(c):cc.log("%s does not exist",a)):cc.Sprite.prototype.init.call(this,a,c);else if("object"===typeof a)if(a instanceof cc.Texture2D)this.initWithTexture(a,c,b);else if(a instanceof cc.SpriteFrame)this.initWithSpriteFrame(a);else if(a instanceof
HTMLImageElement||a instanceof HTMLCanvasElement)c=new cc.Texture2D,c.initWithElement(a),c.handleLoadedTexture(),this.initWithTexture(c)},getQuad:function(){return this._renderCmd.getQuad()},setBlendFunc:function(a,c){var b=this._blendFunc;void 0===c?(b.src=a.src,b.dst=a.dst):(b.src=a,b.dst=c);this._renderCmd.updateBlendFunc(b)},init:function(){if(0<arguments.length)return this.initWithFile(arguments[0],arguments[1]);cc.Node.prototype.init.call(this);this.dirty=this._recursiveDirty=!1;this._blendFunc.src=
cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;this.texture=null;this._flippedX=this._flippedY=!1;this.anchorY=this.anchorX=0.5;this._offsetPosition.x=0;this._offsetPosition.y=0;this._hasChildren=!1;this._renderCmd._init();this.setTextureRect(cc.rect(0,0,0,0),!1,cc.size(0,0));return!0},initWithFile:function(a,c){cc.assert(a,cc._LogInfos.Sprite_initWithFile);var b=cc.textureCache.getTextureForKey(a);if(b){if(!c){var d=b.getContentSize();c=cc.rect(0,0,d.width,d.height)}return this.initWithTexture(b,
c)}b=cc.textureCache.addImage(a);return this.initWithTexture(b,c||cc.rect(0,0,b._contentSize.width,b._contentSize.height))},initWithTexture:function(a,c,b,d){cc.assert(0!==arguments.length,cc._LogInfos.CCSpriteBatchNode_initWithTexture);b=b||!1;a=this._renderCmd._handleTextureForRotatedTexture(a,c,b,d);if(!cc.Node.prototype.init.call(this))return!1;this._batchNode=null;this.dirty=this._recursiveDirty=!1;this._opacityModifyRGB=!0;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;this._flippedX=
this._flippedY=!1;this.setAnchorPoint(0.5,0.5);this._offsetPosition.x=0;this._offsetPosition.y=0;this._hasChildren=!1;this._renderCmd._init();var e=a.isLoaded();this._textureLoaded=e;if(!e)return this._rectRotated=b,c&&(this._rect.x=c.x,this._rect.y=c.y,this._rect.width=c.width,this._rect.height=c.height),this.texture&&this.texture.removeEventListener("load",this),a.addEventListener("load",this._renderCmd._textureLoadedCallback,this),this.texture=a,!0;c||(c=cc.rect(0,0,a.width,a.height));this._renderCmd._checkTextureBoundary(a,
c,b);this.texture=a;this.setTextureRect(c,b);this.setBatchNode(null);return!0},setTextureRect:function(a,c,b,d){this._rectRotated=c||!1;this.setContentSize(b||a);this.setVertexRect(a);this._renderCmd._setTextureCoords(a,d);a=this._unflippedOffsetPositionFromCenter.x;c=this._unflippedOffsetPositionFromCenter.y;this._flippedX&&(a=-a);this._flippedY&&(c=-c);b=this._rect;this._offsetPosition.x=a+(this._contentSize.width-b.width)/2;this._offsetPosition.y=c+(this._contentSize.height-b.height)/2;this._batchNode?
this.dirty=!0:this._renderCmd._resetForBatchNode()},updateTransform:function(){this._renderCmd.updateTransform()},addChild:function(a,c,b){cc.assert(a,cc._LogInfos.CCSpriteBatchNode_addChild_2);null==c&&(c=a._localZOrder);null==b&&(b=a.tag);this._renderCmd._setBatchNodeForAddChild(a)&&(cc.Node.prototype.addChild.call(this,a,c,b),this._hasChildren=!0)},setSpriteFrame:function(a){var c=this;cc.isString(a)&&(a=cc.spriteFrameCache.getSpriteFrame(a),cc.assert(a,cc._LogInfos.Sprite_setSpriteFrame));this.setNodeDirty(!0);
var b=a.getOffset();c._unflippedOffsetPositionFromCenter.x=b.x;c._unflippedOffsetPositionFromCenter.y=b.y;b=a.getTexture();a.textureLoaded()?(b!==c._texture&&(c.texture=b),c.setTextureRect(a.getRect(),a.isRotated(),a.getOriginalSize())):(c._textureLoaded=!1,a.addEventListener("load",function(a){c._textureLoaded=!0;var b=a.getTexture();b!==c._texture&&(c.texture=b);c.setTextureRect(a.getRect(),a.isRotated(),a.getOriginalSize());c.dispatchEvent("load");c.setColor(c.color)},c));this._renderCmd._updateForSetSpriteFrame(b)},
setDisplayFrame:function(a){cc.log(cc._LogInfos.Sprite_setDisplayFrame);this.setSpriteFrame(a)},isFrameDisplayed:function(a){return this._renderCmd.isFrameDisplayed(a)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new cc.SpriteFrame(this._texture,cc.rectPointsToPixels(this._rect),this._rectRotated,cc.pointPointsToPixels(this._unflippedOffsetPositionFromCenter),cc.sizePointsToPixels(this._contentSize))},setBatchNode:function(a){(this._batchNode=a)?(this._transformToBatch=
cc.affineTransformIdentity(),this.textureAtlas=this._batchNode.getTextureAtlas()):(this.atlasIndex=cc.Sprite.INDEX_NOT_INITIALIZED,this.textureAtlas=null,this.dirty=this._recursiveDirty=!1,this._renderCmd._resetForBatchNode())},setTexture:function(a){if(!a)return this._renderCmd._setTexture(null);cc.isString(a)?(a=cc.textureCache.addImage(a),a._textureLoaded?(this._clearRect(),this._renderCmd._setTexture(a),this._changeRectWithTexture(a.getContentSize()),this.setColor(this._realColor),this._textureLoaded=
!0):a.addEventListener("load",function(){this._clearRect();this._renderCmd._setTexture(a);this._changeRectWithTexture(a.getContentSize());this.setColor(this._realColor);this._textureLoaded=!0},this)):(cc.assert(a instanceof cc.Texture2D,cc._LogInfos.Sprite_setTexture_2),this._clearRect(),this._changeRectWithTexture(a.getContentSize()),this._renderCmd._setTexture(a))},_clearRect:function(){var a=this._texture;if(a){var a=a._contentSize,c=this._rect;a.width===c.width&&a.height===c.height&&(c.width=
c.height=0)}},_changeRectWithTexture:function(a){if(a&&(a.width||a.height)){var c=this.getTextureRect();!c.height&&!c.width&&(a.x=a.x||0,a.y=a.y||0,a.width=a.width||0,a.height=a.height||0,this.setTextureRect(a))}},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.Sprite.CanvasRenderCmd(this):new cc.Sprite.WebGLRenderCmd(this)}});cc.Sprite.create=function(a,c,b){return new cc.Sprite(a,c,b)};cc.Sprite.createWithTexture=cc.Sprite.create;
cc.Sprite.createWithSpriteFrameName=cc.Sprite.create;cc.Sprite.createWithSpriteFrame=cc.Sprite.create;cc.Sprite.INDEX_NOT_INITIALIZED=-1;cc.EventHelper.prototype.apply(cc.Sprite.prototype);cc.assert(cc.isFunction(cc._tmp.PrototypeSprite),cc._LogInfos.MissingFile,"SpritesPropertyDefine.js");cc._tmp.PrototypeSprite();delete cc._tmp.PrototypeSprite;(function(){cc.Sprite.CanvasRenderCmd=function(a){cc.Node.CanvasRenderCmd.call(this,a);this._needDraw=!0;this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1};this._blendFuncStr="source-over";this._colorized=!1;this._originalTexture=null};var a=cc.Sprite.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);a.constructor=cc.Sprite.CanvasRenderCmd;a._init=function(){};a.setDirtyRecursively=function(a){};a._resetForBatchNode=function(){};a._setTexture=function(a){var b=
this._node;b._texture!==a&&(a?(a.getHtmlElementObj()instanceof HTMLImageElement&&(this._originalTexture=a),b._textureLoaded=a._textureLoaded):b._textureLoaded=!1,b._texture=a)};a._setColorDirty=function(){this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty)};a.isFrameDisplayed=function(a){var b=this._node;return a.getTexture()!==b._texture?!1:cc.rectEqualToRect(a.getRect(),b._rect)};a.updateBlendFunc=function(a){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(a)};
a._setBatchNodeForAddChild=function(a){return!0};a._handleTextureForRotatedTexture=function(a,b,d,e){d&&a.isLoaded()&&(a=a.getHtmlElementObj(),a=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(a,b,e),e=new cc.Texture2D,e.initWithElement(a),e.handleLoadedTexture(),a=e,b.x=b.y=0,this._node._rect=cc.rect(0,0,b.width,b.height));return a};a._checkTextureBoundary=function(a,b,d){a&&a.url&&(d=b.y+b.height,b.x+b.width>a.width&&cc.error(cc._LogInfos.RectWidth,a.url),d>a.height&&cc.error(cc._LogInfos.RectHeight,
a.url));this._node._originalTexture=a};a.rendering=function(a,b,d){var e=this._node,f=this._textureCoord,g=this._displayedOpacity/255;if(!(e._texture&&(0===f.width||0===f.height||!e._texture._textureLoaded)||0===g)){a=a||cc._renderContext;var h=a.getContext(),k=e._offsetPosition.x,l=e._rect.height,n=e._rect.width,m=-e._offsetPosition.y-l;a.setTransform(this._worldTransform,b,d);a.setCompositeOperation(this._blendFuncStr);a.setGlobalAlpha(g);(e._flippedX||e._flippedY)&&a.save();e._flippedX&&(k=-k-
n,h.scale(-1,1));e._flippedY&&(m=e._offsetPosition.y,h.scale(1,-1));e._texture?(g=e._texture._htmlElementObj,""!==e._texture._pattern?(a.setFillStyle(h.createPattern(g,e._texture._pattern)),h.fillRect(k*b,m*d,n*b,l*d)):this._colorized?h.drawImage(g,0,0,f.width,f.height,k*b,m*d,n*b,l*d):h.drawImage(g,f.renderX,f.renderY,f.width,f.height,k*b,m*d,n*b,l*d)):(g=e._contentSize,f.validRect&&(f=this._displayedColor,a.setFillStyle("rgba("+f.r+","+f.g+","+f.b+",1)"),h.fillRect(k*b,m*d,g.width*b,g.height*d)));
(e._flippedX||e._flippedY)&&a.restore();cc.g_NumberOfDraws++}};a._updateColor=cc.sys._supportCanvasNewBlendModes?function(){var a=this._node,b=this._displayedColor;if(255===b.r&&255===b.g&&255===b.b)this._colorized&&(this._colorized=!1,a.texture=this._originalTexture);else{var d,e=a._texture,f=this._textureCoord;if(e&&(f.validRect&&this._originalTexture)&&(d=e.getHtmlElementObj()))this._colorized=!0,d instanceof HTMLCanvasElement&&!this._rectRotated&&!this._newTextureWhenChangeColor&&this._originalTexture._htmlElementObj!==
d?cc.Sprite.CanvasRenderCmd._generateTintImageWithMultiply(this._originalTexture._htmlElementObj,b,f,d):(d=cc.Sprite.CanvasRenderCmd._generateTintImageWithMultiply(this._originalTexture._htmlElementObj,b,f),e=new cc.Texture2D,e.initWithElement(d),e.handleLoadedTexture(),a.texture=e)}}:function(){var a=this._node,b=this._displayedColor;if(255===b.r&&255===b.g&&255===b.b)this._colorized&&(this._colorized=!1,a.texture=this._originalTexture);else{var d,e=a._texture,f=this._textureCoord;if(e&&(f.validRect&&
this._originalTexture)&&(d=e.getHtmlElementObj()))if(e=cc.textureCache.getTextureColors(this._originalTexture.getHtmlElementObj()))this._colorized=!0,d instanceof HTMLCanvasElement&&!this._rectRotated&&!this._newTextureWhenChangeColor?cc.Sprite.CanvasRenderCmd._generateTintImage(d,e,b,f,d):(d=cc.Sprite.CanvasRenderCmd._generateTintImage(d,e,b,f),e=new cc.Texture2D,e.initWithElement(d),e.handleLoadedTexture(),a.texture=e)}};a.getQuad=function(){return null};a._updateForSetSpriteFrame=function(a,b){var d=
this._node;d._rectRotated&&(d._originalTexture=a);this._colorized=!1;this._textureCoord.renderX=this._textureCoord.x;this._textureCoord.renderY=this._textureCoord.y;b&&(d=d.getColor(),(255!==d.r||255!==d.g||255!==d.b)&&this._updateColor())};a.updateTransform=function(){var a=this._node;if(a.dirty){var b=a._parent;!a._visible||b&&b!==a._batchNode&&b._shouldBeHidden?a._shouldBeHidden=!0:(a._shouldBeHidden=!1,a._transformToBatch=!b||b===a._batchNode?this.getNodeToParentTransform():cc.affineTransformConcat(this.getNodeToParentTransform(),
b._transformToBatch));a._recursiveDirty=!1;a.dirty=!1}a._hasChildren&&a._arrayMakeObjectsPerformSelector(a._children,cc.Node._stateCallbackType.updateTransform)};a._updateDisplayColor=function(a){cc.Node.CanvasRenderCmd.prototype._updateDisplayColor.call(this,a)};a._spriteFrameLoadedCallback=function(a){this.setTextureRect(a.getRect(),a.isRotated(),a.getOriginalSize());this._renderCmd._updateColor();this.dispatchEvent("load")};a._textureLoadedCallback=function(a){if(!this._textureLoaded){this._textureLoaded=
!0;var b=this._rect,d=this._renderCmd;b?cc._rectEqualToZero(b)&&(b.width=a.width,b.height=a.height):b=cc.rect(0,0,a.width,a.height);this.texture=d._originalTexture=a;this.setTextureRect(b,this._rectRotated);a=d._displayedColor;(255!==a.r||255!==a.g||255!==a.b)&&d._updateColor();this.setBatchNode(this._batchNode);this.dispatchEvent("load")}};a._setTextureCoords=function(a,b){void 0===b&&(b=!0);var d=this._textureCoord,e=b?cc.contentScaleFactor():1;d.renderX=d.x=0|a.x*e;d.renderY=d.y=0|a.y*e;d.width=
0|a.width*e;d.height=0|a.height*e;d.validRect=!(0===d.width||0===d.height||0>d.x||0>d.y);this._colorized&&(this._node._texture=this._originalTexture,this._colorized=!1)};cc.Sprite.CanvasRenderCmd._generateTintImageWithMultiply=function(a,b,d,e){e=e||cc.newElement("canvas");d=d||cc.rect(0,0,a.width,a.height);var f=e.getContext("2d");e.width!==d.width||e.height!==d.height?(e.width=d.width,e.height=d.height):f.globalCompositeOperation="source-over";f.fillStyle="rgb("+(0|b.r)+","+(0|b.g)+","+(0|b.b)+
")";f.fillRect(0,0,d.width,d.height);f.globalCompositeOperation="multiply";f.drawImage(a,d.x,d.y,d.width,d.height,0,0,d.width,d.height);f.globalCompositeOperation="destination-atop";f.drawImage(a,d.x,d.y,d.width,d.height,0,0,d.width,d.height);return e};cc.Sprite.CanvasRenderCmd._generateTintImage=function(a,b,d,e,f){e||(e=cc.rect(0,0,a.width,a.height));a=d.r/255;var g=d.g/255;d=d.b/255;var h=Math.min(e.width,b[0].width),k=Math.min(e.height,b[0].height),l;f?(l=f.getContext("2d"),l.clearRect(0,0,h,
k)):(f=cc.newElement("canvas"),f.width=h,f.height=k,l=f.getContext("2d"));l.save();l.globalCompositeOperation="lighter";var n=l.globalAlpha;0<a&&(l.globalAlpha=a*n,l.drawImage(b[0],e.x,e.y,h,k,0,0,h,k));0<g&&(l.globalAlpha=g*n,l.drawImage(b[1],e.x,e.y,h,k,0,0,h,k));0<d&&(l.globalAlpha=d*n,l.drawImage(b[2],e.x,e.y,h,k,0,0,h,k));1>a+g+d&&(l.globalAlpha=n,l.drawImage(b[3],e.x,e.y,h,k,0,0,h,k));l.restore();return f};cc.Sprite.CanvasRenderCmd._generateTextureCacheForColor=function(a){function b(){var b=
cc.Sprite.CanvasRenderCmd._generateTextureCacheForColor,e=a.width,h=a.height;d[0].width=e;d[0].height=h;d[1].width=e;d[1].height=h;d[2].width=e;d[2].height=h;d[3].width=e;d[3].height=h;b.canvas.width=e;b.canvas.height=h;var k=b.canvas.getContext("2d");k.drawImage(a,0,0);b.tempCanvas.width=e;b.tempCanvas.height=h;for(var k=k.getImageData(0,0,e,h).data,l=0;4>l;l++){var n=d[l].getContext("2d");n.getImageData(0,0,e,h).data;b.tempCtx.drawImage(a,0,0);for(var m=b.tempCtx.getImageData(0,0,e,h),p=m.data,
q=0;q<k.length;q+=4)p[q]=0===l?k[q]:0,p[q+1]=1===l?k[q+1]:0,p[q+2]=2===l?k[q+2]:0,p[q+3]=k[q+3];n.putImageData(m,0,0)}a.onload=null}if(a.channelCache)return a.channelCache;var d=[cc.newElement("canvas"),cc.newElement("canvas"),cc.newElement("canvas"),cc.newElement("canvas")];try{b()}catch(e){a.onload=b}return a.channelCache=d};cc.Sprite.CanvasRenderCmd._generateTextureCacheForColor.canvas=cc.newElement("canvas");cc.Sprite.CanvasRenderCmd._generateTextureCacheForColor.tempCanvas=cc.newElement("canvas");
cc.Sprite.CanvasRenderCmd._generateTextureCacheForColor.tempCtx=cc.Sprite.CanvasRenderCmd._generateTextureCacheForColor.tempCanvas.getContext("2d");cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(a,b,d){if(!a)return null;if(!b)return a;d=null==d?!0:d;var e=cc.newElement("canvas");e.width=b.width;e.height=b.height;var f=e.getContext("2d");f.translate(e.width/2,e.height/2);d?f.rotate(-1.5707963267948966):f.rotate(1.5707963267948966);f.drawImage(a,b.x,b.y,b.height,b.width,-b.height/2,-b.width/
2,b.height,b.width);return e}})();cc.AnimationFrame=cc.Class.extend({_spriteFrame:null,_delayPerUnit:0,_userInfo:null,ctor:function(a,c,b){this._spriteFrame=a||null;this._delayPerUnit=c||0;this._userInfo=b||null},clone:function(){var a=new cc.AnimationFrame;a.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo);return a},copyWithZone:function(a){return cc.clone(this)},copy:function(a){a=new cc.AnimationFrame;a.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo);return a},initWithSpriteFrame:function(a,
c,b){this._spriteFrame=a;this._delayPerUnit=c;this._userInfo=b;return!0},getSpriteFrame:function(){return this._spriteFrame},setSpriteFrame:function(a){this._spriteFrame=a},getDelayUnits:function(){return this._delayPerUnit},setDelayUnits:function(a){this._delayPerUnit=a},getUserInfo:function(){return this._userInfo},setUserInfo:function(a){this._userInfo=a}});cc.AnimationFrame.create=function(a,c,b){return new cc.AnimationFrame(a,c,b)};
cc.Animation=cc.Class.extend({_frames:null,_loops:0,_restoreOriginalFrame:!1,_duration:0,_delayPerUnit:0,_totalDelayUnits:0,ctor:function(a,c,b){this._frames=[];if(void 0===a)this.initWithSpriteFrames(null,0);else{var d=a[0];d&&(d instanceof cc.SpriteFrame?this.initWithSpriteFrames(a,c,b):d instanceof cc.AnimationFrame&&this.initWithAnimationFrames(a,c,b))}},getFrames:function(){return this._frames},setFrames:function(a){this._frames=a},addSpriteFrame:function(a){var c=new cc.AnimationFrame;c.initWithSpriteFrame(a,
1,null);this._frames.push(c);this._totalDelayUnits++},addSpriteFrameWithFile:function(a){a=cc.textureCache.addImage(a);var c=cc.rect(0,0,0,0);c.width=a.width;c.height=a.height;a=new cc.SpriteFrame(a,c);this.addSpriteFrame(a)},addSpriteFrameWithTexture:function(a,c){var b=new cc.SpriteFrame(a,c);this.addSpriteFrame(b)},initWithAnimationFrames:function(a,c,b){cc.arrayVerifyType(a,cc.AnimationFrame);this._delayPerUnit=c;this._loops=void 0===b?1:b;this._totalDelayUnits=0;c=this._frames;for(b=c.length=
0;b<a.length;b++){var d=a[b];c.push(d);this._totalDelayUnits+=d.getDelayUnits()}return!0},clone:function(){var a=new cc.Animation;a.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops);a.setRestoreOriginalFrame(this._restoreOriginalFrame);return a},copyWithZone:function(a){a=new cc.Animation;a.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops);a.setRestoreOriginalFrame(this._restoreOriginalFrame);return a},_copyFrames:function(){for(var a=[],c=0;c<this._frames.length;c++)a.push(this._frames[c].clone());
return a},copy:function(a){return this.copyWithZone(null)},getLoops:function(){return this._loops},setLoops:function(a){this._loops=a},setRestoreOriginalFrame:function(a){this._restoreOriginalFrame=a},getRestoreOriginalFrame:function(){return this._restoreOriginalFrame},getDuration:function(){return this._totalDelayUnits*this._delayPerUnit},getDelayPerUnit:function(){return this._delayPerUnit},setDelayPerUnit:function(a){this._delayPerUnit=a},getTotalDelayUnits:function(){return this._totalDelayUnits},
initWithSpriteFrames:function(a,c,b){cc.arrayVerifyType(a,cc.SpriteFrame);this._loops=void 0===b?1:b;this._delayPerUnit=c||0;this._totalDelayUnits=0;c=this._frames;c.length=0;if(a){for(b=0;b<a.length;b++){var d=a[b],e=new cc.AnimationFrame;e.initWithSpriteFrame(d,1,null);c.push(e)}this._totalDelayUnits+=a.length}return!0},retain:function(){},release:function(){}});cc.Animation.create=function(a,c,b){return new cc.Animation(a,c,b)};cc.Animation.createWithAnimationFrames=cc.Animation.create;cc.animationCache={_animations:{},addAnimation:function(a,c){this._animations[c]=a},removeAnimation:function(a){a&&this._animations[a]&&delete this._animations[a]},getAnimation:function(a){return this._animations[a]?this._animations[a]:null},_addAnimationsWithDictionary:function(a,c){var b=a.animations;if(b){var d=1,e=a.properties;if(e)for(var d=null!=e.format?parseInt(e.format):d,e=e.spritesheets,f=cc.spriteFrameCache,g=cc.path,h=0;h<e.length;h++)f.addSpriteFrames(g.changeBasename(c,e[h]));switch(d){case 1:this._parseVersion1(b);
break;case 2:this._parseVersion2(b);break;default:cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary_2)}}else cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary)},addAnimations:function(a){cc.assert(a,cc._LogInfos.animationCache_addAnimations_2);var c=cc.loader.getRes(a);c?this._addAnimationsWithDictionary(c,a):cc.log(cc._LogInfos.animationCache_addAnimations)},_parseVersion1:function(a){var c=cc.spriteFrameCache,b;for(b in a){var d=a[b],e=d.frames,d=parseFloat(d.delay)||
0,f=null;if(e){for(var f=[],g=0;g<e.length;g++){var h=c.getSpriteFrame(e[g]);if(h){var k=new cc.AnimationFrame;k.initWithSpriteFrame(h,1,null);f.push(k)}else cc.log(cc._LogInfos.animationCache__parseVersion1_2,b,e[g])}0===f.length?cc.log(cc._LogInfos.animationCache__parseVersion1_3,b):(f.length!==e.length&&cc.log(cc._LogInfos.animationCache__parseVersion1_4,b),f=new cc.Animation(f,d,1),cc.animationCache.addAnimation(f,b))}else cc.log(cc._LogInfos.animationCache__parseVersion1,b)}},_parseVersion2:function(a){var c=
cc.spriteFrameCache,b;for(b in a){var d=a[b],e=d.loop,f=parseInt(d.loops),e=e?cc.REPEAT_FOREVER:isNaN(f)?1:f,f=d.restoreOriginalFrame&&!0==d.restoreOriginalFrame?!0:!1,g=d.frames;if(g){for(var h=[],k=0;k<g.length;k++){var l=g[k],n=l.spriteframe,m=c.getSpriteFrame(n);if(m){var n=parseFloat(l.delayUnits)||0,l=l.notification,p=new cc.AnimationFrame;p.initWithSpriteFrame(m,n,l);h.push(p)}else cc.log(cc._LogInfos.animationCache__parseVersion2_2,b,n)}d=parseFloat(d.delayPerUnit)||0;g=new cc.Animation;g.initWithAnimationFrames(h,
d,e);g.setRestoreOriginalFrame(f);cc.animationCache.addAnimation(g,b)}else cc.log(cc._LogInfos.animationCache__parseVersion2,b)}},_clear:function(){this._animations={}}};cc.SpriteFrame=cc.Class.extend({_offset:null,_originalSize:null,_rectInPixels:null,_rotated:!1,_rect:null,_offsetInPixels:null,_originalSizeInPixels:null,_texture:null,_textureFilename:"",_textureLoaded:!1,ctor:function(a,c,b,d,e){this._offset=cc.p(0,0);this._offsetInPixels=cc.p(0,0);this._originalSize=cc.size(0,0);this._rotated=!1;this._originalSizeInPixels=cc.size(0,0);this._textureFilename="";this._texture=null;this._textureLoaded=!1;void 0!==a&&void 0!==c&&(void 0===b||void 0===d||void 0===e?
this.initWithTexture(a,c):this.initWithTexture(a,c,b,d,e))},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(a,c){this.addEventListener("load",a,c)},getRectInPixels:function(){var a=this._rectInPixels;return cc.rect(a.x,a.y,a.width,a.height)},setRectInPixels:function(a){this._rectInPixels||(this._rectInPixels=cc.rect(0,0,0,0));this._rectInPixels.x=a.x;this._rectInPixels.y=a.y;this._rectInPixels.width=a.width;this._rectInPixels.height=a.height;this._rect=cc.rectPixelsToPoints(a)},
isRotated:function(){return this._rotated},setRotated:function(a){this._rotated=a},getRect:function(){var a=this._rect;return cc.rect(a.x,a.y,a.width,a.height)},setRect:function(a){this._rect||(this._rect=cc.rect(0,0,0,0));this._rect.x=a.x;this._rect.y=a.y;this._rect.width=a.width;this._rect.height=a.height;this._rectInPixels=cc.rectPointsToPixels(this._rect)},getOffsetInPixels:function(){return cc.p(this._offsetInPixels)},setOffsetInPixels:function(a){this._offsetInPixels.x=a.x;this._offsetInPixels.y=
a.y;cc._pointPixelsToPointsOut(this._offsetInPixels,this._offset)},getOriginalSizeInPixels:function(){return cc.size(this._originalSizeInPixels)},setOriginalSizeInPixels:function(a){this._originalSizeInPixels.width=a.width;this._originalSizeInPixels.height=a.height},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(a){this._originalSize.width=a.width;this._originalSize.height=a.height},getTexture:function(){if(this._texture)return this._texture;if(""!==this._textureFilename){var a=
cc.textureCache.addImage(this._textureFilename);a&&(this._textureLoaded=a.isLoaded());return a}return null},setTexture:function(a){if(this._texture!==a){var c=a.isLoaded();this._textureLoaded=c;this._texture=a;c||a.addEventListener("load",function(a){this._textureLoaded=!0;if(this._rotated&&cc._renderType===cc._RENDER_TYPE_CANVAS){var c=a.getHtmlElementObj(),c=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(c,this.getRect()),e=new cc.Texture2D;e.initWithElement(c);e.handleLoadedTexture();this.setTexture(e);
c=this.getRect();this.setRect(cc.rect(0,0,c.width,c.height))}c=this._rect;0===c.width&&0===c.height&&(c=a.width,a=a.height,this._rect.width=c,this._rect.height=a,this._rectInPixels=cc.rectPointsToPixels(this._rect),this._originalSizeInPixels.width=this._rectInPixels.width,this._originalSizeInPixels.height=this._rectInPixels.height,this._originalSize.width=c,this._originalSize.height=a);this.dispatchEvent("load")},this)}},getOffset:function(){return cc.p(this._offset)},setOffset:function(a){this._offset.x=
a.x;this._offset.y=a.y},clone:function(){var a=new cc.SpriteFrame;a.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels);a.setTexture(this._texture);return a},copyWithZone:function(){var a=new cc.SpriteFrame;a.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels);a.setTexture(this._texture);return a},copy:function(){return this.copyWithZone()},initWithTexture:function(a,
c,b,d,e){2===arguments.length&&(c=cc.rectPointsToPixels(c));d=d||cc.p(0,0);e=e||c;b=b||!1;cc.isString(a)?(this._texture=null,this._textureFilename=a):a instanceof cc.Texture2D&&this.setTexture(a);a=this.getTexture();this._rectInPixels=c;c=this._rect=cc.rectPixelsToPoints(c);if(a&&a.url&&a.isLoaded()){var f,g;b?(f=c.x+c.height,g=c.y+c.width):(f=c.x+c.width,g=c.y+c.height);f>a.getPixelsWide()&&cc.error(cc._LogInfos.RectWidth,a.url);g>a.getPixelsHigh()&&cc.error(cc._LogInfos.RectHeight,a.url)}this._offsetInPixels.x=
d.x;this._offsetInPixels.y=d.y;cc._pointPixelsToPointsOut(d,this._offset);this._originalSizeInPixels.width=e.width;this._originalSizeInPixels.height=e.height;cc._sizePixelsToPointsOut(e,this._originalSize);this._rotated=b;return!0}});cc.EventHelper.prototype.apply(cc.SpriteFrame.prototype);cc.SpriteFrame.create=function(a,c,b,d,e){return new cc.SpriteFrame(a,c,b,d,e)};cc.SpriteFrame.createWithTexture=cc.SpriteFrame.create;
cc.SpriteFrame._frameWithTextureForCanvas=function(a,c,b,d,e){var f=new cc.SpriteFrame;f._texture=a;f._rectInPixels=c;f._rect=cc.rectPixelsToPoints(c);f._offsetInPixels.x=d.x;f._offsetInPixels.y=d.y;cc._pointPixelsToPointsOut(f._offsetInPixels,f._offset);f._originalSizeInPixels.width=e.width;f._originalSizeInPixels.height=e.height;cc._sizePixelsToPointsOut(f._originalSizeInPixels,f._originalSize);f._rotated=b;return f};cc.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(a){a=this._CCNS_REG2.exec(a);return!a?cc.rect(0,0,0,0):cc.rect(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]),parseFloat(a[4]))},_pointFromString:function(a){a=this._CCNS_REG1.exec(a);
return!a?cc.p(0,0):cc.p(parseFloat(a[1]),parseFloat(a[2]))},_sizeFromString:function(a){a=this._CCNS_REG1.exec(a);return!a?cc.size(0,0):cc.size(parseFloat(a[1]),parseFloat(a[2]))},_getFrameConfig:function(a){var c=cc.loader.getRes(a);cc.assert(c,cc._LogInfos.spriteFrameCache__getFrameConfig_2,a);cc.loader.release(a);if(c._inited)return this._frameConfigCache[a]=c;this._frameConfigCache[a]=this._parseFrameConfig(c);return this._frameConfigCache[a]},_getFrameConfigByJsonObject:function(a,c){cc.assert(c,
cc._LogInfos.spriteFrameCache__getFrameConfig_2,a);this._frameConfigCache[a]=this._parseFrameConfig(c);return this._frameConfigCache[a]},_parseFrameConfig:function(a){var c=a.frames,b=a.metadata||a.meta;a={};var d={},e=0;b&&(e=b.format,e=1>=e.length?parseInt(e):e,d.image=b.textureFileName||b.textureFileName||b.image);for(var f in c){var g=c[f];if(g){b={};if(0==e){b.rect=cc.rect(g.x,g.y,g.width,g.height);b.rotated=!1;b.offset=cc.p(g.offsetX,g.offsetY);var h=g.originalWidth,g=g.originalHeight;(!h||
!g)&&cc.log(cc._LogInfos.spriteFrameCache__getFrameConfig);h=Math.abs(h);g=Math.abs(g);b.size=cc.size(h,g)}else if(1==e||2==e)b.rect=this._rectFromString(g.frame),b.rotated=g.rotated||!1,b.offset=this._pointFromString(g.offset),b.size=this._sizeFromString(g.sourceSize);else if(3==e){var h=this._sizeFromString(g.spriteSize),k=this._rectFromString(g.textureRect);h&&(k=cc.rect(k.x,k.y,h.width,h.height));b.rect=k;b.rotated=g.textureRotated||!1;b.offset=this._pointFromString(g.spriteOffset);b.size=this._sizeFromString(g.spriteSourceSize);
b.aliases=g.aliases}else h=g.frame,k=g.sourceSize,f=g.filename||f,b.rect=cc.rect(h.x,h.y,h.w,h.h),b.rotated=g.rotated||!1,b.offset=cc.p(0,0),b.size=cc.size(k.w,k.h);a[f]=b}}return{_inited:!0,frames:a,meta:d}},_addSpriteFramesByObject:function(a,c,b){cc.assert(a,cc._LogInfos.spriteFrameCache_addSpriteFrames_2);c&&c.frames&&(c=this._frameConfigCache[a]||this._getFrameConfigByJsonObject(a,c),this._createSpriteFrames(a,c,b))},_createSpriteFrames:function(a,c,b){var d=c.frames;c=c.meta;b?b instanceof cc.Texture2D||
(cc.isString(b)?b=cc.textureCache.addImage(b):cc.assert(0,cc._LogInfos.spriteFrameCache_addSpriteFrames_3)):(b=cc.path.changeBasename(a,c.image||".png"),b=cc.textureCache.addImage(b));a=this._spriteFramesAliases;c=this._spriteFrames;for(var e in d){var f=d[e],g=c[e];if(!g){g=new cc.SpriteFrame(b,f.rect,f.rotated,f.offset,f.size);if(f=f.aliases)for(var h=0,k=f.length;h<k;h++){var l=f[h];a[l]&&cc.log(cc._LogInfos.spriteFrameCache_addSpriteFrames,l);a[l]=e}cc._renderType===cc._RENDER_TYPE_CANVAS&&g.isRotated()&&
g.getTexture().isLoaded()&&(f=g.getTexture().getHtmlElementObj(),f=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(f,g.getRectInPixels()),h=new cc.Texture2D,h.initWithElement(f),h.handleLoadedTexture(),g.setTexture(h),f=g._rect,g.setRect(cc.rect(0,0,f.width,f.height)));c[e]=g}}},addSpriteFrames:function(a,c){cc.assert(a,cc._LogInfos.spriteFrameCache_addSpriteFrames_2);var b=this._frameConfigCache[a]||cc.loader.getRes(a);b&&b.frames&&(b=this._frameConfigCache[a]||this._getFrameConfig(a),this._createSpriteFrames(a,
b,c))},_checkConflict:function(a){a=a.frames;for(var c in a)this._spriteFrames[c]&&cc.log(cc._LogInfos.spriteFrameCache__checkConflict,c)},addSpriteFrame:function(a,c){this._spriteFrames[c]=a},removeSpriteFrames:function(){this._spriteFrames={};this._spriteFramesAliases={}},removeSpriteFrameByName:function(a){a&&(this._spriteFramesAliases[a]&&delete this._spriteFramesAliases[a],this._spriteFrames[a]&&delete this._spriteFrames[a])},removeSpriteFramesFromFile:function(a){var c=this._spriteFrames,b=
this._spriteFramesAliases;if(a=this._frameConfigCache[a]){a=a.frames;for(var d in a)if(c[d]){delete c[d];for(var e in b)b[e]===d&&delete b[e]}}},removeSpriteFramesFromTexture:function(a){var c=this._spriteFrames,b=this._spriteFramesAliases,d;for(d in c){var e=c[d];if(e&&e.getTexture()===a){delete c[d];for(var f in b)b[f]===d&&delete b[f]}}},getSpriteFrame:function(a){var c=this._spriteFrames[a];if(!c){var b=this._spriteFramesAliases[a];b&&((c=this._spriteFrames[b.toString()])||delete this._spriteFramesAliases[a])}return c},
_clear:function(){this._spriteFrames={};this._spriteFramesAliases={};this._frameConfigCache={}}};cc.g_NumberOfDraws=0;cc.GLToClipTransform=function(a){cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,a);var c=new cc.math.Matrix4;cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,c);a.multiply(c)};
cc.Director=cc.Class.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirectorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_accumDt:0,_contentScaleFactor:1,_displayStats:!1,_deltaTime:0,_frameRate:0,_FPSLabel:null,_SPFLabel:null,_drawsLabel:null,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_runningScene:null,_frames:0,_totalFrames:0,_secondsPerFrame:0,
_dirtyRegion:null,_scheduler:null,_actionManager:null,_eventProjectionChanged:null,_eventAfterDraw:null,_eventAfterVisit:null,_eventAfterUpdate:null,ctor:function(){var a=this;a._lastUpdate=Date.now();cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){a._lastUpdate=Date.now()})},init:function(){this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS;this._scenesStack=[];this._projection=cc.Director.PROJECTION_DEFAULT;this._projectionDelegate=null;this._frameRate=this._accumDt=
0;this._displayStats=!1;this._totalFrames=this._frames=0;this._lastUpdate=Date.now();this._purgeDirectorInNextLoop=this._paused=!1;this._winSizeInPoints=cc.size(0,0);this._openGLView=null;this._contentScaleFactor=1;this._scheduler=new cc.Scheduler;cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._actionManager=null;this._eventAfterDraw=new cc.EventCustom(cc.Director.EVENT_AFTER_DRAW);this._eventAfterDraw.setUserData(this);
this._eventAfterVisit=new cc.EventCustom(cc.Director.EVENT_AFTER_VISIT);this._eventAfterVisit.setUserData(this);this._eventAfterUpdate=new cc.EventCustom(cc.Director.EVENT_AFTER_UPDATE);this._eventAfterUpdate.setUserData(this);this._eventProjectionChanged=new cc.EventCustom(cc.Director.EVENT_PROJECTION_CHANGED);this._eventProjectionChanged.setUserData(this);return!0},calculateDeltaTime:function(){var a=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):this._deltaTime=
(a-this._lastUpdate)/1E3;0<cc.game.config[cc.game.CONFIG_KEY.debugMode]&&0.2<this._deltaTime&&(this._deltaTime=1/60);this._lastUpdate=a},convertToGL:null,convertToUI:null,drawScene:function(){var a=cc.renderer;this.calculateDeltaTime();this._paused||(this._scheduler.update(this._deltaTime),cc.eventManager.dispatchEvent(this._eventAfterUpdate));this._clear();this._nextScene&&this.setNextScene();this._beforeVisitScene&&this._beforeVisitScene();this._runningScene&&(!0===a.childrenOrderDirty?(cc.renderer.clearRenderCommands(),
this._runningScene._renderCmd._curLevel=0,this._runningScene.visit(),a.resetFlag()):!0===a.transformDirty()&&a.transform(),cc.eventManager.dispatchEvent(this._eventAfterVisit));this._notificationNode&&this._notificationNode.visit();this._displayStats&&this._showStats();this._afterVisitScene&&this._afterVisitScene();a.rendering(cc._renderContext);cc.eventManager.dispatchEvent(this._eventAfterDraw);this._totalFrames++;this._displayStats&&this._calculateMPF()},_beforeVisitScene:null,_afterVisitScene:null,
end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=
this._animationInterval,this.setAnimationInterval(0.25),this._paused=!0)},popScene:function(){cc.assert(this._runningScene,cc._LogInfos.Director_popScene);this._scenesStack.pop();var a=this._scenesStack.length;0===a?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[a-1])},purgeCachedData:function(){cc.animationCache._clear();cc.spriteFrameCache._clear();cc.textureCache._clear()},purgeDirector:function(){this.getScheduler().unscheduleAll();cc.eventManager&&cc.eventManager.setEnabled(!1);
this._runningScene&&(this._runningScene.onExitTransitionDidStart(),this._runningScene.onExit(),this._runningScene.cleanup());this._nextScene=this._runningScene=null;this._scenesStack.length=0;this.stopAnimation();this.purgeCachedData();cc.checkGLErrorDebug()},pushScene:function(a){cc.assert(a,cc._LogInfos.Director_pushScene);this._sendCleanupToScene=!1;this._scenesStack.push(a);this._nextScene=a},runScene:function(a){cc.assert(a,cc._LogInfos.Director_pushScene);if(this._runningScene){var c=this._scenesStack.length;
0===c?(this._sendCleanupToScene=!0,this._scenesStack[c]=a):(this._sendCleanupToScene=!0,this._scenesStack[c-1]=a);this._nextScene=a}else this.pushScene(a),this.startAnimation()},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),(this._lastUpdate=Date.now())||cc.log(cc._LogInfos.Director_resume),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(a){a!==this._contentScaleFactor&&(this._contentScaleFactor=a,this._createStatsLabel())},setDepthTest:null,
setDefaultValues:function(){},setNextDeltaTimeZero:function(a){this._nextDeltaTimeZero=a},setNextScene:function(){var a=!1,c=!1;cc.TransitionScene&&(a=this._runningScene?this._runningScene instanceof cc.TransitionScene:!1,c=this._nextScene?this._nextScene instanceof cc.TransitionScene:!1);if(!c){if(c=this._runningScene)c.onExitTransitionDidStart(),c.onExit();this._sendCleanupToScene&&c&&c.cleanup()}this._runningScene=this._nextScene;cc.renderer.childrenOrderDirty=!0;this._nextScene=null;!a&&null!==
this._runningScene&&(this._runningScene.onEnter(),this._runningScene.onEnterTransitionDidFinish())},setNotificationNode:function(a){this._notificationNode=a},getDelegate:function(){return this._projectionDelegate},setDelegate:function(a){this._projectionDelegate=a},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,_showStats:function(){this._frames++;this._accumDt+=this._deltaTime;this._FPSLabel&&this._SPFLabel&&this._drawsLabel?(this._accumDt>
cc.DIRECTOR_FPS_INTERVAL&&(this._SPFLabel.string=this._secondsPerFrame.toFixed(3),this._frameRate=this._frames/this._accumDt,this._accumDt=this._frames=0,this._FPSLabel.string=this._frameRate.toFixed(1),this._drawsLabel.string=(0|cc.g_NumberOfDraws).toString()),this._FPSLabel.visit(),this._SPFLabel.visit(),this._drawsLabel.visit()):this._createStatsLabel();cc.g_NumberOfDraws=0},isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getAnimationInterval:function(){return this._animationInterval},
isDisplayStats:function(){return this._displayStats},setDisplayStats:function(a){this._displayStats=a},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(a){cc.assert(this._runningScene,cc._LogInfos.Director_popToSceneStackLevel_2);var c=this._scenesStack,
b=c.length;if(0===b)this.end();else if(!(a>b)){for(;b>a;){var d=c.pop();d.running&&(d.onExitTransitionDidStart(),d.onExit());d.cleanup();b--}this._nextScene=c[c.length-1];this._sendCleanupToScene=!1}},getScheduler:function(){return this._scheduler},setScheduler:function(a){this._scheduler!==a&&(this._scheduler=a)},getActionManager:function(){return this._actionManager},setActionManager:function(a){this._actionManager!==a&&(this._actionManager=a)},getDeltaTime:function(){return this._deltaTime},_createStatsLabel:null,
_calculateMPF:function(){this._secondsPerFrame=(Date.now()-this._lastUpdate)/1E3}});cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed";cc.Director.EVENT_AFTER_DRAW="director_after_draw";cc.Director.EVENT_AFTER_VISIT="director_after_visit";cc.Director.EVENT_AFTER_UPDATE="director_after_update";
cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0;this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||this.drawScene()},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(a){this._animationInterval=a;this.invalid||(this.stopAnimation(),this.startAnimation())}});cc.Director.sharedDirector=null;cc.Director.firstUseDirector=!0;
cc.Director._getInstance=function(){cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init());return cc.Director.sharedDirector};cc.defaultFPS=60;cc.Director.PROJECTION_2D=0;cc.Director.PROJECTION_3D=1;cc.Director.PROJECTION_CUSTOM=3;cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_3D;
cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.Director.prototype,_p.setProjection=function(a){this._projection=a;cc.eventManager.dispatchEvent(this._eventProjectionChanged)},_p.setDepthTest=function(){},_p.setOpenGLView=function(a){this._winSizeInPoints.width=cc._canvas.width;this._winSizeInPoints.height=cc._canvas.height;this._openGLView=a||cc.view;cc.eventManager&&cc.eventManager.setEnabled(!0)},_p._clear=function(){var a=this._openGLView.getViewPortRect(),c=cc._renderContext.getContext();c.setTransform(1,
0,0,1,0,0);c.clearRect(-a.x,a.y,a.width,a.height)},_p._createStatsLabel=function(){var a=0,a=this._winSizeInPoints.width>this._winSizeInPoints.height?0|24*(this._winSizeInPoints.height/320):0|24*(this._winSizeInPoints.width/320);this._FPSLabel=new cc.LabelTTF("000.0","Arial",a);this._SPFLabel=new cc.LabelTTF("0.000","Arial",a);this._drawsLabel=new cc.LabelTTF("0000","Arial",a);a=cc.DIRECTOR_STATS_POSITION;this._drawsLabel.setPosition(this._drawsLabel.width/2+a.x,5*this._drawsLabel.height/2+a.y);this._SPFLabel.setPosition(this._SPFLabel.width/
2+a.x,3*this._SPFLabel.height/2+a.y);this._FPSLabel.setPosition(this._FPSLabel.width/2+a.x,this._FPSLabel.height/2+a.y)},_p.getVisibleSize=function(){return this.getWinSize()},_p.getVisibleOrigin=function(){return cc.p(0,0)}):(cc.Director._fpsImage=new Image,cc._addEventListener(cc.Director._fpsImage,"load",function(){cc.Director._fpsImageLoaded=!0}),cc._fpsImage&&(cc.Director._fpsImage.src=cc._fpsImage));cc.PRIORITY_NON_SYSTEM=cc.PRIORITY_SYSTEM+1;cc.ListEntry=function(a,c,b,d,e,f,g){this.prev=a;this.next=c;this.callback=b;this.target=d;this.priority=e;this.paused=f;this.markedForDeletion=g};cc.HashUpdateEntry=function(a,c,b,d,e){this.list=a;this.entry=c;this.target=b;this.callback=d;this.hh=e};cc.HashTimerEntry=cc.hashSelectorEntry=function(a,c,b,d,e,f,g){this.timers=a;this.target=c;this.timerIndex=b;this.currentTimer=d;this.currentTimerSalvaged=e;this.paused=f;this.hh=g};
cc.Timer=cc.Class.extend({_scheduler:null,_elapsed:0,_runForever:!1,_useDelay:!1,_timesExecuted:0,_repeat:0,_delay:0,_interval:0,getInterval:function(){return this._interval},setInterval:function(a){this._interval=a},setupTimerWithInterval:function(a,c,b){this._elapsed=-1;this._interval=a;this._delay=b;this._useDelay=0<this._delay;this._repeat=c;this._runForever=this._repeat===cc.REPEAT_FOREVER},trigger:function(){return 0},cancel:function(){return 0},ctor:function(){this._scheduler=null;this._elapsed=
-1;this._useDelay=this._runForever=!1;this._interval=this._delay=this._repeat=this._timesExecuted=0},update:function(a){-1===this._elapsed?this._timesExecuted=this._elapsed=0:(this._elapsed+=a,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=
1),!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))}});
cc.TimerTargetSelector=cc.Timer.extend({_target:null,_selector:null,ctor:function(){this._selector=this._target=null},initWithSelector:function(a,c,b,d,e,f){this._scheduler=a;this._target=b;this._selector=c;this.setupTimerWithInterval(d,e,f);return!0},getSelector:function(){return this._selector},trigger:function(){this._target&&this._selector&&this._target.call(this._selector,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._selector,this._target)}});
cc.TimerTargetCallback=cc.Timer.extend({_target:null,_callback:null,_key:null,ctor:function(){this._callback=this._target=null},initWithCallback:function(a,c,b,d,e,f,g){this._scheduler=a;this._target=b;this._callback=c;this._key=d;this.setupTimerWithInterval(e,f,g);return!0},getCallback:function(){return this._callback},getKey:function(){return this._key},trigger:function(){this._callback&&this._callback.call(this._target,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._callback,
this._target)}});
cc.Scheduler=cc.Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForTimers:null,_arrayForTimers:null,_hashForUpdates:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1;this._updatesNegList=[];this._updates0List=[];this._updatesPosList=[];this._hashForUpdates={};this._hashForTimers={};this._currentTarget=null;this._updateHashLocked=this._currentTargetSalvaged=!1;this._arrayForTimers=[]},_schedulePerFrame:function(a,
c,b,d){var e=this._hashForUpdates[c.__instanceId];if(e&&e.entry)if(e.entry.priority!==b){if(this._updateHashLocked){cc.log("warning: you CANNOT change update priority in scheduled function");e.entry.markedForDeletion=!1;e.entry.paused=d;return}this.unscheduleUpdate(c)}else{e.entry.markedForDeletion=!1;e.entry.paused=d;return}0===b?this._appendIn(this._updates0List,a,c,d):0>b?this._priorityIn(this._updatesNegList,a,c,b,d):this._priorityIn(this._updatesPosList,a,c,b,d)},_removeHashElement:function(a){delete this._hashForTimers[a.target.__instanceId];
cc.arrayRemoveObject(this._arrayForTimers,a);a.Timer=null;a.target=null},_removeUpdateFromHash:function(a){if(a=this._hashForUpdates[a.target.__instanceId])cc.arrayRemoveObject(a.list,a.entry),delete this._hashForUpdates[a.target.__instanceId],a.entry=null,a.target=null},_priorityIn:function(a,c,b,d,e){c=new cc.ListEntry(null,null,c,b,d,e,!1);if(a){e=a.length-1;for(var f=0;f<=e&&!(d<a[f].priority);f++);a.splice(f,0,c)}else a=[],a.push(c);this._hashForUpdates[b.__instanceId]=new cc.HashUpdateEntry(a,
c,b,null);return a},_appendIn:function(a,c,b,d){c=new cc.ListEntry(null,null,c,b,0,d,!1);a.push(c);this._hashForUpdates[b.__instanceId]=new cc.HashUpdateEntry(a,c,b,null,null)},setTimeScale:function(a){this._timeScale=a},getTimeScale:function(){return this._timeScale},update:function(a){this._updateHashLocked=!0;1!==this._timeScale&&(a*=this._timeScale);var c,b,d,e;c=0;b=this._updatesNegList;for(d=b.length;c<d;c++)e=b[c],!e.paused&&!e.markedForDeletion&&e.callback(a);c=0;b=this._updates0List;for(d=
b.length;c<d;c++)e=b[c],!e.paused&&!e.markedForDeletion&&e.callback(a);c=0;b=this._updatesPosList;for(d=b.length;c<d;c++)e=b[c],!e.paused&&!e.markedForDeletion&&e.callback(a);d=this._arrayForTimers;for(c=0;c<d.length;c++){this._currentTarget=b=d[c];this._currentTargetSalvaged=!1;if(!b.paused)for(b.timerIndex=0;b.timerIndex<b.timers.length;++b.timerIndex)b.currentTimer=b.timers[b.timerIndex],b.currentTimerSalvaged=!1,b.currentTimer.update(a),b.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&
this._removeHashElement(this._currentTarget)}c=0;for(b=this._updatesNegList;c<b.length;)e=b[c],e.markedForDeletion?this._removeUpdateFromHash(e):c++;c=0;for(b=this._updates0List;c<b.length;)e=b[c],e.markedForDeletion?this._removeUpdateFromHash(e):c++;c=0;for(b=this._updatesPosList;c<b.length;)e=b[c],e.markedForDeletion?this._removeUpdateFromHash(e):c++;this._updateHashLocked=!1;this._currentTarget=null},scheduleCallbackForTarget:function(a,c,b,d,e,f){this.schedule(c,a,b,d,e,f,a.__instanceId+"")},
schedule:function(a,c,b,d,e,f,g){var h=!1;if("function"!==typeof a)var k=a,h=!0;!1===h?5===arguments.length&&(g=e,f=d,e=0,d=cc.REPEAT_FOREVER):4===arguments.length&&(f=d,d=cc.REPEAT_FOREVER,e=0);cc.assert(c,cc._LogInfos.Scheduler_scheduleCallbackForTarget_3);!1===h&&cc.assert(g,"key should not be empty!");var l=this._hashForTimers[c.__instanceId];l?cc.assert(l.paused===f,""):(l=new cc.HashTimerEntry(null,c,0,null,null,f,null),this._arrayForTimers.push(l),this._hashForTimers[c.__instanceId]=l);var n,
m;if(null==l.timers)l.timers=[];else if(!1===h)for(m=0;m<l.timers.length;m++){if(n=l.timers[m],a===n._callback){cc.log(cc._LogInfos.Scheduler_scheduleCallbackForTarget,n.getInterval().toFixed(4),b.toFixed(4));n._interval=b;return}}else for(m=0;m<l.timers.length;++m)if((n=l.timers[m])&&k===n.getSelector()){cc.log("CCScheduler#scheduleSelector. Selector already scheduled. Updating interval from: %.4f to %.4f",n.getInterval(),b);n.setInterval(b);return}!1===h?(n=new cc.TimerTargetCallback,n.initWithCallback(this,
a,c,g,b,d,e)):(n=new cc.TimerTargetSelector,n.initWithSelector(this,k,c,b,d,e));l.timers.push(n)},scheduleUpdate:function(a,c,b){this._schedulePerFrame(function(c){a.update(c)},a,c,b)},_getUnscheduleMark:function(a,c){switch(typeof a){case "number":case "string":return a===c.getKey();case "function":return a===c._callback;default:return a===c.getSelector()}},unschedule:function(a,c){if(c&&a){var b=this._hashForTimers[c.__instanceId];if(b)for(var d=b.timers,e=0,f=d.length;e<f;e++){var g=d[e];if(this._getUnscheduleMark(a,
g)){g===b.currentTimer&&!b.currentTimerSalvaged&&(b.currentTimerSalvaged=!0);d.splice(e,1);b.timerIndex>=e&&b.timerIndex--;0===d.length&&(this._currentTarget===b?this._currentTargetSalvaged=!0:this._removeHashElement(b));break}}}},unscheduleUpdate:function(a){if(null!=a&&(a=this._hashForUpdates[a.__instanceId]))this._updateHashLocked?a.entry.markedForDeletion=!0:this._removeUpdateFromHash(a.entry)},unscheduleAllForTarget:function(a){if(null!=a){var c=this._hashForTimers[a.__instanceId];c&&(-1<c.timers.indexOf(c.currentTimer)&&
!c.currentTimerSalvaged&&(c.currentTimerSalvaged=!0),c.timers.length=0,this._currentTarget===c?this._currentTargetSalvaged=!0:this._removeHashElement(c));this.unscheduleUpdate(a)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(a){var c,b,d=this._arrayForTimers;for(c=0;c<d.length;c++)b=d[c],this.unscheduleAllForTarget(b.target);d=0;if(0>a)for(c=0;c<this._updatesNegList.length;)d=this._updatesNegList.length,(b=this._updatesNegList[c])&&
b.priority>=a&&this.unscheduleUpdate(b.target),d==this._updatesNegList.length&&c++;if(0>=a)for(c=0;c<this._updates0List.length;)d=this._updates0List.length,(b=this._updates0List[c])&&this.unscheduleUpdate(b.target),d==this._updates0List.length&&c++;for(c=0;c<this._updatesPosList.length;)d=this._updatesPosList.length,(b=this._updatesPosList[c])&&b.priority>=a&&this.unscheduleUpdate(b.target),d==this._updatesPosList.length&&c++},isScheduled:function(a,c){cc.assert(a,"Argument key must not be empty");
cc.assert(c,"Argument target must be non-nullptr");var b=this._hashForUpdates[c.__instanceId];if(!b)return!1;if(null!=b.timers)for(var b=b.timers,d=0;d<b.length;++d)if(a===b[d].getKey())return!0;return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(a){var c=[],b,d=this._arrayForTimers,e,f;e=0;for(f=d.length;e<f;e++)if(b=d[e])b.paused=!0,c.push(b.target);if(0>a)for(e=0;e<this._updatesNegList.length;e++)if((b=
this._updatesNegList[e])&&b.priority>=a)b.paused=!0,c.push(b.target);if(0>=a)for(e=0;e<this._updates0List.length;e++)if(b=this._updates0List[e])b.paused=!0,c.push(b.target);for(e=0;e<this._updatesPosList.length;e++)if((b=this._updatesPosList[e])&&b.priority>=a)b.paused=!0,c.push(b.target);return c},resumeTargets:function(a){if(a)for(var c=0;c<a.length;c++)this.resumeTarget(a[c])},pauseTarget:function(a){cc.assert(a,cc._LogInfos.Scheduler_pauseTarget);var c=this._hashForTimers[a.__instanceId];c&&(c.paused=
!0);if(a=this._hashForUpdates[a.__instanceId])a.entry.paused=!0},resumeTarget:function(a){cc.assert(a,cc._LogInfos.Scheduler_resumeTarget);var c=this._hashForTimers[a.__instanceId];c&&(c.paused=!1);if(a=this._hashForUpdates[a.__instanceId])a.entry.paused=!1},isTargetPaused:function(a){cc.assert(a,cc._LogInfos.Scheduler_isTargetPaused);var c=this._hashForTimers[a.__instanceId];return c?c.paused:(a=this._hashForUpdates[a.__instanceId])?a.entry.paused:!1},scheduleUpdateForTarget:function(a,c,b){this.scheduleUpdate(a,
c,b)},unscheduleCallbackForTarget:function(a,c){this.unschedule(c,a)},unscheduleUpdateForTarget:function(a){this.unscheduleUpdate(a)},unscheduleAllCallbacksForTarget:function(a){this.unschedule(a.__instanceId+"",a)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(a){this.unscheduleAllWithMinPriority(a)}});cc.Scheduler.PRIORITY_SYSTEM=-2147483648;cc._tmp.PrototypeLabelTTF=function(){var a=cc.LabelTTF.prototype;cc.defineGetterSetter(a,"color",a.getColor,a.setColor);cc.defineGetterSetter(a,"opacity",a.getOpacity,a.setOpacity);cc.defineGetterSetter(a,"string",a.getString,a.setString);cc.defineGetterSetter(a,"textAlign",a.getHorizontalAlignment,a.setHorizontalAlignment);cc.defineGetterSetter(a,"verticalAlign",a.getVerticalAlignment,a.setVerticalAlignment);cc.defineGetterSetter(a,"fontSize",a.getFontSize,a.setFontSize);cc.defineGetterSetter(a,
"fontName",a.getFontName,a.setFontName);cc.defineGetterSetter(a,"font",a._getFont,a._setFont);cc.defineGetterSetter(a,"boundingWidth",a._getBoundingWidth,a._setBoundingWidth);cc.defineGetterSetter(a,"boundingHeight",a._getBoundingHeight,a._setBoundingHeight);cc.defineGetterSetter(a,"fillStyle",a._getFillStyle,a.setFontFillColor);cc.defineGetterSetter(a,"strokeStyle",a._getStrokeStyle,a._setStrokeStyle);cc.defineGetterSetter(a,"lineWidth",a._getLineWidth,a._setLineWidth);cc.defineGetterSetter(a,"shadowOffsetX",
a._getShadowOffsetX,a._setShadowOffsetX);cc.defineGetterSetter(a,"shadowOffsetY",a._getShadowOffsetY,a._setShadowOffsetY);cc.defineGetterSetter(a,"shadowOpacity",a._getShadowOpacity,a._setShadowOpacity);cc.defineGetterSetter(a,"shadowBlur",a._getShadowBlur,a._setShadowBlur)};cc.LabelTTF=cc.Sprite.extend({_dimensions:null,_hAlignment:cc.TEXT_ALIGNMENT_CENTER,_vAlignment:cc.VERTICAL_TEXT_ALIGNMENT_TOP,_fontName:null,_fontSize:0,_string:"",_originalText:null,_shadowEnabled:!1,_shadowOffset:null,_shadowOpacity:0,_shadowBlur:0,_shadowColor:null,_strokeEnabled:!1,_strokeColor:null,_strokeSize:0,_textFillColor:null,_strokeShadowOffsetX:0,_strokeShadowOffsetY:0,_needUpdateTexture:!1,_lineWidths:null,_className:"LabelTTF",_fontStyle:"normal",_fontWeight:"normal",_lineHeight:"normal",
initWithString:function(a,c,b,d,e,f){a=a?a+"":"";b=b||16;d=d||cc.size(0,0);e=e||cc.TEXT_ALIGNMENT_LEFT;f=f||cc.VERTICAL_TEXT_ALIGNMENT_TOP;this._opacityModifyRGB=!1;this._dimensions=cc.size(d.width,d.height);this._fontName=c||"Arial";this._hAlignment=e;this._vAlignment=f;this._fontSize=b;this._renderCmd._setFontStyle(this._fontName,b,this._fontStyle,this._fontWeight);this.string=a;this._renderCmd._setColorsString();this._renderCmd._updateTexture();this._setUpdateTextureDirty();return!0},_setUpdateTextureDirty:function(){this._needUpdateTexture=
!0;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.textDirty)},ctor:function(a,c,b,d,e,f){cc.Sprite.prototype.ctor.call(this);this._dimensions=cc.size(0,0);this._hAlignment=cc.TEXT_ALIGNMENT_LEFT;this._vAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP;this._opacityModifyRGB=!1;this._fontName="Arial";this._shadowEnabled=!1;this._shadowOffset=cc.p(0,0);this._shadowBlur=this._shadowOpacity=0;this._strokeEnabled=!1;this._strokeColor=cc.color(255,255,255,255);this._strokeSize=0;this._textFillColor=cc.color(255,
255,255,255);this._strokeShadowOffsetY=this._strokeShadowOffsetX=0;this._needUpdateTexture=!1;this._lineWidths=[];this._renderCmd._setColorsString();this._textureLoaded=!0;c&&c instanceof cc.FontDefinition?this.initWithStringAndTextDefinition(a,c):cc.LabelTTF.prototype.initWithString.call(this,a,c,b,d,e,f)},init:function(){return this.initWithString(" ",this._fontName,this._fontSize)},description:function(){return"\x3ccc.LabelTTF | FontName \x3d"+this._fontName+" FontSize \x3d "+this._fontSize.toFixed(1)+
"\x3e"},getLineHeight:function(){return!this._lineHeight||this._lineHeight.charAt?this._renderCmd._getFontClientHeight():this._lineHeight||this._renderCmd._getFontClientHeight()},setLineHeight:function(a){this._lineHeight=a},getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},getDimensions:function(){return cc.size(this._dimensions)},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},
initWithStringAndTextDefinition:function(a,c){this._updateWithTextDefinition(c,!1);this.string=a;return!0},setTextDefinition:function(a){a&&this._updateWithTextDefinition(a,!0)},getTextDefinition:function(){return this._prepareTextDefinition(!1)},enableShadow:function(a,c,b,d){null!=a.r&&null!=a.g&&null!=a.b&&null!=a.a?this._enableShadow(a,c,b):this._enableShadowNoneColor(a,c,b,d)},_enableShadowNoneColor:function(a,c,b,d){b=b||0.5;!1===this._shadowEnabled&&(this._shadowEnabled=!0);var e=this._shadowOffset;
if(e&&e.x!==a||e._y!==c)e.x=a,e.y=c;this._shadowOpacity!==b&&(this._shadowOpacity=b);this._renderCmd._setColorsString();this._shadowBlur!==d&&(this._shadowBlur=d);this._setUpdateTextureDirty()},_enableShadow:function(a,c,b){this._shadowColor||(this._shadowColor=cc.color(255,255,255,128));this._shadowColor.r=a.r;this._shadowColor.g=a.g;this._shadowColor.b=a.b;this._enableShadowNoneColor(c.width||c.x||0,c.height||c.y||0,null!=a.a?a.a/255:0.5,b)},_getShadowOffsetX:function(){return this._shadowOffset.x},
_setShadowOffsetX:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowOffset.x!==a&&(this._shadowOffset.x=a,this._setUpdateTextureDirty())},_getShadowOffsetY:function(){return this._shadowOffset._y},_setShadowOffsetY:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowOffset._y!==a&&(this._shadowOffset._y=a,this._setUpdateTextureDirty())},_getShadowOffset:function(){return cc.p(this._shadowOffset.x,this._shadowOffset.y)},_setShadowOffset:function(a){!1===
this._shadowEnabled&&(this._shadowEnabled=!0);if(this._shadowOffset.x!==a.x||this._shadowOffset.y!==a.y)this._shadowOffset.x=a.x,this._shadowOffset.y=a.y,this._setUpdateTextureDirty()},_getShadowOpacity:function(){return this._shadowOpacity},_setShadowOpacity:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowOpacity!==a&&(this._shadowOpacity=a,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getShadowBlur:function(){return this._shadowBlur},_setShadowBlur:function(a){!1===
this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowBlur!==a&&(this._shadowBlur=a,this._setUpdateTextureDirty())},disableShadow:function(){this._shadowEnabled&&(this._shadowEnabled=!1,this._setUpdateTextureDirty())},enableStroke:function(a,c){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var b=this._strokeColor;if(b.r!==a.r||b.g!==a.g||b.b!==a.b)b.r=a.r,b.g=a.g,b.b=a.b,this._renderCmd._setColorsString();this._strokeSize!==c&&(this._strokeSize=c||0);this._setUpdateTextureDirty()},_getStrokeStyle:function(){return this._strokeColor},
_setStrokeStyle:function(a){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var c=this._strokeColor;if(c.r!==a.r||c.g!==a.g||c.b!==a.b)c.r=a.r,c.g=a.g,c.b=a.b,this._renderCmd._setColorsString(),this._setUpdateTextureDirty()},_getLineWidth:function(){return this._strokeSize},_setLineWidth:function(a){!1===this._strokeEnabled&&(this._strokeEnabled=!0);this._strokeSize!==a&&(this._strokeSize=a||0,this._setUpdateTextureDirty())},disableStroke:function(){this._strokeEnabled&&(this._strokeEnabled=!1,
this._setUpdateTextureDirty())},setFontFillColor:function(a){var c=this._textFillColor;if(c.r!==a.r||c.g!==a.g||c.b!==a.b)c.r=a.r,c.g=a.g,c.b=a.b,this._renderCmd._setColorsString(),this._needUpdateTexture=!0},_getFillStyle:function(){return this._textFillColor},_updateWithTextDefinition:function(a,c){a.fontDimensions?(this._dimensions.width=a.boundingWidth,this._dimensions.height=a.boundingHeight):(this._dimensions.width=0,this._dimensions.height=0);this._hAlignment=a.textAlign;this._vAlignment=a.verticalAlign;
this._fontName=a.fontName;this._fontSize=a.fontSize||12;this._lineHeight=a.lineHeight?a.lineHeight:this._fontSize;this._renderCmd._setFontStyle(a);a.shadowEnabled&&this.enableShadow(a.shadowOffsetX,a.shadowOffsetY,a.shadowOpacity,a.shadowBlur);a.strokeEnabled&&this.enableStroke(a.strokeStyle,a.lineWidth);this.setFontFillColor(a.fillStyle);c&&this._renderCmd._updateTexture();var b=cc.Node._dirtyFlags;this._renderCmd.setDirtyFlag(b.colorDirty|b.opacityDirty|b.textDirty)},_prepareTextDefinition:function(a){var c=
new cc.FontDefinition;a?(c.fontSize=this._fontSize,c.boundingWidth=cc.contentScaleFactor()*this._dimensions.width,c.boundingHeight=cc.contentScaleFactor()*this._dimensions.height):(c.fontSize=this._fontSize,c.boundingWidth=this._dimensions.width,c.boundingHeight=this._dimensions.height);c.fontName=this._fontName;c.textAlign=this._hAlignment;c.verticalAlign=this._vAlignment;if(this._strokeEnabled){c.strokeEnabled=!0;var b=this._strokeColor;c.strokeStyle=cc.color(b.r,b.g,b.b);c.lineWidth=this._strokeSize}else c.strokeEnabled=
!1;this._shadowEnabled?(c.shadowEnabled=!0,c.shadowBlur=this._shadowBlur,c.shadowOpacity=this._shadowOpacity,c.shadowOffsetX=(a?cc.contentScaleFactor():1)*this._shadowOffset.x,c.shadowOffsetY=(a?cc.contentScaleFactor():1)*this._shadowOffset.y):c._shadowEnabled=!1;a=this._textFillColor;c.fillStyle=cc.color(a.r,a.g,a.b);return c},setString:function(a){a=String(a);this._originalText!==a&&(this._originalText=a+"",this._updateString(),this._setUpdateTextureDirty(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},
_updateString:function(){if((!this._string||""===this._string)&&this._string!==this._originalText)cc.renderer.childrenOrderDirty=!0;this._string=this._originalText},setHorizontalAlignment:function(a){a!==this._hAlignment&&(this._hAlignment=a,this._setUpdateTextureDirty())},setVerticalAlignment:function(a){a!==this._vAlignment&&(this._vAlignment=a,this._setUpdateTextureDirty())},setDimensions:function(a,c){var b;void 0===c?(b=a.width,c=a.height):b=a;if(b!==this._dimensions.width||c!==this._dimensions.height)this._dimensions.width=
b,this._dimensions.height=c,this._updateString(),this._setUpdateTextureDirty()},_getBoundingWidth:function(){return this._dimensions.width},_setBoundingWidth:function(a){a!==this._dimensions.width&&(this._dimensions.width=a,this._updateString(),this._setUpdateTextureDirty())},_getBoundingHeight:function(){return this._dimensions.height},_setBoundingHeight:function(a){a!==this._dimensions.height&&(this._dimensions.height=a,this._updateString(),this._setUpdateTextureDirty())},setFontSize:function(a){this._fontSize!==
a&&(this._fontSize=a,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},setFontName:function(a){this._fontName&&this._fontName!==a&&(this._fontName=a,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFont:function(){return this._renderCmd._getFontStyle()},_setFont:function(a){if(a=cc.LabelTTF._fontStyleRE.exec(a))this._fontSize=parseInt(a[1]),this._fontName=
a[2],this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty()},getContentSize:function(){this._needUpdateTexture&&this._renderCmd._updateTTF();return cc.Sprite.prototype.getContentSize.call(this)},_getWidth:function(){this._needUpdateTexture&&this._renderCmd._updateTTF();return cc.Sprite.prototype._getWidth.call(this)},_getHeight:function(){this._needUpdateTexture&&this._renderCmd._updateTTF();return cc.Sprite.prototype._getHeight.call(this)},
setTextureRect:function(a,c,b){cc.Sprite.prototype.setTextureRect.call(this,a,c,b,!1)},_createRenderCmd:function(){return cc._renderType===cc._RENDER_TYPE_CANVAS?new cc.LabelTTF.CanvasRenderCmd(this):new cc.LabelTTF.WebGLRenderCmd(this)},_setFontStyle:function(a){this._fontStyle!==a&&(this._fontStyle=a,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontStyle:function(){return this._fontStyle},_setFontWeight:function(a){this._fontWeight!==
a&&(this._fontWeight=a,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontWeight:function(){return this._fontWeight}});cc.assert(cc.isFunction(cc._tmp.PrototypeLabelTTF),cc._LogInfos.MissingFile,"LabelTTFPropertyDefine.js");cc._tmp.PrototypeLabelTTF();delete cc._tmp.PrototypeLabelTTF;cc.LabelTTF._fontStyleRE=/^(\d+)px\s+['"]?([\w\s\d]+)['"]?$/;
cc.LabelTTF.create=function(a,c,b,d,e,f){return new cc.LabelTTF(a,c,b,d,e,f)};cc.LabelTTF.createWithFontDefinition=cc.LabelTTF.create;cc.LabelTTF._SHADER_PROGRAM=cc.USE_LA88_LABELS?cc.SHADER_POSITION_TEXTURECOLOR:cc.SHADER_POSITION_TEXTUREA8COLOR;cc.LabelTTF.__labelHeightDiv=cc.newElement("div");cc.LabelTTF.__labelHeightDiv.style.fontFamily="Arial";cc.LabelTTF.__labelHeightDiv.style.position="absolute";cc.LabelTTF.__labelHeightDiv.style.left="-100px";cc.LabelTTF.__labelHeightDiv.style.top="-100px";
cc.LabelTTF.__labelHeightDiv.style.lineHeight="normal";document.body?document.body.appendChild(cc.LabelTTF.__labelHeightDiv):cc._addEventListener(window,"load",function(){this.removeEventListener("load",arguments.callee,!1);document.body.appendChild(cc.LabelTTF.__labelHeightDiv)},!1);
cc.LabelTTF.__getFontHeightByDiv=function(a,c){if(a instanceof cc.FontDefinition){var b=cc.LabelTTF.__fontHeightCache[a._getCanvasFontStr()];if(0<b)return b;var d=cc.LabelTTF.__labelHeightDiv;d.innerHTML="ajghl~!";d.style.fontFamily=a.fontName;d.style.fontSize=a.fontSize+"px";d.style.fontStyle=a.fontStyle;d.style.fontWeight=a.fontWeight;b=d.clientHeight;cc.LabelTTF.__fontHeightCache[a._getCanvasFontStr()]=b;d.innerHTML="";return b}b=cc.LabelTTF.__fontHeightCache[a+"."+c];if(0<b)return b;d=cc.LabelTTF.__labelHeightDiv;
d.innerHTML="ajghl~!";d.style.fontFamily=a;d.style.fontSize=c+"px";b=d.clientHeight;cc.LabelTTF.__fontHeightCache[a+"."+c]=b;d.innerHTML="";return b};cc.LabelTTF.__fontHeightCache={};cc.LabelTTF._textAlign=["left","center","right"];cc.LabelTTF._textBaseline=["top","middle","bottom"];cc.LabelTTF.wrapInspection=!0;cc.LabelTTF._wordRex=/([a-zA-Z0-9\u00c4\u00d6\u00dc\u00e4\u00f6\u00fc\u00df\u00e9\u00e8\u00e7\u00e0\u00f9\u00ea\u00e2\u00ee\u00f4\u00fb]+|\S)/;cc.LabelTTF._symbolRex=/^[!,.:;}\]%\?>\u3001\u2018\u201c\u300b\uff1f\u3002\uff0c\uff01]/;cc.LabelTTF._lastWordRex=/([a-zA-Z0-9\u00c4\u00d6\u00dc\u00e4\u00f6\u00fc\u00df\u00e9\u00e8\u00e7\u00e0\u00f9\u00ea\u00e2\u00ee\u00f4\u00fb]+|\S)$/;
cc.LabelTTF._lastEnglish=/[a-zA-Z0-9\u00c4\u00d6\u00dc\u00e4\u00f6\u00fc\u00df\u00e9\u00e8\u00e7\u00e0\u00f9\u00ea\u00e2\u00ee\u00f4\u00fb]+$/;cc.LabelTTF._firsrEnglish=/^[a-zA-Z0-9\u00c4\u00d6\u00dc\u00e4\u00f6\u00fc\u00df\u00e9\u00e8\u00e7\u00e0\u00f9\u00ea\u00e2\u00ee\u00f4\u00fb]/;
(function(){cc.LabelTTF.RenderCmd=function(){this._fontClientHeight=18;this._fontStyleStr="";this._shadowColorStr="rgba(128, 128, 128, 0.5)";this._strokeColorStr="";this._fillColorStr="rgba(255,255,255,1)";this._labelContext=this._labelCanvas=null;this._lineWidths=[];this._strings=[];this._isMultiLine=!1};var a=cc.LabelTTF.RenderCmd.prototype;a.constructor=cc.LabelTTF.RenderCmd;a._getLabelContext=function(){if(this._labelContext)return this._labelContext;var a=this._node;if(!this._labelCanvas){var b=
cc.newElement("canvas");b.width=1;b.height=1;var d=new cc.Texture2D;d.initWithElement(b);a.setTexture(d);this._labelCanvas=b}return this._labelContext=this._labelCanvas.getContext("2d")};a._setFontStyle=function(a,b,d,e){a instanceof cc.FontDefinition?(this._fontStyleStr=a._getCanvasFontStr(),this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(a)):(this._fontStyleStr=d+" "+e+" "+b+"px '"+a+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(a,b))};a._getFontStyle=function(){return this._fontStyleStr};
a._getFontClientHeight=function(){return this._fontClientHeight};a._updateTexture=function(){this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.textDirty;var a=this._node,b=this._getLabelContext(),d=this._labelCanvas,e=a._contentSize;if(0===a._string.length)return d.width=1,d.height=e.height||1,a._texture&&a._texture.handleLoadedTexture(),a.setTextureRect(cc.rect(0,0,1,e.height)),!0;b.font=this._fontStyleStr;this._updateTTF();var f=e.width,e=e.height,g=d.width===f&&d.height===e;d.width=f;d.height=
e;g&&b.clearRect(0,0,f,e);this._drawTTFInCanvas(b);a._texture&&a._texture.handleLoadedTexture();a.setTextureRect(cc.rect(0,0,f,e));return!0};a._measureConfig=function(){this._getLabelContext().font=this._fontStyleStr};a._measure=function(a){return this._getLabelContext().measureText(a).width};a._updateTTF=function(){var a=this._node,b=a._dimensions.width,d,e,f=this._lineWidths;f.length=0;this._isMultiLine=!1;this._measureConfig();if(0!==b){this._strings=a._string.split("\n");for(d=0;d<this._strings.length;d++)this._checkWarp(this._strings,
d,b)}else{this._strings=a._string.split("\n");d=0;for(e=this._strings.length;d<e;d++)f.push(this._measure(this._strings[d]))}0<this._strings.length&&(this._isMultiLine=!0);e=d=0;a._strokeEnabled&&(d=e=2*a._strokeSize);if(a._shadowEnabled){var g=a._shadowOffset;d+=2*Math.abs(g.x);e+=2*Math.abs(g.y)}b=0===b?this._isMultiLine?cc.size(Math.ceil(Math.max.apply(Math,f)+d),Math.ceil(this._fontClientHeight*this._strings.length+e)):cc.size(Math.ceil(this._measure(a._string)+d),Math.ceil(this._fontClientHeight+
e)):0===a._dimensions.height?this._isMultiLine?cc.size(Math.ceil(b+d),Math.ceil(a.getLineHeight()*this._strings.length+e)):cc.size(Math.ceil(b+d),Math.ceil(a.getLineHeight()+e)):cc.size(Math.ceil(b+d),Math.ceil(a._dimensions.height+e));"normal"!==a._getFontStyle()&&(b.width=Math.ceil(b.width+0.3*a._fontSize));a.setContentSize(b);a._strokeShadowOffsetX=d;a._strokeShadowOffsetY=e;a=a._anchorPoint;this._anchorPointInPoints.x=0.5*d+(b.width-d)*a.x;this._anchorPointInPoints.y=0.5*e+(b.height-e)*a.y};a._drawTTFInCanvas=
function(a){if(a){var b=this._node,d=b._strokeShadowOffsetX,e=b._strokeShadowOffsetY,f=b._contentSize.height-e,g=b._vAlignment,h=b._hAlignment,k=b._strokeSize;a.setTransform(1,0,0,1,0.5*d,f+0.5*e);a.font!==this._fontStyleStr&&(a.font=this._fontStyleStr);a.fillStyle=this._fillColorStr;var l=e=0,n=b._strokeEnabled;n&&(a.lineWidth=2*k,a.strokeStyle=this._strokeColorStr);b._shadowEnabled&&(k=b._shadowOffset,a.shadowColor=this._shadowColorStr,a.shadowOffsetX=k.x,a.shadowOffsetY=-k.y,a.shadowBlur=b._shadowBlur);
a.textBaseline=cc.LabelTTF._textBaseline[g];a.textAlign=cc.LabelTTF._textAlign[h];var m=b._contentSize.width-d,d=b.getLineHeight(),k=(d-this._fontClientHeight)/2,e=h===cc.TEXT_ALIGNMENT_RIGHT?e+m:h===cc.TEXT_ALIGNMENT_CENTER?e+m/2:e+0;if(this._isMultiLine){b=this._strings.length;g===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?l=d-2*k+f-d*b:g===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(l=(d-2*k)/2+(f-d*b)/2);for(g=0;g<b;g++)h=this._strings[g],m=-f+(d*g+k)+l,n&&a.strokeText(h,e,m),a.fillText(h,e,m)}else g!==cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM&&
(l=g===cc.VERTICAL_TEXT_ALIGNMENT_TOP?l-f:l-0.5*f),n&&a.strokeText(b._string,e,l),a.fillText(b._string,e,l)}};a._checkWarp=function(a,b,d){var e=a[b],f=this._measure(e);if(f>d&&1<e.length){for(var g=e.length*(d/f)|0,h=e.substr(g),k=f-this._measure(h),l,n=0,m=0;k>d&&100>m++;)g*=d/k,g|=0,h=e.substr(g),k=f-this._measure(h);for(m=0;k<d&&100>m++;)h&&(n=(l=cc.LabelTTF._wordRex.exec(h))?l[0].length:1,l=h),g+=n,h=e.substr(g),k=f-this._measure(h);g-=n;0===g&&(g=1,l=l.substr(1));d=e.substr(0,g);if(cc.LabelTTF.wrapInspection&&
cc.LabelTTF._symbolRex.test(l||h))f=cc.LabelTTF._lastWordRex.exec(d),g-=f?f[0].length:0,l=e.substr(g),d=e.substr(0,g);if(cc.LabelTTF._firsrEnglish.test(l)&&(f=cc.LabelTTF._lastEnglish.exec(d))&&d!==f[0])g-=f[0].length,l=e.substr(g),d=e.substr(0,g);a[b]=l||h;a.splice(b,0,d)}}})();
(function(){cc.LabelTTF.CanvasRenderCmd=function(a){cc.Sprite.CanvasRenderCmd.call(this,a);cc.LabelTTF.RenderCmd.call(this)};cc.LabelTTF.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);cc.inject(cc.LabelTTF.RenderCmd.prototype,cc.LabelTTF.CanvasRenderCmd.prototype);var a=cc.LabelTTF.CanvasRenderCmd.prototype;a.constructor=cc.LabelTTF.CanvasRenderCmd;a.updateStatus=function(){var a=cc.Node._dirtyFlags,b=this._dirtyFlag,d=b&a.colorDirty,e=b&a.opacityDirty;d&&this._updateDisplayColor();
e&&this._updateDisplayOpacity();d?this._updateColor():b&a.textDirty&&this._updateTexture();this._dirtyFlag&a.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty)};a._syncStatus=function(a){var b=cc.Node._dirtyFlags,d=this._dirtyFlag,e=a?a._node:null;e&&(e._cascadeColorEnabled&&a._dirtyFlag&b.colorDirty)&&(d|=b.colorDirty);e&&(e._cascadeOpacityEnabled&&a._dirtyFlag&b.opacityDirty)&&(d|=b.opacityDirty);a&&a._dirtyFlag&b.transformDirty&&
(d|=b.transformDirty);var e=d&b.colorDirty,f=d&b.opacityDirty;this._dirtyFlag=d;e&&this._syncDisplayColor();f&&this._syncDisplayOpacity();e?this._updateColor():d&b.textDirty&&this._updateTexture();d&b.transformDirty&&this.transform(a)};a._setColorsString=function(){var a=this._displayedColor,b=this._node,d=b._shadowColor||this._displayedColor,e=b._strokeColor,f=b._textFillColor,g=a.r/255,h=a.g/255,a=a.b/255;this._shadowColorStr="rgba("+(0|g*d.r)+","+(0|h*d.g)+","+(0|a*d.b)+","+b._shadowOpacity+")";
this._fillColorStr="rgba("+(0|g*f.r)+","+(0|h*f.g)+","+(0|a*f.b)+", 1)";this._strokeColorStr="rgba("+(0|g*e.r)+","+(0|h*e.g)+","+(0|a*e.b)+", 1)"};a._updateColor=function(){this._setColorsString();this._updateTexture()}})();